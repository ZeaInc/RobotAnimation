{"version":3,"file":"index.cjs.js","sources":["../src/CADConstants.js","../src/Hull.js","../src/CADSurfaceLibrary.js","../src/CADTrimSetLibrary.js","../src/CADBodyLibrary.js","../src/CADBody.js","../src/CADAsset.js","../src/CADAssembly.js","../src/GLSurfaceDrawSet.js","../src/GLCurveDrawSet.js","../src/GLCurveLibrary.js","../src/Math/BinReader.js","../src/GLSurfaceLibrary.js","../src/GLTrimCurveDrawSet.js","../src/GLTrimSetLibrary.js","../src/GLCADBody.js","../node_modules/rollup-plugin-web-worker-loader/src/WorkerLoaderHelper.js","../src/GLCADAsset.js","../src/GLCADMaterialLibrary.js","../src/GLSLBinReader.js","../src/GLSLMath.js","../src/GLSLCADCurves.js","../src/GLSLCADSurfaces.js","../src/GLSLNURBS.js","../src/GLSLNURBSCurves.js","../src/GLSLNURBSSurfaces.js","../src/GLEvaluateCADSurfaceShader.js","../src/GLSLCADConstants.js","../src/GLSLCADSurfaceDrawing.js","../src/GLCADShader.js","../src/GLDrawCADSurfaceNormalsShader.js","../src/GLDrawTrimCurveFansShader.js","../src/GLFlattenTrimSetsShader.js","../src/GLDrawTrimCurveStripsShader.js","../src/GLDebugTrimSetsShader.js","../src/GLEvaluateCADCurveShader.js","../src/GLDrawCADSurfaceShader.js","../src/GLDrawCADSurfaceGeomDataShader.js","../src/GLDrawSelectedCADSurfaceShader.js","../src/GLDrawCADCurveShader.js","../src/GLCADPass.js"],"sourcesContent":["const CADCurveTypes = {\r\n  CURVE_TYPE_LINE: 20,\r\n  CURVE_TYPE_CIRCLE: 21,\r\n  CURVE_TYPE_ELIPSE: 22,\r\n  //  CURVE_TYPE_HYPERBOLA: 23,\r\n  //  CURVE_TYPE_PARABOLA: 24,\r\n  //  CURVE_TYPE_BEZIERCURVE: 25,\r\n  CURVE_TYPE_NURBS_CURVE: 26,\r\n  //  CURVE_TYPE_OFFSET_CURVE: 27,\r\n  //  CURVE_TYPE_TRIMMED_CURVE: 28\r\n}\r\n\r\nconst CADSurfaceTypes = {\r\n  SURFACE_TYPE_PLANE: 0,\r\n  SURFACE_TYPE_CONE: 1,\r\n  SURFACE_TYPE_CYLINDER: 2,\r\n  SURFACE_TYPE_SPHERE: 3,\r\n  SURFACE_TYPE_TORUS: 4,\r\n  SURFACE_TYPE_LINEAR_EXTRUSION: 5,\r\n  SURFACE_TYPE_REVOLUTION: 6,\r\n  //  SURFACE_TYPE_BEZIER_SURFACE: 7,\r\n  SURFACE_TYPE_NURBS_SURFACE: 8,\r\n  SURFACE_TYPE_OFFSET_SURFACE: 9,\r\n  SURFACE_TYPE_TRIMMED_RECT_SURFACE: 10,\r\n  SURFACE_TYPE_POLY_PLANE: 14,\r\n  SURFACE_TYPE_FAN: 15,\r\n  SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN: 16,\r\n}\r\n\r\nconst getCurveTypeName = id => {\r\n  switch (id) {\r\n    case CADCurveTypes.CURVE_TYPE_LINE:\r\n      return 'CURVE_TYPE_LINE'\r\n    case CADCurveTypes.CURVE_TYPE_CIRCLE:\r\n      return 'CURVE_TYPE_CIRCLE'\r\n    case CADCurveTypes.CURVE_TYPE_ELIPSE:\r\n      return 'CURVE_TYPE_ELIPSE'\r\n    // case CADCurveTypes.CURVE_TYPE_HYPERBOLA: return 'CURVE_TYPE_HYPERBOLA';\r\n    // case CADCurveTypes.CURVE_TYPE_PARABOLA: return 'CURVE_TYPE_PARABOLA';\r\n    // case CADCurveTypes.CURVE_TYPE_BEZIERCURVE: return 'CURVE_TYPE_BEZIERCURVE';\r\n    case CADCurveTypes.CURVE_TYPE_NURBS_CURVE:\r\n      return 'CURVE_TYPE_NURBS_CURVE'\r\n    // case CADCurveTypes.CURVE_TYPE_OFFSET_CURVE: return 'CURVE_TYPE_OFFSET_CURVE';\r\n    // case CADCurveTypes.CURVE_TYPE_TRIMMED_CURVE: return 'CURVE_TYPE_TRIMMED_CURVE';\r\n  }\r\n}\r\n\r\nconst getSurfaceTypeName = id => {\r\n  switch (id) {\r\n    case CADSurfaceTypes.SURFACE_TYPE_PLANE:\r\n      return 'SURFACE_TYPE_PLANE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_CONE:\r\n      return 'SURFACE_TYPE_CONE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_CYLINDER:\r\n      return 'SURFACE_TYPE_CYLINDER'\r\n    case CADSurfaceTypes.SURFACE_TYPE_SPHERE:\r\n      return 'SURFACE_TYPE_SPHERE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_TORUS:\r\n      return 'SURFACE_TYPE_TORUS'\r\n    case CADSurfaceTypes.SURFACE_TYPE_LINEAR_EXTRUSION:\r\n      return 'SURFACE_TYPE_LINEAR_EXTRUSION'\r\n    case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION:\r\n      return 'SURFACE_TYPE_REVOLUTION'\r\n    //    case CADSurfaceTypes.SURFACE_TYPE_BEZIER_SURFACE: return 'SURFACE_TYPE_BEZIER_SURFACE';\r\n    case CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE:\r\n      return 'SURFACE_TYPE_NURBS_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_OFFSET_SURFACE:\r\n      return 'SURFACE_TYPE_OFFSET_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_TRIMMED_RECT_SURFACE:\r\n      return 'SURFACE_TYPE_TRIMMED_RECT_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_POLY_PLANE:\r\n      return 'SURFACE_TYPE_POLY_PLANE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_FAN:\r\n      return 'SURFACE_TYPE_FAN'\r\n    case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN:\r\n      return 'SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN'\r\n  }\r\n}\r\n\r\nconst geomLibraryHeaderSize = 8 // 2 FP16 pixels at the start of the GeomLibrary and CurveLibrary\r\n// const pixelsPerDrawItem = 10 // The number of RGBA pixels per draw item.\r\nconst pixelsPerDrawItem = 3 // tr, ori, sc: number of RGBA pixels per draw item.\r\nconst valuesPerCurveTocItem = 8\r\nconst valuesPerSurfaceTocItem = 9\r\nconst valuesPerCurveLibraryLayoutItem = 8\r\nconst valuesPerSurfaceLibraryLayoutItem = 8\r\n//const valuesPerSurfaceRef = 11 // A surfaceRef within a BodyDesc// This is now different based on the version.\r\nconst drawItemShaderAttribsStride = 8\r\nconst floatsPerSceneBody = 2\r\nconst drawShaderAttribsStride = 4 //drawCoords: body ID, Surface index in Body, Surface Id, TrimSet Id // + 2 drawItemTexAddr\r\nconst numValuesPerTrimSetCurveRef = 14 //patchCoords.xyzw, tr.xy, ori.xy, ori.zy, addr.xy, flags, curveId, curveIndexWithinLoop\r\n\r\nconst CURVE_FLAG_PERIODIC = 1 << 0\r\nconst CURVE_FLAG_UNUSED2 = 1 << 2\r\nconst CURVE_FLAG_COST_IS_DETAIL = 1 << 3\r\n\r\nconst SURFACE_FLAG_PERIODIC_U = 1 << 0\r\nconst SURFACE_FLAG_PERIODIC_V = 1 << 1\r\nconst SURFACE_FLAG_UNUSED2 = 1 << 2\r\nconst SURFACE_FLAG_UNUSED3 = 1 << 3\r\nconst SURFACE_FLAG_FLIPPED_NORMAL = 1 << 4\r\nconst SURFACE_FLAG_FLIPPED_UV = 1 << 5\r\nconst SURFACE_FLAG_COST_IS_DETAIL_U = 1 << 6\r\nconst SURFACE_FLAG_COST_IS_DETAIL_V = 1 << 7\r\n\r\nconst BODY_FLAG_CUTAWAY = 1 << 8\r\nconst BODY_FLAG_INVISIBLE = 1 << 9\r\n\r\nexport {\r\n  CADCurveTypes,\r\n  CADSurfaceTypes,\r\n  getCurveTypeName,\r\n  getSurfaceTypeName,\r\n  CURVE_FLAG_COST_IS_DETAIL,\r\n  SURFACE_FLAG_PERIODIC_U,\r\n  SURFACE_FLAG_PERIODIC_V,\r\n  SURFACE_FLAG_COST_IS_DETAIL_U,\r\n  SURFACE_FLAG_COST_IS_DETAIL_V,\r\n  SURFACE_FLAG_FLIPPED_NORMAL,\r\n  SURFACE_FLAG_FLIPPED_UV,\r\n  BODY_FLAG_CUTAWAY,\r\n  BODY_FLAG_INVISIBLE,\r\n  geomLibraryHeaderSize,\r\n  pixelsPerDrawItem,\r\n  valuesPerCurveTocItem,\r\n  valuesPerSurfaceTocItem,\r\n  valuesPerCurveLibraryLayoutItem,\r\n  valuesPerSurfaceLibraryLayoutItem,\r\n  /*valuesPerSurfaceRef,*/\r\n  drawItemShaderAttribsStride,\r\n  drawShaderAttribsStride,\r\n  floatsPerSceneBody,\r\n  numValuesPerTrimSetCurveRef,\r\n}\r\n","import { Lines } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a hull.\r\n * @extends Lines\r\n * @ignore\r\n */\r\nclass Hull extends Lines {\r\n  /**\r\n   * Create a hull.\r\n   * @param {number} numCPsU - The numCPsU value.\r\n   * @param {number} numCPsV - The numCPsV value.\r\n   */\r\n  constructor(numCPsU = 1, numCPsV = 1) {\r\n    super()\r\n    this.__numSpansU = numCPsU - 1\r\n    this.__numSpansV = numCPsV - 1\r\n    this.__rebuild()\r\n  }\r\n\r\n  /**\r\n   * The __rebuild method.\r\n   * @private\r\n   */\r\n  __rebuild() {\r\n    this.setNumVertices((this.__numSpansU + 1) * (this.__numSpansV + 1))\r\n    this.setNumSegments(this.__numSpansU * (this.__numSpansV + 1) + (this.__numSpansU + 1) * this.__numSpansV)\r\n\r\n    let idx = 0\r\n    for (let j = 0; j <= this.__numSpansV; j++) {\r\n      for (let i = 0; i < this.__numSpansU; i++) {\r\n        const v0 = (this.__numSpansU + 1) * j + i\r\n        const v1 = (this.__numSpansU + 1) * j + (i + 1)\r\n        this.setSegmentVertexIndices(idx, v0, v1)\r\n        idx++\r\n      }\r\n    }\r\n    for (let j = 0; j < this.__numSpansV; j++) {\r\n      for (let i = 0; i <= this.__numSpansU; i++) {\r\n        const v0 = (this.__numSpansU + 1) * j + i\r\n        const v1 = (this.__numSpansU + 1) * (j + 1) + i\r\n        this.setSegmentVertexIndices(idx, v0, v1)\r\n        idx++\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { Hull }\r\n// export default Hull;\r\n","import { Vec2, Vec3, Vec4, Box2, Quat, Color, Plane, Material, BinReader } from '@zeainc/zea-engine'\r\nimport { Hull } from './Hull.js'\r\nimport {\r\n  geomLibraryHeaderSize,\r\n  valuesPerCurveTocItem,\r\n  valuesPerSurfaceTocItem,\r\n  SURFACE_FLAG_PERIODIC_U,\r\n  SURFACE_FLAG_PERIODIC_V,\r\n  CADCurveTypes,\r\n  CADSurfaceTypes,\r\n  getCurveTypeName,\r\n  getSurfaceTypeName,\r\n} from './CADConstants.js'\r\n\r\n/** Class representing a CAD surface library.\r\n * @ignore\r\n */\r\nclass CADSurfaceLibrary {\r\n  /**\r\n   * Create a CAD surface library.\r\n   * @param {any} cadAsset - The cadAsset value.\r\n   * @param {any} trimSetLibrary - The trimSetLibrary value.\r\n   */\r\n  constructor(cadAsset, trimSetLibrary) {\r\n    this.__cadAsset = cadAsset\r\n    this.__trimSetLibrary = trimSetLibrary\r\n    this.__curveLibraryBuffer = undefined\r\n    this.__meshes = []\r\n    this.__hulls = []\r\n    this.__formFactors = {}\r\n\r\n    this.__maxNumKnots = 0\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffers method.\r\n   * @param {any} curveLibraryBuffer - The curveLibraryBuffer param.\r\n   * @param {any} surfaceLibraryBuffer - The surfaceLibraryBuffer param.\r\n   * @param {number} version - The version param.\r\n   */\r\n  setBinaryBuffers(curveLibraryBuffer, surfaceLibraryBuffer, cadDataVersion) {\r\n    this.__surfaceLibraryBuffer = surfaceLibraryBuffer\r\n    this.cadDataVersion = cadDataVersion\r\n    this.__surfaceLibraryReader = new BinReader(this.__surfaceLibraryBuffer)\r\n\r\n    this.__surfaceLibrarySize = Math.sqrt(surfaceLibraryBuffer.byteLength / 8) // RGBA16 pixels\r\n    this.__numSurfaces = this.__surfaceLibraryReader.loadUInt32()\r\n    this.__totalSurfaceArea = this.__surfaceLibraryReader.loadFloat32()\r\n\r\n    // this.__totalSurfaceCost = this.__surfaceLibraryReader.loadFloat32();\r\n\r\n    // for (let i = 0; i < this.__numCurves; i++) {\r\n    //   const dims = this.getCurveDims(i);\r\n    //   console.log(this.getCurveTypeLabel(i), \" length:\", dims.length, \" curvature:\", dims.curvature);\r\n    // }\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   const dims = this.getSurfaceDims(i);\r\n    //   const area = dims.sizeU * dims.sizeV;\r\n\r\n    //   console.log(this.getSurfaceTypeLabel(i), \" sizeU:\", dims.sizeU, \" sizeV:\", dims.sizeV, \" curvatureU:\", dims.curvatureU, \" curvatureV:\", dims.curvatureV);\r\n    // }\r\n\r\n    // if (this.__totalSurfaceArea == 0.0) {\r\n    //   this.__totalSurfaceArea == 0.0;\r\n    //   this.__totalSurfaceCost = 0.0;\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   const dims = this.getSurfaceDims(i);\r\n    //   const area = dims.sizeU * dims.sizeV;\r\n\r\n    //   console.log(this.getSurfaceTypeLabel(i), \" sizeU:\", dims.sizeU, \" sizeV:\", dims.sizeV, \" curvatureU:\", dims.curvatureU, \" curvatureV:\", dims.curvatureV);\r\n    //   // this.__totalSurfaceArea += area;\r\n    //   // this.__totalSurfaceCost += (1.0 + (dims.sizeU * dims.curvatureU)) * (1.0 + (dims.sizeV * dims.curvatureV));\r\n    // }\r\n    // }\r\n    // console.log(this.__totalSurfaceCost);\r\n\r\n    // this.__triCounts = [\r\n    //   10,\r\n    //   20,\r\n    //   40,\r\n    //   80,\r\n    // ]\r\n\r\n    if (this.__totalSurfaceArea == 0.0) {\r\n      for (let i = 0; i < this.__numSurfaces; i++) {\r\n        const dims = this.getSurfaceDims(i)\r\n        const area = dims.sizeU * dims.sizeV\r\n        this.__totalSurfaceArea += area\r\n      }\r\n    }\r\n\r\n    this.__curveLibraryBuffer = curveLibraryBuffer\r\n    this.__curveLibraryReader = new BinReader(this.__curveLibraryBuffer)\r\n    this.__curveLibrarySize = Math.sqrt(curveLibraryBuffer.byteLength / 8) // RGBA16 pixels\r\n    this.__numCurves = this.__curveLibraryReader.loadUInt32()\r\n\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   console.log(this.getSurfaceData(i, false));\r\n    // }\r\n    // for (let i = 0; i < this.__numCurves; i++) {\r\n    //   console.log(this.getCurveData(i));\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getCurveBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveBuffer() {\r\n    return this.__curveLibraryBuffer\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceBuffer() {\r\n    return this.__surfaceLibraryBuffer\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfaces method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfaces() {\r\n    return this.__numSurfaces\r\n  }\r\n\r\n  /**\r\n   * The getNumCurves method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumCurves() {\r\n    return this.__numCurves\r\n  }\r\n\r\n  /**\r\n   * The getDetailFactor method.\r\n   * @param {any} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDetailFactor(lod) {\r\n    // Given a target poly count, calculate the detail factor given the total surface cost.\r\n    // const targetQuadCount = this.__triCounts[Math.clamp(0, lod, this.__triCounts.length-1)] * 1000;\r\n    // return targetQuadCount / this.__totalSurfaceCost;\r\n    const mult = Math.pow(2, lod)\r\n    return mult * this.__cadAsset.curvatureToDetail\r\n  }\r\n\r\n  /**\r\n   * The getCurveDataTexelCoords method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveDataTexelCoords(curveId) {\r\n    this.__curveLibraryReader.seek(geomLibraryHeaderSize + curveId * (valuesPerCurveTocItem * 2) /* bpc*/)\r\n    const x = this.__curveLibraryReader.loadFloat16()\r\n    const y = this.__curveLibraryReader.loadFloat16()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __seekCurveData method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @param {number} offsetInBytes - The offsetInBytes param.\r\n   * @private\r\n   */\r\n  __seekCurveData(curveId, offsetInBytes = 0) {\r\n    const addr = this.getCurveDataTexelCoords(curveId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 8 // RGBA16 pixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__curveLibrarySize\r\n    // console.log(\"__seekSurfaceData:\" + curveId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__curveLibraryReader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getCurveType method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveType(curveId) {\r\n    this.__seekCurveData(curveId)\r\n    const curveType = this.__curveLibraryReader.loadFloat16()\r\n    return curveType\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveTypeLabel(curveId) {\r\n    const curveType = this.getCurveType(curveId)\r\n    return getCurveTypeName(curveType)\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveDims(curveId) {\r\n    this.__curveLibraryReader.seek(geomLibraryHeaderSize + curveId * (valuesPerCurveTocItem * 2) /* bpc*/)\r\n\r\n    return {\r\n      addrX: this.__curveLibraryReader.loadFloat16(),\r\n      addrY: this.__curveLibraryReader.loadFloat16(),\r\n      curvature: this.__curveLibraryReader.loadFloat16(),\r\n      length: this.__curveLibraryReader.loadFloat16(),\r\n      flags: this.__curveLibraryReader.loadFloat16(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveData(curveId) {\r\n    const dims = this.getCurveDims(curveId)\r\n    const curveType = this.getCurveType(curveId)\r\n    const domain = new Vec2(this.__curveLibraryReader.loadFloat16(), this.__curveLibraryReader.loadFloat16())\r\n\r\n    switch (curveType) {\r\n      case CADCurveTypes.CURVE_TYPE_LINE: {\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_LINE',\r\n          domain,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_CIRCLE: {\r\n        const radius = this.__curveLibraryReader.loadFloat16()\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_CIRCLE',\r\n          domain,\r\n          radius,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_ELIPSE: {\r\n        const majorRadius = this.__curveLibraryReader.loadFloat16()\r\n        const minorRadius = this.__curveLibraryReader.loadFloat16()\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'SURFACE_TYPE_CYLINDER',\r\n          domain,\r\n          majorRadius,\r\n          minorRadius,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_NURBS_CURVE: {\r\n        const degree = this.__curveLibraryReader.loadFloat16()\r\n        const numCPs = this.__curveLibraryReader.loadFloat16()\r\n        const numKnots = this.__curveLibraryReader.loadFloat16()\r\n        this.__curveLibraryReader.advance(4)\r\n\r\n        const controlPoints = []\r\n        for (let j = 0; j < numCPs; j++) {\r\n          const p = new Vec4(\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16()\r\n          )\r\n          controlPoints.push(p)\r\n        }\r\n        const knots = []\r\n        for (let j = 0; j < numKnots; j++) {\r\n          knots.push(this.__curveLibraryReader.loadFloat16())\r\n        }\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_NURBS_CURVE',\r\n          domain,\r\n          degree,\r\n          numCPs,\r\n          controlPoints,\r\n          knots,\r\n        }\r\n      }\r\n      default:\r\n        console.warn('Invalid Curve Type:', curveType)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceDataTexelCoords method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceDataTexelCoords(surfaceId) {\r\n    this.__surfaceLibraryReader.seek(geomLibraryHeaderSize + surfaceId * (valuesPerSurfaceTocItem * 2) /* bpc*/)\r\n    const x = this.__surfaceLibraryReader.loadUFloat16()\r\n    const y = this.__surfaceLibraryReader.loadUFloat16()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __seekSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @param {number} offsetInBytes - The offsetInBytes param.\r\n   * @private\r\n   */\r\n  __seekSurfaceData(surfaceId, offsetInBytes = 0) {\r\n    const addr = this.getSurfaceDataTexelCoords(surfaceId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 8 // RGBA16 pixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__surfaceLibrarySize\r\n    // console.log(\"__seekSurfaceData:\" + surfaceId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__surfaceLibraryReader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceType method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceType(surfaceId) {\r\n    this.__seekSurfaceData(surfaceId)\r\n    const surfaceType = this.__surfaceLibraryReader.loadFloat16()\r\n    return surfaceType\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceTypeLabel method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceTypeLabel(surfaceId) {\r\n    const surfaceType = this.getSurfaceType(surfaceId)\r\n    return getSurfaceTypeName(surfaceType)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceDims method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceDims(surfaceId) {\r\n    this.__surfaceLibraryReader.seek(geomLibraryHeaderSize + surfaceId * (valuesPerSurfaceTocItem * 2) /* bpc*/)\r\n\r\n    const loadTrimSetId = () => {\r\n      if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n        // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n        const partA = this.__surfaceLibraryReader.loadFloat16()\r\n        const partB = this.__surfaceLibraryReader.loadFloat16()\r\n        return partA + (partB << 8)\r\n      } else {\r\n        return this.__surfaceLibraryReader.loadSInt32From2xFloat16()\r\n      }\r\n    }\r\n    return {\r\n      addrX: this.__surfaceLibraryReader.loadUFloat16(),\r\n      addrY: this.__surfaceLibraryReader.loadUFloat16(),\r\n      curvatureU: this.__surfaceLibraryReader.loadFloat16(),\r\n      curvatureV: this.__surfaceLibraryReader.loadFloat16(),\r\n      sizeU: this.__surfaceLibraryReader.loadFloat16(), // size U\r\n      sizeV: this.__surfaceLibraryReader.loadFloat16(), // size V\r\n      flags: this.__surfaceLibraryReader.loadFloat16(),\r\n      trimSetId: loadTrimSetId(), // trimSetId\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId, includeTrimSet = true) {\r\n    const dims = this.getSurfaceDims(surfaceId)\r\n\r\n    const surfaceType = this.getSurfaceType(surfaceId)\r\n    const readDomain = () => {\r\n      const domain = new Box2()\r\n      domain.p0.x = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p0.y = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p1.x = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p1.y = this.__surfaceLibraryReader.loadFloat16()\r\n      return domain\r\n    }\r\n    if (dims.trimSetId >= 0 && includeTrimSet) dims.trimSet = this.__trimSetLibrary.getTrimSetCurves(dims.trimSetId)\r\n\r\n    switch (surfaceType) {\r\n      case CADSurfaceTypes.SURFACE_TYPE_PLANE: {\r\n        const domain = readDomain()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_PLANE',\r\n          domain,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_FAN: {\r\n        const domain = readDomain()\r\n        const points = []\r\n        const numPoints = dims.curvatureU + 1\r\n        for (let j = 0; j < numPoints; j++) {\r\n          const p = new Vec2(this.__surfaceLibraryReader.loadFloat16(), this.__surfaceLibraryReader.loadFloat16())\r\n          points.push(p)\r\n        }\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_FAN',\r\n          domain,\r\n          points,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_CONE: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        const semiAngle = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_CONE',\r\n          domain,\r\n          radius,\r\n          semiAngle,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_CYLINDER: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_CYLINDER',\r\n          domain,\r\n          radius,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_SPHERE: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_SPHERE',\r\n          domain,\r\n          radius,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_TORUS: {\r\n        const domain = readDomain()\r\n        const majorRadius = this.__surfaceLibraryReader.loadFloat16()\r\n        const minorRadius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_TORUS',\r\n          domain,\r\n          majorRadius,\r\n          minorRadius,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_LINEAR_EXTRUSION: {\r\n        const domain = readDomain()\r\n\r\n        let curveIndex\r\n        // if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n        //   // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n        //   const partA = this.__surfaceLibraryReader.loadFloat16()\r\n        //   const partB = this.__surfaceLibraryReader.loadFloat16()\r\n        //   curveIndex = partA + (partB << 8)\r\n        // } else {\r\n        // curveIndex = this.__surfaceLibraryReader.loadUInt32From2xUFloat16()\r\n\r\n        const partA = this.__surfaceLibraryReader.loadUFloat16()\r\n        const partB = this.__surfaceLibraryReader.loadUFloat16()\r\n        curveIndex = partA + partB * 2048\r\n        // }\r\n\r\n        const curveData = this.getCurveData(curveIndex)\r\n\r\n        const curve_tr = new Vec3(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n        const curve_ori = new Quat(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_LINEAR_EXTRUSION',\r\n          domain,\r\n          curve_tr,\r\n          curve_ori,\r\n          curveData,\r\n          partA,\r\n          partB,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN:\r\n      case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION: {\r\n        const domain = readDomain()\r\n\r\n        let curveIndex\r\n        if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n          // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n          const partA = this.__surfaceLibraryReader.loadFloat16()\r\n          const partB = this.__surfaceLibraryReader.loadFloat16()\r\n          curveIndex = partA + (partB << 8)\r\n        } else {\r\n          curveIndex = this.__surfaceLibraryReader.loadUInt32From2xUFloat16()\r\n        }\r\n\r\n        const curve_tr = new Vec3(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n        const curve_ori = new Quat(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n\r\n        const curveData = this.getCurveData(curveIndex)\r\n\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_REVOLUTION',\r\n          domain,\r\n          curve_tr,\r\n          curve_ori,\r\n          curveData,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE: {\r\n        const domain = readDomain()\r\n        const degreeU = this.__surfaceLibraryReader.loadFloat16()\r\n        const degreeV = this.__surfaceLibraryReader.loadFloat16()\r\n        const numCPsU = this.__surfaceLibraryReader.loadFloat16()\r\n\r\n        const numCPsV = this.__surfaceLibraryReader.loadFloat16()\r\n        const numKnotsU = this.__surfaceLibraryReader.loadFloat16()\r\n        const numKnotsV = this.__surfaceLibraryReader.loadFloat16()\r\n        const flags = this.__surfaceLibraryReader.loadFloat16()\r\n        const periodicU = (flags & SURFACE_FLAG_PERIODIC_U) != 0\r\n        const periodicV = (flags & SURFACE_FLAG_PERIODIC_V) != 0\r\n        // this.__surfaceLibraryReader.advance(2);\r\n\r\n        const controlPoints = []\r\n        for (let j = 0; j < numCPsU * numCPsV; j++) {\r\n          const p = new Vec4(\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16()\r\n          )\r\n          controlPoints.push(p)\r\n        }\r\n        const knotsU = []\r\n        for (let j = 0; j < numKnotsU; j++) {\r\n          knotsU.push(this.__surfaceLibraryReader.loadFloat16())\r\n        }\r\n        const knotsV = []\r\n        for (let j = 0; j < numKnotsV; j++) {\r\n          knotsV.push(this.__surfaceLibraryReader.loadFloat16())\r\n        }\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_NURBS_SURFACE',\r\n          domain,\r\n          periodicU,\r\n          periodicV,\r\n          degreeU,\r\n          degreeV,\r\n          numCPsU,\r\n          numCPsV,\r\n          controlPoints,\r\n          knotsU,\r\n          knotsV,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_POLY_PLANE: {\r\n        const p0 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p1 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p2 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p3 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_POLY_PLANE',\r\n          points: [p0, p1, p2, p3],\r\n        }\r\n      }\r\n      default: {\r\n        const surfaceType = this.getSurfaceType(surfaceId)\r\n        console.warn('Invalid Surface Type:', surfaceType, ' surfaceId:', surfaceId)\r\n      }\r\n    }\r\n  }\r\n\r\n  /** ************************************************************\r\n   *  NURBS Utils\r\n   **************************************************************/\r\n\r\n  /**\r\n   * Finds knot vector span.\r\n   * @param {number} u - Parametric value.\r\n   * @param {number} degree - Degree.\r\n   * @param {array} knots - Knot vector.\r\n   * @param {array} knotValues - The knotValues param.\r\n   * @return {number} - Returns the span.\r\n   */\r\n  findSpan(u, degree, knots, knotValues) {\r\n    if (this.cadDataVersion.compare([0, 0, 6]) >= 0) {\r\n      this.cadDataVersion\r\n      // EXPORT_KNOTS_AS_DELTAS\r\n\r\n      let nextKnot = knots[0]\r\n      let knot = nextKnot\r\n\r\n      let span = 1\r\n      const n = knots.length - degree - 1\r\n      // Linear Search...\r\n      for (; span < n; span++) {\r\n        nextKnot += knots[span]\r\n        if (span > degree && u < nextKnot) {\r\n          span--\r\n          break\r\n        }\r\n        knot = nextKnot\r\n      }\r\n      if (span == n) {\r\n        span--\r\n      }\r\n\r\n      // Calculate knot values\r\n      knotValues[degree] = knot\r\n      let left = knot\r\n      let right = knot\r\n      for (let i = 1; i <= degree; i++) {\r\n        left -= knots[span - i + 1]\r\n        right += knots[span + i]\r\n        knotValues[degree - i] = left\r\n        knotValues[degree + i] = right\r\n      }\r\n      return span\r\n    } else {\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate basis functions.\r\n   * See The NURBS Book, page 70, algorithm A2.2\r\n   * span : span in which u lies\r\n   * @param {any} u - Parametric point.\r\n   * @param {any} degree - Degree.\r\n   * @param {any} knots - Knot vector.\r\n   * @param {any} bvD - The bvD param.\r\n   * @return {any} - Returns array[degree+1] with basis functions values.\r\n   */\r\n  calcBasisValues(u, degree, knots, bvD) {\r\n    const left = []\r\n    const right = []\r\n    // Basis[0] is always 1.0\r\n    const basisValues = [1.0]\r\n    bvD[0] = 0.0\r\n\r\n    for (let j = 1; j <= degree; ++j) {\r\n      left[j] = u - knots[degree + 1 - j]\r\n      right[j] = knots[degree + j] - u\r\n\r\n      let saved = 0.0\r\n      for (let r = 0; r < j; ++r) {\r\n        const rv = right[r + 1]\r\n        const lv = left[j - r]\r\n        const temp = basisValues[r] / (rv + lv)\r\n        basisValues[r] = saved + rv * temp\r\n        saved = lv * temp\r\n      }\r\n\r\n      basisValues[j] = saved\r\n\r\n      // Calculate N' if on second to last iteration\r\n      if (j == degree - 1 || degree == 1) {\r\n        saved = 0.0\r\n        // Loop through all basis values\r\n        for (let r = 0; r < degree; r++) {\r\n          // Calculate a temp variable\r\n          const jr_z = r + 1\r\n          // Calculate right side\r\n          const kp_0 = knots[jr_z + degree]\r\n          const kp_1 = knots[jr_z]\r\n          const tmp = (degree * basisValues[r]) / (kp_0 - kp_1)\r\n          // Calculate derivative value\r\n          bvD[r] = saved - tmp\r\n          // Swap right side to left\r\n          saved = tmp\r\n        }\r\n        // Save the last der-basis\r\n        bvD[degree] = saved\r\n      }\r\n    }\r\n\r\n    return basisValues\r\n  }\r\n\r\n  /**\r\n   * Calculate basis function derivativess.\r\n   * See The NURBS Book, page 70, algorithm A2.2\r\n   * span : span in which u lies\r\n   * https://github.com/pradeep-pyro/tinynurbs/blob/master/include/tinynurbs/core/basis.h#L163\r\n   * @param {any} u - Parametric point.\r\n   * @param {any} degree - Degree.\r\n   * @param {any} knots - Knot vector.\r\n   * @return {any} - Returns array[degree+1] with basis function derivative values.\r\n   */\r\n  calcBasisDerivatives(u, degree, knots) {\r\n    const left = []\r\n    const right = []\r\n    let saved = 0.0\r\n    let temp = 0.0\r\n\r\n    const ndu = []\r\n    for (let j = 0; j <= degree; j++) {\r\n      ndu.push([])\r\n    }\r\n    ndu[0][0] = 1.0\r\n\r\n    for (let j = 1; j <= degree; j++) {\r\n      left[j] = u - knots[degree + 1 - j]\r\n      right[j] = knots[degree + j] - u\r\n      saved = 0.0\r\n\r\n      for (let r = 0; r < j; r++) {\r\n        const rv = right[r + 1]\r\n        const lv = left[j - r]\r\n        const rvlv = rv + lv\r\n\r\n        // Lower triangle\r\n        ndu[j][r] = rvlv\r\n        temp = ndu[r][j - 1] / rvlv\r\n        // Upper triangle\r\n        ndu[r][j] = saved + rv * temp\r\n        saved = lv * temp\r\n      }\r\n\r\n      ndu[j][j] = saved\r\n    }\r\n\r\n    const ders = [[], []]\r\n    for (let j = 0; j <= degree; j++) {\r\n      ders[0][j] = ndu[j][degree]\r\n    }\r\n\r\n    const a = [[], []]\r\n    for (let j = 0; j <= degree; j++) {\r\n      a[0].push(0)\r\n      a[1].push(0)\r\n    }\r\n\r\n    for (let r = 0; r <= degree; r++) {\r\n      let s1 = 0\r\n      let s2 = 1\r\n      a[0][0] = 1.0\r\n\r\n      // for (int k = 1; k <= 1; k++)\r\n      {\r\n        const k = 1\r\n        let d = 0.0\r\n        const rk = r - k\r\n        const pk = degree - k\r\n        let j1 = 0\r\n        let j2 = 0\r\n\r\n        if (r >= k) {\r\n          a[s2][0] = a[s1][0] / ndu[pk + 1][rk]\r\n          d = a[s2][0] * ndu[rk][pk]\r\n        }\r\n\r\n        if (rk >= -1) {\r\n          j1 = 1\r\n        } else {\r\n          j1 = -rk\r\n        }\r\n\r\n        if (r - 1 <= pk) {\r\n          j2 = k - 1\r\n        } else {\r\n          j2 = degree - r\r\n        }\r\n\r\n        for (let j = j1; j <= j2; j++) {\r\n          a[s2][j] = (a[s1][j] - a[s1][j - 1]) / ndu[pk + 1][rk + j]\r\n          d += a[s2][j] * ndu[rk + j][pk]\r\n        }\r\n\r\n        if (r <= pk) {\r\n          a[s2][k] = -a[s1][k - 1] / ndu[pk + 1][r]\r\n          d += a[s2][k] * ndu[r][pk]\r\n        }\r\n\r\n        ders[k][r] = d\r\n\r\n        const temp = s1\r\n        s1 = s2\r\n        s2 = temp\r\n      }\r\n    }\r\n\r\n    let fac = degree\r\n    // for (int k = 1; k <= 1; k++)\r\n    {\r\n      const k = 1\r\n      for (let j = 0; j <= degree; j++) {\r\n        ders[k][j] = ders[k][j] * fac\r\n      }\r\n      fac *= degree - k\r\n    }\r\n\r\n    return ders\r\n  }\r\n\r\n  // http://www.nar-associates.com/nurbs/programs/dbasisu.c\r\n  /* Subroutine to generate B-spline basis functions and their derivatives for uniform open knot vectors. */\r\n\r\n  /**\r\n   * Calculate rational B-Spline surface point.\r\n   * See The NURBS Book, page 134, algorithm A4.3\r\n   *\r\n   * p1, p2 : degrees of B-Spline surface\r\n   * U1, U2 : knot vectors\r\n   * P      : control points (x, y, z, w)\r\n   * u, v   : parametric values\r\n   *\r\n   * returns point for given (u, v)\r\n   *\r\n   * @param {any} surfaceData - The surfaceData param.\r\n   * @param {any} params - The params param.\r\n   * @return {any} - The return value.\r\n   */\r\n  calcSurfacePoint(surfaceData, params) {\r\n    const d = surfaceData\r\n\r\n    const u = Math.remap(params[0], 0, 1, d.domain.p0.x, d.domain.p1.x)\r\n    const v = Math.remap(params[1], 0, 1, d.domain.p0.y, d.domain.p1.y)\r\n\r\n    const knotValuesU = []\r\n    const spanU = this.findSpan(u, d.degreeU, d.knotsU, knotValuesU)\r\n    const knotValuesV = []\r\n    const spanV = this.findSpan(v, d.degreeV, d.knotsV, knotValuesV)\r\n\r\n    const bvdsU = []\r\n    const basisValuesU = this.calcBasisValues(u, d.degreeU, knotValuesU, bvdsU)\r\n    const bvdsV = []\r\n    const basisValuesV = this.calcBasisValues(v, d.degreeV, knotValuesV, bvdsV)\r\n\r\n    // const dersU = this.calcBasisDerivatives(u, d.degreeU, knotValuesU)\r\n    // const dersV = this.calcBasisDerivatives(v, d.degreeV, knotValuesV)\r\n    // const basisValuesU = dersU[0]\r\n    // const basisValuesV = dersV[0]\r\n\r\n    // console.log(\"knotValuesU:\", knotValuesU)\r\n    // console.log(\"basisValuesU:\", basisValuesU)\r\n    // console.log(\"knotValuesV:\", knotValuesV)\r\n    // console.log(\"basisValuesV:\", basisValuesV)\r\n    // }\r\n    // else {\r\n\r\n    // }\r\n\r\n    const pos = new Vec3(0, 0, 0)\r\n    const tangentU = new Vec3(0, 0, 0)\r\n    const tangentV = new Vec3(0, 0, 0)\r\n    let w = 0.0\r\n    const cvU0 = spanU - d.degreeU\r\n    const cvV0 = spanV - d.degreeV\r\n    for (let y = 0; y <= d.degreeV; ++y) {\r\n      // let vindex = (spanV - d.degreeV + y) % d.numCPsV;\r\n      const vindex = cvV0 + y\r\n      for (let x = 0; x <= d.degreeU; ++x) {\r\n        // const uindex = (spanU - d.degreeU + x) % d.numCPsU;\r\n        const uindex = cvU0 + x\r\n\r\n        const pt = d.controlPoints[uindex + vindex * d.numCPsU]\r\n        const weight = pt.t\r\n\r\n        const bvU = basisValuesU[x]\r\n        const bvV = basisValuesV[y]\r\n        // const bvU = dersU[0][x]\r\n        // const bvV = dersV[0][y]\r\n\r\n        const bvw = weight * bvU * bvV\r\n        pos.addInPlace(pt.scale(bvw))\r\n        w += bvw\r\n\r\n        const bvdU = bvdsU[x]\r\n        const bvdV = bvdsV[y]\r\n        // const bvdU = dersU[1][x]\r\n        // const bvdV = dersV[1][y]\r\n        tangentU.addInPlace(pt.scale(bvdU * bvV))\r\n        tangentV.addInPlace(pt.scale(bvU * bvdV))\r\n      }\r\n    }\r\n    if (w == 0 || isNaN(w) || !isFinite(w)) console.warn('Unable to evaluate surface')\r\n\r\n    // console.log('spanV:', spanV, ' v:', v, ' w:', w)\r\n    pos.scaleInPlace(1 / w)\r\n\r\n    ///////////////////////////////////////////////////////\r\n    // Calculate normal.\r\n    const spanRangeU = knotValuesU[d.degreeU + 1] - knotValuesU[d.degreeU]\r\n    const spanRangeV = knotValuesV[d.degreeV + 1] - knotValuesV[d.degreeV]\r\n    const eqKnotRangeU = (d.domain.p1.x - d.domain.p0.x) / d.knotsU.length\r\n    const eqKnotRangeV = (d.domain.p1.y - d.domain.p0.y) / d.knotsV.length\r\n\r\n    // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n    // Note: for COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.\r\n    // this tollerance needed to be quite high. (bigger than 0.005)\r\n\r\n    if (spanRangeU / eqKnotRangeU < 0.01) {\r\n      // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n      // we have span segment which has close to zero delta, and\r\n      // so the normals are broken. We want to advace along the\r\n      // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n      // length of the span rather than when we have a pinched corner,\r\n      // where we move along the toher direction.\r\n      // console.log(v, 'spanRangeU:', spanRangeU, ' eqKnotRangeU:', eqKnotRangeU, spanRangeU / eqKnotRangeU)\r\n\r\n      let cvU = cvU0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvU = cvU0 + d.degreeU - 2\r\n      } else {\r\n        // if the broken normal is at the start of the U range, then\r\n        // we will grab the next in the row.\r\n        cvU = cvU0 + 1\r\n      }\r\n\r\n      const spanLerpV = (u - knotValuesV[d.degreeV]) / spanRangeV\r\n      const cvV = cvV0 + Math.floor(spanLerpV * d.degreeV)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + 1 + cvV * d.numCPsU].toVec3()\r\n\r\n      tangentU.setFromOther(pt1.subtract(pt0))\r\n    } else if (tangentU.length() < 0.05) {\r\n      // The derivative in the V direction is zero,\r\n      // so we calculate the linear derivative for the next control points along.\r\n\r\n      let cvV\r\n      if (spanV > d.degreeV) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvV = cvV0 + d.degreeV - 2\r\n      } else {\r\n        // if the broken normal is at the start of the V range, then\r\n        // we will grab the next in the row.\r\n        cvV = cvV0 + 1\r\n      }\r\n\r\n      const spanLerpU = (u - knotValuesU[d.degreeU]) / spanRangeU\r\n      const cvU = cvU0 + Math.floor(spanLerpU * d.degreeU)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + 1 + cvV * d.numCPsU].toVec3()\r\n\r\n      tangentU.setFromOther(pt1.subtract(pt0))\r\n      // tangentU.setFromOther(pt0.subtract(pt1));\r\n    }\r\n\r\n    if (spanRangeV / eqKnotRangeV < 0.01) {\r\n      // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n      // we have span segment which has close to zero delta, and\r\n      // so the normals are broken. We want to advace along the\r\n      // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n      // length of the span rather than when we have a pinched corner,\r\n      // where we move along the toher direction.\r\n      // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n      let cvV = cvV0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvV = cvV0 + d.degreeV - 2\r\n      } else {\r\n        // if the broken normal is at the start of the V range, then\r\n        // we will grab the next in the row.\r\n        cvV = cvV0 + 1\r\n      }\r\n\r\n      const spanLerpU = (u - knotValuesU[d.degreeU]) / spanRangeU\r\n      const cvU = cvU0 + Math.floor(spanLerpU * d.degreeU)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + (cvV + 1) * d.numCPsU].toVec3()\r\n\r\n      tangentV.setFromOther(pt1.subtract(pt0))\r\n    } else if (tangentV.length() < 0.05) {\r\n      // The derivative in the V direction is zero,\r\n      // so we calculate the linear derivative for the next control points along.\r\n\r\n      let cvU = cvU0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvU = cvU0 + d.degreeU - 2\r\n      } else {\r\n        // if the broken normal is at the start of the U range, then\r\n        // we will grab the next in the row.\r\n        cvU = cvU0 + 1\r\n      }\r\n\r\n      const spanLerpV = (u - knotValuesV[d.degreeV]) / spanRangeV\r\n      const cvV = cvV0 + Math.floor(spanLerpV * d.degreeV)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + (cvV + 1) * d.numCPsU].toVec3()\r\n\r\n      tangentV.setFromOther(pt1.subtract(pt0))\r\n    }\r\n\r\n    const normal = tangentU.cross(tangentV).normalize()\r\n\r\n    return {\r\n      pos,\r\n      normal,\r\n    }\r\n  }\r\n\r\n  // https://github.com/arennuit/libnurbs/blob/3f7daae483a615a13d21e5c674f412ccb8587b6e/nurbs%2B%2B-3.0.11/nurbs/nurbs.cpp\r\n\r\n  /**\r\n   * The generatePolygonSurface method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   */\r\n  generatePolygonSurface(surfaceId, lod = 0) {\r\n    if (this.__meshes[surfaceId]) {\r\n      // const color = this.__meshes[surfaceId].mat.getParameter('BaseColor').getValue();\r\n      // color.r = color.r + 0.2;\r\n      // console.log(\"surface Instanced:\" + surfaceId + \":\" + color.r);\r\n      return this.__meshes[surfaceId]\r\n    }\r\n\r\n    if (this.getSurfaceType(surfaceId) != CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE) {\r\n      return\r\n    }\r\n    const surfaceData = this.getSurfaceData(surfaceId)\r\n    if (!surfaceData) {\r\n      return\r\n    }\r\n    const M = surfaceData.numCPsU * Math.pow(2, lod)\r\n    const N = surfaceData.numCPsV * Math.pow(2, lod)\r\n\r\n    console.log('generatePolygonSurface:' + surfaceId + ' M:' + M + ' N:' + N)\r\n\r\n    const quad = new Plane(1.0, 1.0, M, N)\r\n    const normalsGeom = new Lines()\r\n    normalsGeom.setNumVertices((M + 1) * (N + 1) * 2)\r\n    normalsGeom.setNumSegments((M + 1) * (N + 1))\r\n    const normalsGeom_PosAttr = normalsGeom.getVertexAttribute('positions')\r\n    const normalsLength = 0.2\r\n\r\n    let voff = 0\r\n    const positions = quad.getVertexAttribute('positions')\r\n    const normals = quad.getVertexAttribute('normals')\r\n    for (let j = 0; j <= N; j++) {\r\n      const v = j / N\r\n      for (let i = 0; i <= M; i++) {\r\n        const u = i / M\r\n        const pt = this.calcSurfacePoint(surfaceData, [u, v])\r\n\r\n        positions.getValueRef(voff).set(pt.pos.x, pt.pos.y, pt.pos.z)\r\n        normals.getValueRef(voff).set(pt.normal.x, pt.normal.y, pt.normal.z)\r\n\r\n        normalsGeom.setSegmentVertexIndices(voff, voff * 2, voff * 2 + 1)\r\n        // if (v == 0.0)\r\n        {\r\n          normalsGeom_PosAttr.getValueRef(voff * 2).set(pt.pos.x, pt.pos.y, pt.pos.z)\r\n          normalsGeom_PosAttr\r\n            .getValueRef(voff * 2 + 1)\r\n            .set(\r\n              pt.pos.x + pt.normal.x * normalsLength,\r\n              pt.pos.y + pt.normal.y * normalsLength,\r\n              pt.pos.z + pt.normal.z * normalsLength\r\n            )\r\n        }\r\n\r\n        voff++\r\n      }\r\n    }\r\n\r\n    // quad.computeVertexNormals();\r\n\r\n    const material = new Material('myMat', 'SimpleSurfaceShader')\r\n    material.getParameter('BaseColor').setValue(Color.random(0.15))\r\n    quad.material = material\r\n\r\n    const normalsGeomMaterial = new Material('myMat', 'FlatSurfaceShader')\r\n    normalsGeomMaterial.getParameter('BaseColor').setValue(new Color(1, 0, 0))\r\n    normalsGeom.material = normalsGeomMaterial\r\n\r\n    this.__meshes[surfaceId] = quad\r\n    return { mesh: quad, normals: normalsGeom }\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  generateHullGeometry(surfaceId) {\r\n    if (this.__hulls[surfaceId]) {\r\n      // const color = this.__hulls[surfaceId].mat.getParameter('BaseColor').getValue();\r\n      // color.r = color.r + 0.2;\r\n      // console.log(\"surface Instanced:\" + surfaceId + \":\" + color.r);\r\n      return this.__hulls[surfaceId]\r\n    }\r\n\r\n    if (this.getSurfaceType(surfaceId) != CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE) {\r\n      return\r\n    }\r\n    const surfaceData = this.getSurfaceData(surfaceId)\r\n    if (!surfaceData) {\r\n      return\r\n    }\r\n    console.log(\r\n      'generateHullGeometry:' + surfaceId + ' numCPsU:' + surfaceData.numCPsU + ' numCPsV:' + surfaceData.numCPsV\r\n    )\r\n    const hull = new Hull(surfaceData.numCPsU, surfaceData.numCPsV)\r\n\r\n    const positions = hull.getVertexAttribute('positions')\r\n    let voff = 0\r\n    for (let j = 0; j < surfaceData.numCPsV; j++) {\r\n      for (let i = 0; i < surfaceData.numCPsU; i++) {\r\n        const index = i + j * surfaceData.numCPsU\r\n        const pt = surfaceData.controlPoints[index]\r\n        positions.getValueRef(voff).set(pt.x, pt.y, pt.z)\r\n        voff++\r\n      }\r\n    }\r\n\r\n    const material = new Material('hullMaterial', 'FlatSurfaceShader')\r\n    material.getParameter('BaseColor').setValue(Color.random(-0.25))\r\n    hull.material = material\r\n\r\n    this.__hulls[surfaceId] = hull\r\n    return hull\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugSurfaces method.\r\n   */\r\n  dumpDebugSurfaces() {\r\n    const surfacesData = []\r\n    for (let i = 0; i < this.__numSurfaces; i++) {\r\n      try {\r\n        surfacesData.push(this.getSurfaceData(i, false))\r\n      } catch (e) {\r\n        console.warn('Error accessing Surface: ', i, e)\r\n        surfacesData.push({})\r\n      }\r\n    }\r\n    return surfacesData\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugCurves method.\r\n   */\r\n  dumpDebugCurves() {\r\n    const curvesData = []\r\n    for (let i = 0; i < this.__numSurfaces; i++) {\r\n      try {\r\n        curvesData.push(this.getCurveData(i))\r\n      } catch (e) {\r\n        console.warn('Error accessing Curve: ', i, e)\r\n        curvesData.push({})\r\n      }\r\n    }\r\n    return curvesData\r\n  }\r\n\r\n  /**\r\n   * The logFormfactors method.\r\n   */\r\n  logFormfactors() {\r\n    for (const ff in this.__formFactors) console.log(ff + ':' + this.__formFactors[ff])\r\n  }\r\n}\r\n\r\nexport { CADSurfaceLibrary }\r\n","import { SystemDesc } from '@zeainc/zea-engine'\r\n\r\nconst sizeOfBBox = 24\r\n\r\n/** Class representing a CAD trim set library.\r\n * @ignore\r\n */\r\nclass CADTrimSetLibrary {\r\n  /**\r\n   * Create a CAD trim set library.\r\n   */\r\n  constructor() {\r\n    this.__reader = undefined\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffer method.\r\n   * @param {any} trimSetReader - The trimSetReader param.\r\n   * @param {number} version - The version param.\r\n   */\r\n  setBinaryBuffer(trimSetReader, version) {\r\n    this.__reader = trimSetReader\r\n\r\n    this.__numTrimSets = this.__reader.loadUInt32()\r\n    if (version.compare([0, 0, 0]) > 0) {\r\n      this.__totalTrimSurfaceArea = this.__reader.loadFloat32()\r\n    } else {\r\n      this.__totalTrimSurfaceArea = 0.0\r\n      for (let i = 0; i < this.__numTrimSets; i++) {\r\n        const dims = this.getTrimSetDim(i)\r\n        const area = dims[0] * dims[1]\r\n        this.__totalTrimSurfaceArea += area\r\n      }\r\n    }\r\n\r\n    const sideLength = Math.sqrt(this.__totalTrimSurfaceArea)\r\n\r\n    const maxTexSize = SystemDesc.gpuDesc.maxTextureSize\r\n    // I'm not sure whats going on here.\r\n    // The xlarge size should be at most maxTexSize >> 1 (e.g. 50% wasted space.)\r\n    const xlargeTexSize = maxTexSize >> 1\r\n    const largeTexSize = maxTexSize >> 2\r\n    const medTexSize = maxTexSize >> 3\r\n    const smallTexSize = maxTexSize >> 4\r\n\r\n    // Note: on big scenes like the Spyder, the texels often fail\r\n    // to pack when tex size is too small, causing artifacts in trimming.\r\n    // Therefore the biggest texture size is half the maximum.\r\n    this.__texelSizes = [\r\n      sideLength / smallTexSize,\r\n      sideLength / medTexSize,\r\n      sideLength / largeTexSize,\r\n      sideLength / xlargeTexSize,\r\n    ]\r\n    // console.log(\"sideLength:\", sideLength, this.__texelSizes);\r\n\r\n    ////////////////////////////\r\n    // Debugging.\r\n    // for (let i = 0; i < this.__numTrimSets; i++) {\r\n    //   console.log({\r\n    //     dims: this.getTrimSetDim(i),\r\n    //     curves: this.getTrimSetCurves(i)\r\n    //   })\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getBinaryBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBinaryBuffer() {\r\n    if (!this.__reader) return null\r\n    return this.__reader.data\r\n  }\r\n\r\n  /**\r\n   * The getNumTrimSets method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumTrimSets() {\r\n    return this.__numTrimSets\r\n  }\r\n\r\n  /**\r\n   * The getTrimArea method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimArea() {\r\n    return this.__totalTrimSurfaceArea\r\n  }\r\n\r\n  /**\r\n   * The getTexelSize method.\r\n   * @param {any} lod - The lod param.\r\n   * @param {any} numAssets - The numAssets param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTexelSize(lod, numAssets) {\r\n    // return 5\r\n    // For scenes with many assets we drop down the texel detail\r\n    // so they load without destroying the GPU.\r\n    let lodId\r\n    if (numAssets < 2) lodId = 3\r\n    else if (numAssets < 6) lodId = 2\r\n    else {\r\n      lodId = 1 // LOD 0 is just a mess.\r\n    }\r\n    // lodId = 1\r\n\r\n    // return 4\r\n    return this.__texelSizes[lodId]\r\n    // return this.__texelSizes[Math.clamp(lod, 0, this.__texelSizes.length-1)];\r\n  }\r\n\r\n  /**\r\n   * The getTrimSetDim method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimSetDim(trimSetId) {\r\n    this.__reader.seek(8 + trimSetId * 4)\r\n    this.__reader.seek(this.__reader.loadUInt32())\r\n\r\n    const size_x = this.__reader.loadFloat32() // size in scene units\r\n    const size_y = this.__reader.loadFloat32() // size in scene units\r\n    return [size_x, size_y]\r\n  }\r\n\r\n  /**\r\n   * The getTrimSetCurves method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimSetCurves(trimSetId) {\r\n    this.__reader.seek(8 + trimSetId * 4)\r\n    this.__reader.seek(this.__reader.loadUInt32())\r\n\r\n    const size_x = this.__reader.loadFloat32() // size in scene units\r\n    const size_y = this.__reader.loadFloat32() // size in scene units\r\n    const numHoles = this.__reader.loadUInt32()\r\n    const numPermiterCurves = this.__reader.loadUInt32()\r\n    const loadCurveRef = () => {\r\n      return {\r\n        id: this.__reader.loadFloat32(),\r\n        xfo_tr: [this.__reader.loadFloat32(), this.__reader.loadFloat32()],\r\n        xfo_rot: [\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n        ],\r\n        flags: this.__reader.loadFloat32(),\r\n      }\r\n    }\r\n    const perimeter = []\r\n    for (let i = 0; i < numPermiterCurves; i++) {\r\n      perimeter.push(loadCurveRef())\r\n    }\r\n    const holes = []\r\n    for (let i = 0; i < numHoles; i++) {\r\n      const hole = []\r\n      const numHoleCurves = this.__reader.loadUInt32()\r\n      for (let i = 0; i < numHoleCurves; i++) {\r\n        hole.push(loadCurveRef())\r\n      }\r\n      holes.push(hole)\r\n    }\r\n    return {\r\n      size: [size_x, size_y],\r\n      perimeter,\r\n      holes,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugTrimSets method.\r\n   */\r\n  dumpDebugTrimSets() {\r\n    const trimSetsData = []\r\n    for (let i = 0; i < this.__numTrimSets; i++) {\r\n      try {\r\n        trimSetsData.push({\r\n          dims: this.getTrimSetDim(i),\r\n          curves: this.getTrimSetCurves(i),\r\n        })\r\n      } catch (e) {\r\n        console.warn('Error accessing TrimSet: ', i, e)\r\n        trimSetsData.push({})\r\n      }\r\n    }\r\n    return trimSetsData\r\n  }\r\n}\r\n\r\nexport { CADTrimSetLibrary }\r\n","import { Box3, Xfo, BinReader } from '@zeainc/zea-engine'\r\nconst bytesPerValue = 4 // 32 bit floats\r\n\r\n/** Class representing a CAD body library.\r\n * @ignore\r\n */\r\nclass CADBodyLibrary {\r\n  /**\r\n   * Create a CAD body library.\r\n   * @param {any} buffer - The buffer value.\r\n   */\r\n  constructor(buffer) {\r\n    if (buffer != undefined) {\r\n      this.setBinaryBuffer(buffer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffers method.\r\n   * @param {any} tocBuffer - The tocBuffer param.\r\n   * @param {any} buffer - The buffer param.\r\n   */\r\n  setBinaryBuffers(tocBuffer, buffer) {\r\n    this.__buffer = buffer\r\n    this.__reader = new BinReader(this.__buffer)\r\n    this.__size = Math.sqrt(buffer.byteLength / (4 * bytesPerValue)) // RGBA32 pixels\r\n\r\n    this.__toc = tocBuffer // new Uint32Array(tocBuffer);\r\n    this.__tocReader = new BinReader(tocBuffer)\r\n    this.__numBodies = this.__tocReader.loadUInt32()\r\n\r\n    // for (let i = 0; i < this.__numBodies; i++) {\r\n    //     // console.log(JSON.stringify(this.getBodyDescData(i)));\r\n    //     console.log(this.getBodyDescData(i));\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getToc method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getToc() {\r\n    return this.__toc\r\n  }\r\n\r\n  /**\r\n   * The getBinaryBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBinaryBuffer() {\r\n    return this.__buffer\r\n  }\r\n\r\n  /**\r\n   * The getNumBodies method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumBodies() {\r\n    return this.__numBodies\r\n  }\r\n\r\n  /**\r\n   * The getBodyDataTexelCoords method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDataTexelCoords(bodyDescId) {\r\n    this.__tocReader.seek(4 + bodyDescId * (3 * 4))\r\n    const x = this.__tocReader.loadUInt32()\r\n    const y = this.__tocReader.loadUInt32()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  __seekBodyData(bodyDescId, offsetInBytes = 0) {\r\n    const addr = this.getBodyDataTexelCoords(bodyDescId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 16 // RGBA32 pixels == 16 bytes perpixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__size\r\n    // console.log(\"__seekSurfaceData:\" + bodyDescId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__reader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfacesForBody method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfacesForBody(bodyDescId) {\r\n    this.__seekBodyData(bodyDescId, 6 /* bbox*/ * bytesPerValue)\r\n    const numBodySurfaces = this.__reader.loadFloat32()\r\n    return numBodySurfaces\r\n  }\r\n\r\n  /**\r\n   * The getBodyBBox method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyBBox(bodyDescId) {\r\n    this.__seekBodyData(bodyDescId)\r\n    const bbox = new Box3()\r\n    bbox.p0 = this.__reader.loadFloat32Vec3()\r\n    bbox.p1 = this.__reader.loadFloat32Vec3()\r\n    return bbox\r\n  }\r\n\r\n  /**\r\n   * The getBodyDescData method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDescData(bodyDescId, includeXfosAndColors = true) {\r\n    this.__seekBodyData(bodyDescId)\r\n    // console.log(this.__reader.pos() / 8);\r\n\r\n    const bbox = new Box3()\r\n    bbox.p0 = this.__reader.loadFloat32Vec3()\r\n    bbox.p1 = this.__reader.loadFloat32Vec3()\r\n    // console.log(this.__reader.pos() / 8);\r\n    const numBodySurfaces = this.__reader.loadFloat32()\r\n    const numBodyCurves = this.__reader.loadFloat32()\r\n    const surfaceRefs = []\r\n    for (let j = 0; j < numBodySurfaces; j++) {\r\n      if (includeXfosAndColors) {\r\n        const surfaceRef = {\r\n          surfaceId: this.__reader.loadFloat32(),\r\n        }\r\n        surfaceRef.xfo = new Xfo(\r\n          this.__reader.loadFloat32Vec3(),\r\n          this.__reader.loadFloat32Quat(),\r\n          this.__reader.loadFloat32Vec3()\r\n        )\r\n        surfaceRef.color = this.__reader.loadRGBAFloat32Color()\r\n        surfaceRefs.push(surfaceRef)\r\n      } else {\r\n        surfaceRefs.push(this.__reader.loadFloat32())\r\n        this.__reader.advance(14 * 4)\r\n      }\r\n    }\r\n\r\n    const curveRefs = []\r\n    for (let j = 0; j < numBodyCurves; j++) {\r\n      if (includeXfosAndColors) {\r\n        const curveRef = {\r\n          curveId: this.__reader.loadFloat32(),\r\n        }\r\n        curveRef.xfo = new Xfo(\r\n          this.__reader.loadFloat32Vec3(),\r\n          this.__reader.loadFloat32Quat(),\r\n          this.__reader.loadFloat32Vec3()\r\n        )\r\n        curveRef.color = this.__reader.loadRGBAFloat32Color()\r\n        curveRefs.push(curveRef)\r\n      } else {\r\n        curveRefs.push(this.__reader.loadFloat32())\r\n        this.__reader.advance(14 * 4)\r\n      }\r\n    }\r\n\r\n    const bodyDescData = {\r\n      bbox,\r\n      surfaceRefs,\r\n      curveRefs,\r\n    }\r\n\r\n    return bodyDescData\r\n  }\r\n}\r\n\r\nexport { CADBodyLibrary }\r\n","import {\r\n  Color,\r\n  Box3,\r\n  MaterialParameter,\r\n  ColorParameter,\r\n  BaseGeomItem,\r\n  Material,\r\n  GeomItem,\r\n  TreeItem,\r\n  Registry,\r\n} from '@zeainc/zea-engine'\r\n\r\n/**\r\n * Represents a `BaseGeomItem` with the ability to have Cut Aways.\r\n *\r\n * @extends BaseGeomItem\r\n */\r\nclass CADBody extends BaseGeomItem {\r\n  /**\r\n   * Creates an instance of CADBody setting up the initial configuration for Material and Color parameters.\r\n   *\r\n   * @param {string} name - The name value.\r\n   * @param {CADAsset} cadAsset - The cadAsset value.\r\n   */\r\n  constructor(name, cadAsset) {\r\n    super(name)\r\n    this.__bodyDescId = -1\r\n    this.__id = -1\r\n    this.__bodyBBox = new Box3()\r\n    this.__cadAsset = cadAsset // Note: used in testing scenes.\r\n    if (this.__cadAsset) this.__cadAsset.incCADBodyCount()\r\n\r\n    this.__materialParam = this.addParameter(new MaterialParameter('Material'))\r\n    this.__colorParam = this.addParameter(new ColorParameter('Color', new Color(1, 0, 0, 0)))\r\n  }\r\n\r\n  /**\r\n   * Returns the `CADAsset` object in current `CADBody`\r\n   *\r\n   * @return {CADAsset} - The return value.\r\n   */\r\n  getCADAsset() {\r\n    return this.__cadAsset\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new CADBody, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {CADBody} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new CADBody()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  /**\r\n   * The copyFrom method.\r\n   * @param {CADBody} src - The src param.\r\n   * @param {number} flags - The flags param.\r\n   * @private\r\n   */\r\n  copyFrom(src, flags) {\r\n    super.copyFrom(src, flags)\r\n    this.__cadAsset = src.getCADAsset()\r\n    this.__cadAsset.incCADBodyCount()\r\n\r\n    this.setBodyDescId(src.getBodyDescId())\r\n    this.setMaterial(src.getMaterial()) // clone?\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Geometry\r\n\r\n  /**\r\n   * The getBodyDataTexelCoords method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDataTexelCoords() {\r\n    return this.__cadAsset.getBodyLibrary().getBodyDataTexelCoords(this.__bodyDescId)\r\n  }\r\n\r\n  /**\r\n   * Returns an object that contains the bBox and all the SurfaceRefs of current object using the bodyDescId.\r\n   * @private\r\n   * @return {object} - The return value.\r\n   */\r\n  getBodyDescData() {\r\n    const bodyDescData = this.__cadAsset.getBodyLibrary().getBodyDescData(this.__bodyDescId)\r\n    for (const surfaceRef of bodyDescData.surfaceRefs) {\r\n      surfaceRef.surfaceType = this.__cadAsset.getSurfaceLibrary().getSurfaceTypeLabel(surfaceRef.surfaceId)\r\n      surfaceRef.dims = this.__cadAsset.getSurfaceLibrary().getSurfaceDims(surfaceRef.surfaceId)\r\n    }\r\n    return bodyDescData\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all SurfaceRefs of current `CADBody`.\r\n   * <br>\r\n   * Which contain the surfaceId, xfo object and the color.\r\n   *\r\n   * @return {array} - The return value.\r\n   */\r\n  getSurfaceRefs() {\r\n    const bodyData = this.getBodyDescData()\r\n    return bodyData.surfaceRefs\r\n  }\r\n\r\n  /**\r\n   * Returns the bodyDescId of current `CADBody`\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getBodyDescId() {\r\n    return this.__bodyDescId\r\n  }\r\n\r\n  /**\r\n   * Sets bodyDescId to current `CADBody`, but also calculates a new bBox.\r\n   * @private\r\n   * @param {number} bodyId - The bodyId param.\r\n   */\r\n  setBodyDescId(bodyId) {\r\n    this.__bodyDescId = bodyId\r\n    this.__bodyBBox = this.__cadAsset.getBodyLibrary().getBodyBBox(this.__bodyDescId)\r\n    this._setBoundingBoxDirty()\r\n  }\r\n\r\n  /**\r\n   * Returns current Material parameter value.\r\n   * @deprecated\r\n   * @return {MaterialParameter} - The return value.\r\n   */\r\n  getMaterial() {\r\n    return this.__materialParam.getValue()\r\n  }\r\n\r\n  /**\r\n   * Sets Material parameter value.\r\n   * <br>\r\n   * For `mode` possible values check `Parameter` Class documentation.\r\n   * @see [Zea Engine]()\r\n   *\r\n   * @deprecated\r\n   * @param {MaterialParameter} material - The material param.\r\n   * @param {number} mode - The mode param.\r\n   */\r\n  setMaterial(material, mode) {\r\n    this.__materialParam.setValue(material, mode)\r\n  }\r\n\r\n  /**\r\n   * The _cleanBoundingBox method.\r\n   * @param {any} bbox - The bbox param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  _cleanBoundingBox(bbox) {\r\n    bbox = super._cleanBoundingBox(bbox)\r\n    if (this.__bodyDescId != -1) {\r\n      bbox.addBox3(this.__bodyBBox, this.getParameter('GlobalXfo').getValue())\r\n    }\r\n    return bbox\r\n  }\r\n\r\n  // ///////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Initializes CADBody's asset, material, version and layers; adding current `CADBody` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {object} context - The context param.\r\n   */\r\n  readBinary(reader, context) {\r\n    super.readBinary(reader, context)\r\n\r\n    // Cache only in debug mode.\r\n    this.__cadAsset = context.assetItem\r\n    this.__cadAsset.incCADBodyCount()\r\n\r\n    this.setBodyDescId(reader.loadUInt32())\r\n\r\n    if (context.versions['zea-cad'].compare([0, 0, 4]) < 0) {\r\n      const materialName = reader.loadStr()\r\n      // const materialName = 'Mat' + this.__bodyDescId;\r\n\r\n      const materialLibrary = context.assetItem.getMaterialLibrary()\r\n      let material = materialLibrary.getMaterial(materialName, false)\r\n      if (!material) {\r\n        // console.warn(\"Body :'\" + this.name + \"' Material not found:\" + materialName);\r\n        // material = materialLibrary.getMaterial('DefaultMaterial');\r\n\r\n        material = new Material(materialName, 'SimpleSurfaceShader')\r\n        material.getParameter('BaseColor').setValue(Color.random(0.25))\r\n        context.assetItem.getMaterialLibrary().addMaterial(material)\r\n      }\r\n      this.getParameter('Material').setValue(material)\r\n    }\r\n\r\n    if (context.versions['zea-cad'].compare([0, 0, 2]) >= 0 && context.versions['zea-cad'].compare([0, 0, 4]) < 0) {\r\n      this.__layers = reader.loadStrArray()\r\n      // console.log(\"Layers:\", this.__layers)\r\n      for (const layer of this.__layers) context.addGeomToLayer(this, layer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The generatePolygonMeshSurfaces method.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generatePolygonMeshSurfaces(lod = 0) {\r\n    const treeItem = new TreeItem(this.getName())\r\n\r\n    // const standardMaterial = new Material('surfaces', 'SimpleSurfaceShader');\r\n    // standardMaterial.getParameter('BaseColor').setValue(Color.random(0.4));\r\n\r\n    const bodyData = this.getBodyDescData()\r\n    bodyData.surfaceRefs.forEach((surfaceRef, surfaceIndex) => {\r\n      const mesh = this.__cadAsset.getSurfaceLibrary().generatePolygonSurface(surfaceRef.surfaceId, lod)\r\n      if (mesh) {\r\n        const geomItem = new GeomItem('Surface' + surfaceIndex + ':' + surfaceRef.surfaceId, mesh, mesh.material) // this.__material);// mesh.mat);\r\n        geomItem.getParameter('LocalXfo').setValue(surfaceRef.xfo)\r\n        treeItem.addChild(geomItem)\r\n      }\r\n    })\r\n    return treeItem\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generateHullGeometry() {\r\n    const treeItem = new TreeItem(this.getName())\r\n    const bodyData = this.getBodyDescData()\r\n    bodyData.surfaceRefs.forEach((surfaceRef, surfaceIndex) => {\r\n      const hull = this.__cadAsset.getSurfaceLibrary().generateHullGeometry(surfaceRef.surfaceId)\r\n      if (hull) {\r\n        const geomItem = new GeomItem('Hull' + surfaceIndex + ':' + surfaceRef.surfaceId, hull, hull.material)\r\n        geomItem.getParameter('LocalXfo').setValue(surfaceRef.xfo)\r\n        treeItem.addChild(geomItem)\r\n        return false\r\n      }\r\n    })\r\n    return treeItem\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - The return value.\r\n   */\r\n  toJSON(flags = 0) {\r\n    const j = super.toJSON(flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The j param.\r\n   * @param {number} flags - The flags param.\r\n   */\r\n  fromJSON(j, flags = 0) {\r\n    super.fromJSON(j, flags)\r\n  }\r\n}\r\n\r\nRegistry.register('CADBody', CADBody)\r\n\r\nexport { CADBody }\r\n","/* eslint-disable no-unused-vars */\r\nimport {\r\n  Vec2,\r\n  Vec3,\r\n  Color,\r\n  FilePathParameter,\r\n  BooleanParameter,\r\n  NumberParameter,\r\n  ColorParameter,\r\n  Vec3Parameter,\r\n  Version,\r\n  BinReader,\r\n  SystemDesc,\r\n  AssetItem,\r\n  TreeItem,\r\n  Registry,\r\n  resourceLoader,\r\n} from '@zeainc/zea-engine'\r\nimport { CADSurfaceLibrary } from './CADSurfaceLibrary.js'\r\nimport { CADTrimSetLibrary } from './CADTrimSetLibrary.js'\r\nimport { CADBodyLibrary } from './CADBodyLibrary.js'\r\nimport { CADBody } from './CADBody.js'\r\n\r\nconst cadFileExts = new RegExp('\\\\.(stp|step|jt|3dm|ifc|vlcad|zcad)$', 'i')\r\n\r\n// eslint-disable-next-line require-jsdoc\r\nfunction getLOD() {\r\n  const urlParams = new URLSearchParams(window.location.search)\r\n  if (urlParams.has('lod')) {\r\n    return Number.parseInt(urlParams.get('lod'))\r\n  }\r\n  let fileId = urlParams.get('file-id')\r\n  if (!fileId) {\r\n    fileId = window.location.toString()\r\n  }\r\n  let lod = window.localStorage.getItem(fileId + '_LOD')\r\n  if (window.localStorage.getItem(fileId + '_LOD')) {\r\n    lod = Number.parseInt(window.localStorage.getItem(fileId + '_LOD'))\r\n  } else {\r\n    switch (SystemDesc.deviceCategory) {\r\n      case 'Low':\r\n        lod = 1\r\n        break\r\n      case 'Medium':\r\n        lod = 2\r\n        break\r\n      case 'High':\r\n        lod = 3\r\n        break\r\n    }\r\n  }\r\n\r\n  return lod\r\n}\r\n\r\n/** Class representing a CAD asset.\r\n * @extends AssetItem\r\n */\r\nclass CADAsset extends AssetItem {\r\n  /**\r\n   * Create a CAD asset.\r\n   * @param {string} name - The name value.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n\r\n    this.__trimSetLibrary = new CADTrimSetLibrary()\r\n    this.__surfaceLibrary = new CADSurfaceLibrary(this, this.__trimSetLibrary)\r\n    this.__bodyLibrary = new CADBodyLibrary()\r\n    this.__atlasSize = new Vec2()\r\n    this.__numCADBodyItems = 0\r\n    this.__loaded = false\r\n\r\n    this.__datafileParam = this.addParameter(new FilePathParameter('DataFilePath'))\r\n    this.__datafileParam.on('valueChanged', () => {\r\n      this.loadDataFile()\r\n    })\r\n\r\n    this.addParameter(new BooleanParameter('Display Edges', true))\r\n    this.addParameter(new ColorParameter('Edge Color', new Color(0.1, 0.1, 0.1, 0.75)))\r\n\r\n    this.lod = getLOD()\r\n    this.curvatureToDetail = 0.5\r\n  }\r\n\r\n  /**\r\n   * Returns the loaded status of the AssetItem.\r\n   *\r\n   * @return {boolean} - Returns true if the asset has already loaded its data.\r\n   */\r\n  isLoaded() {\r\n    return this.__loaded\r\n  }\r\n\r\n  /**\r\n   * Returns `LOD` parameter value.\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getLOD() {\r\n    return Math.max(0, this.lod)\r\n  }\r\n\r\n  /**\r\n   * The incCADBodyCount method.\r\n   * @private\r\n   */\r\n  incCADBodyCount() {\r\n    this.__numCADBodyItems++\r\n  }\r\n\r\n  /**\r\n   * Returns the value of number CADBody items in the asset.\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getNumBodyItems() {\r\n    return this.__numCADBodyItems\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADSurfaceLibrary` object on current Asset\r\n   *\r\n   * @return {CADSurfaceLibrary} - The return value.\r\n   */\r\n  getSurfaceLibrary() {\r\n    return this.__surfaceLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADTrimSetLibrary` object of current Asset\r\n   *\r\n   * @return {CADTrimSetLibrary} - The return value.\r\n   */\r\n  getTrimSetLibrary() {\r\n    return this.__trimSetLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADBodyLibrary` object of current Asset\r\n   *\r\n   * @return {CADBodyLibrary} - The return value.\r\n   */\r\n  getBodyLibrary() {\r\n    return this.__bodyLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `MaterialLibrary` object of current Asset\r\n   *\r\n   * @return {MaterialLibrary} - The return value.\r\n   */\r\n  getMaterialLibrary() {\r\n    return this.__materials\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Returns the versioon of the data loaded by thie CADAsset.\r\n   *\r\n   * @return {string} - The return value.\r\n   */\r\n  getVersion() {\r\n    return this.cadfileversion\r\n  }\r\n\r\n  /**\r\n   * Initializes CADAsset's asset, material, version and layers; adding current `CADAsset` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {object} context - The context param.\r\n   */\r\n  readBinary(reader, context = {}) {\r\n    context.assetItem = this\r\n    this.__numCADBodyItems = 0\r\n\r\n    context.versions = {}\r\n    // const v = reader.loadUInt8()\r\n    // reader.seek(0)\r\n    // Note: the first char is str-len, so a change to the version string broke this code.\r\n    // TODO: Fix this without this huge assumption below.\r\n    // Note: previous non-semver only reached 7\r\n    // if (v < 10) {\r\n    //   const version = new Version()\r\n    //   version.patch = reader.loadUInt32()\r\n    //   context.versions['zea-cad'] = version\r\n    //   context.versions['zea-engine'] = version\r\n    //   context.cadSDK = \"SpatialIOP\";\r\n    // } else {\r\n    context.versions['zea-cad'] = new Version(reader.loadStr())\r\n    context.cadSDK = reader.loadStr()\r\n    // }\r\n    this.cadfileversion = context.versions['zea-cad']\r\n    console.log('Loading CAD File version:', this.cadfileversion, ' exported using SDK:', context.cadSDK)\r\n\r\n    const plcbs = [] // Post load callbacks.\r\n    context.resolvePath = (path, onSucceed, onFail) => {\r\n      if (!path) throw new Error('Path not specified')\r\n\r\n      // Note: Why not return a Promise here?\r\n      // Promise evaluation is always async, so\r\n      // all promises will be resolved after the current call stack\r\n      // has terminated. In our case, we want all paths\r\n      // to be resolved before the end of the function, which\r\n      // we can handle easily with callback functions.\r\n      try {\r\n        const item = this.resolvePath(path)\r\n        onSucceed(item)\r\n      } catch (e) {\r\n        // Some paths resolve to items generated during load,\r\n        // so push a callback to re-try after the load is complete.\r\n        plcbs.push(() => {\r\n          try {\r\n            const param = this.resolvePath(path)\r\n            onSucceed(param)\r\n          } catch (e) {\r\n            if (onFail) {\r\n              onFail()\r\n            } else {\r\n              throw new Error(e.message)\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n    context.addPLCB = plcb => plcbs.push(plcb)\r\n\r\n    super.readBinary(reader, context)\r\n\r\n    // Invoke all the post-load callbacks to resolve any\r\n    // remaning references.\r\n    for (const cb of plcbs) cb()\r\n  }\r\n\r\n  /**\r\n   * The loadDataFile method.\r\n   * @return {Promise} - The primise value.\r\n   * @private\r\n   */\r\n  loadDataFile() {\r\n    if (this.__loadPromise) return this.__loadPromise\r\n\r\n    this.__loadPromise = new Promise((resolve, reject) => {\r\n      const file = this.__datafileParam.getFileDesc()\r\n      if (!file) {\r\n        console.warn('CADAsset data file not found.')\r\n        return\r\n      }\r\n\r\n      const fileId = this.__datafileParam.getValue()\r\n\r\n      const loadBinary = entries => {\r\n        // let version = 0\r\n        const treeReader = new BinReader((entries.tree2 || entries.tree).buffer, 0, SystemDesc.isMobileDevice)\r\n\r\n        if (entries.bodies) {\r\n          this.__bodyLibrary.setBinaryBuffers(entries.bodiestoc.buffer, entries.bodies.buffer)\r\n        }\r\n\r\n        const name = this.getName()\r\n        this.readBinary(treeReader, {})\r\n\r\n        // Maintain the name provided by the user before loading.\r\n        if (name != '') this.setName(name)\r\n\r\n        const context = {\r\n          versions: {},\r\n        }\r\n        context.versions['zea-cad'] = this.getVersion()\r\n        context.versions['zea-engine'] = this.getEngineDataVersion()\r\n\r\n        if (entries.geoms) {\r\n          this.__geomLibrary.readBinaryBuffer(fileId, entries.geoms.buffer, context)\r\n        }\r\n\r\n        if (entries.trimSets) {\r\n          const trimSets = entries.trimSets || entries.trimsets || entries.trimSets2\r\n          const trimSetReader = new BinReader(trimSets.buffer, 0, SystemDesc.isMobileDevice)\r\n\r\n          this.__trimSetLibrary.setBinaryBuffer(trimSetReader, this.getVersion())\r\n        }\r\n\r\n        if (entries.curves) {\r\n          this.__surfaceLibrary.setBinaryBuffers(entries.curves.buffer, entries.surfaces.buffer, this.getVersion())\r\n        }\r\n\r\n        // console.log(this.__name, \" NumBaseItems:\", this.getNumBaseItems(), \" NumCADBodyItems:\", this.__numCADBodyItems)\r\n\r\n        if (this.__datafileLoaded) {\r\n          // GOTO: loadAssetJSON...\r\n          this.__datafileLoaded()\r\n        } else {\r\n          this.emit('loaded')\r\n        }\r\n        this.__loaded = true\r\n        resolve()\r\n      }\r\n\r\n      if (file.metadata && file.metadata.ConvertFile) {\r\n        let zcadFile\r\n        const zcadfileext = new RegExp('\\\\.(vlcad|zcad)$', 'i')\r\n        file.metadata.ConvertFile.map(metadataFile => {\r\n          if (zcadfileext.test(metadataFile.filename)) zcadFile = metadataFile\r\n        })\r\n        if (zcadFile) {\r\n          resourceLoader.loadURL(fileId, zcadFile.url, loadBinary)\r\n        } else {\r\n          console.warn('ConvertFile metadata contains no vla file.')\r\n        }\r\n      } else if (file.url) {\r\n        // Note: if setUrl was called on the FilePathParameter, then\r\n        // the file may to have an fiename.extension, and we must assume it is\r\n        // a zcad/vlcad file.\r\n        resourceLoader.loadUrl(fileId, file.url, loadBinary)\r\n      } else {\r\n        console.warn('CADAsset unable to load file:', file)\r\n      }\r\n    })\r\n\r\n    return this.__loadPromise\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - The return value.\r\n   */\r\n  toJSON(context, flags) {\r\n    const j = super.toJSON(context, flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The json object this item must decode.\r\n   * @param {object} context - The context param.\r\n   * @param {callback} onDone - The onDone param.\r\n   */\r\n  fromJSON(j, context, onDone) {\r\n    const loadAssetJSON = () => {\r\n      const flags = TreeItem.LoadFlags.LOAD_FLAG_LOADING_BIN_TREE_VALUES\r\n      super.fromJSON(j, context, flags, onDone)\r\n      context.decAsyncCount()\r\n\r\n      // If the asset is nested within a bigger asset, then\r\n      // this subtree can noow be flagged as loded(and added to the renderer);\r\n      if (!this.__loaded) {\r\n        this.emit('loaded')\r\n        this.__loaded = true\r\n      }\r\n    }\r\n\r\n    if (j.params && j.params.DataFilePath) {\r\n      this.__datafileLoaded = loadAssetJSON\r\n      context.incAsyncCount()\r\n      const filePathJSON = j.params.DataFilePath\r\n      delete j.params.DataFilePath\r\n      this.__datafileParam.fromJSON(filePathJSON, context)\r\n    } else {\r\n      loadAssetJSON()\r\n    }\r\n  }\r\n\r\n  // ////////////////////////////////////////////////////\r\n  // Debugging\r\n\r\n  /**\r\n   * The generatePolygonMeshSurfaces method.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generatePolygonMeshSurfaces(lod = 0) {\r\n    // Traverse the tree adding items till we hit the leaves(which are usually GeomItems.)\r\n    // let count = 0\r\n    const surfacesTreeItem = new TreeItem('surfaces')\r\n    const traverse = treeItem => {\r\n      treeItem.getChildren().forEach(childItem => {\r\n        if (childItem instanceof CADBody) {\r\n          const cadBodySurfaces = childItem.generatePolygonMeshSurfaces(lod)\r\n          const globalXfo = childItem.getParameter('GlobalXfo').getValue()\r\n          cadBodySurfaces.getParameter('GlobalXfo').setValue(globalXfo)\r\n          surfacesTreeItem.addChild(cadBodySurfaces)\r\n        } else traverse(childItem)\r\n      })\r\n    }\r\n    traverse(this)\r\n\r\n    surfaceLibrary.logFormfactors()\r\n    return surfacesTreeItem\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generateHullGeometry() {\r\n    // Traverse the tree adding items till we hit the leaves(which are usually GeomItems.)\r\n    // let count = 0\r\n    const hullTreeItem = new TreeItem('hull')\r\n    const traverse = treeItem => {\r\n      treeItem.getChildren().forEach(childItem => {\r\n        if (childItem instanceof CADBody) {\r\n          const cadBodyHulls = childItem.generateHullGeometry()\r\n          const globalXfo = childItem.getParameter('GlobalXfo').getValue()\r\n          hullTreeItem.getParameter('GlobalXfo').setValue(globalXfo)\r\n          hullTreeItem.addChild(cadBodyHulls)\r\n        } else traverse(childItem)\r\n      })\r\n    }\r\n    traverse(this)\r\n\r\n    surfaceLibrary.logFormfactors()\r\n    return hullTreeItem\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Static Methods\r\n\r\n  /**\r\n   * Getter for LOADSTATE.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  static get LOADSTATE() {\r\n    return LOADSTATE\r\n  }\r\n\r\n  /**\r\n   * The supportsExt method.\r\n   * @param {any} filename - The filename param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  static supportsExt(filename) {\r\n    return cadFileExts.test(filename)\r\n  }\r\n}\r\n\r\nRegistry.register('CADAsset', CADAsset)\r\n\r\nexport { CADAsset }\r\n","import { TreeItem, Registry } from '@zeainc/zea-engine'\r\n\r\n/**\r\n * Represents a Tree Item of an Assembly modeling. Brings together components to define a larger product.\r\n *\r\n * @extends TreeItem\r\n */\r\nclass CADAssembly extends TreeItem {\r\n  /**\r\n   * Create a CAD assembly.\r\n   *\r\n   * @param {string} name - The name of the tree item.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new CADAssembly item, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {CADAssembly} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new CADAssembly()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - Returns the json object.\r\n   */\r\n  toJSON(context, flags = 0) {\r\n    const j = super.toJSON(context, flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The json object this item must decode.\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   */\r\n  fromJSON(j, context, flags = 0) {\r\n    super.fromJSON(j, context, flags)\r\n  }\r\n}\r\n\r\nRegistry.register('CADAssembly', CADAssembly)\r\n\r\nexport { CADAssembly }\r\n","import { Lines, Mesh, GLMesh, GLLines, Plane } from '@zeainc/zea-engine'\r\n\r\nimport { drawShaderAttribsStride } from './CADConstants.js'\r\n\r\n/** This class abstracts the rendering of a collection of geometries to screen.\r\n * @extends Lines\r\n * @ignore\r\n */\r\nclass SurfaceNormals extends Lines {\r\n  /**\r\n   * Create surface normals.\r\n   * @param {number} u - The u value.\r\n   * @param {number} v - The v value.\r\n   */\r\n  constructor(u, v) {\r\n    super()\r\n    this.setNumSegments(u * v)\r\n    this.setNumVertices(u * v * 2)\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i < v; i++) {\r\n      const y = i / (v - 1) - 0.5\r\n      for (let j = 0; j < u; j++) {\r\n        const x = j / (u - 1) - 0.5\r\n        const id = i * u + j\r\n        positions.getValueRef(id * 2).set(x, y, 0.0)\r\n        positions.getValueRef(id * 2 + 1).set(x, y, 1.0)\r\n        this.setSegmentVertexIndices(id, id * 2, id * 2 + 1)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a fan.\r\n * @extends Mesh\r\n * @ignore\r\n */\r\nclass Fan extends Mesh {\r\n  /**\r\n   * Create a fan.\r\n   * @param {any} vertexCount - The vertexCount value.\r\n   */\r\n  constructor(vertexCount) {\r\n    super()\r\n    this.setNumVertices(vertexCount)\r\n    const faceCount = vertexCount - 2\r\n    this.setFaceCounts([faceCount])\r\n\r\n    // ////////////////////////////\r\n    // build the topology\r\n    for (let j = 0; j < faceCount; j++) {\r\n      this.setFaceVertexIndices(j, [0, j + 1, j + 2])\r\n    }\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i < vertexCount; i++) {\r\n      // Note: the 'x,y' values are used as uv coords\r\n      // to look up the actual vertex values in the texture.\r\n      // (with a 0.5, 0.5 offset)\r\n      positions.getValueRef(i).set(i / vertexCount - 0.5, -0.5, 0.0)\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a sub set.\r\n * @ignore\r\n */\r\nclass SubSet {\r\n  /**\r\n   * Create a sub set.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    this.__gl = gl\r\n    this.__drawCoordsArray = null\r\n    this.__drawCoordsBuffer = null\r\n    this.__drawCount = 0 // The number of visible drawn geoms.\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, type, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  setDrawItems(itemsArray) {\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, itemsArray, gl.STATIC_DRAW)\r\n    this.__drawCount = itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  addDrawItems(itemsArray) {\r\n    // console.log(\"addDrawItems:\" + itemsArray);\r\n    if (!this.__drawCoordsArray) {\r\n      this.__drawCoordsArray = itemsArray\r\n    } else {\r\n      const new_Array = new Float32Array(this.__drawCoordsArray.length + itemsArray.length)\r\n      new_Array.set(this.__drawCoordsArray)\r\n      new_Array.set(itemsArray, this.__drawCoordsArray.length)\r\n      this.__drawCoordsArray = new_Array\r\n    }\r\n\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.__drawCoordsArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount += itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDrawCount() {\r\n    return this.__drawCount\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (this.__drawCount == 0) {\r\n      return 0\r\n    }\r\n\r\n    const gl = this.__gl\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n\r\n    const attrs = renderstate.attrs\r\n    this.__bindAttr(attrs.drawCoords.location, 4, gl.FLOAT, drawShaderAttribsStride * 4, 0)\r\n    // this.__bindAttr(attrs.drawItemTexAddr.location, 2, gl.FLOAT, drawShaderAttribsStride * 4, 4 * 4)\r\n\r\n    return this.__drawCount\r\n  }\r\n\r\n  destroy() {\r\n    const gl = this.__gl\r\n    gl.deleteBuffer(this.__drawCoordsBuffer)\r\n    this.__drawCoordsBuffer = null\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL surface draw set.\r\n * @ignore\r\n */\r\nclass GLSurfaceDrawSet {\r\n  /**\r\n   * Create a GL surface draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {number} x - The x value.\r\n   * @param {number} y - The y value.\r\n   */\r\n  constructor(gl, x, y) {\r\n    // console.log(\"GLSurfaceDrawSet:\" + x + \",\" + y)\r\n    this.__gl = gl\r\n\r\n    if (x == 0 || y == 0) console.error('invalid GLSurfaceDrawSet:' + x + ',' + y)\r\n\r\n    if (y == 1) {\r\n      const key = x\r\n      if (!__cache[key]) {\r\n        __cache[key] = new GLMesh(gl, new Fan(x))\r\n      }\r\n      this.__glgeom = __cache[key]\r\n      this.__numTris = x - 2\r\n      this.__glnormalsgeom = new GLLines(gl, new SurfaceNormals(x, y))\r\n\r\n      this.key = key\r\n    } else {\r\n      const key = x + 'x' + y\r\n      if (!__cache[key]) {\r\n        __cache[key] = new GLMesh(gl, new Plane(1.0, 1.0, x - 1, y - 1))\r\n      }\r\n      this.__glgeom = __cache[key]\r\n      this.__numTris = (x - 1) * (y - 1) * 2\r\n      this.__glnormalsgeom = new GLLines(gl, new SurfaceNormals(x, y))\r\n\r\n      this.key = key\r\n    }\r\n    this.__quadDetail = [x - 1, y - 1]\r\n    this.__freeIndices = []\r\n    this.__subSets = {}\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  setDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    const drawCount = this.__subSets[key].setDrawItems(itemsArray)\r\n    return this.__numTris * drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    const drawCount = this.__subSets[key].addDrawItems(itemsArray)\r\n    // console.log(this.key, \"key:\", key, drawCount)\r\n\r\n    return this.__numTris * drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @param {any} key - The key param.\r\n   * @return {number} - The return value.\r\n   */\r\n  getDrawCount(key) {\r\n    if (this.__subSets[key]) return this.__subSets[key].getDrawCount()\r\n    return 0\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  draw(renderstate, key) {\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.quadDetail) {\r\n      gl.uniform2i(unifs.quadDetail.location, this.__quadDetail[0], this.__quadDetail[1])\r\n    }\r\n\r\n    this.__glgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glgeom.drawInstanced(drawCount)\r\n\r\n      // To debug the mesh topology we can render as lines instead.\r\n      // gl.drawElementsInstanced(\r\n      //   this.__glgeom.__gl.LINES,\r\n      //   this.__glgeom.__numTriIndices,\r\n      //   this.__glgeom.__indexDataType,\r\n      //   0,\r\n      //   drawCount\r\n      // )\r\n    })\r\n  }\r\n\r\n  /**\r\n   * The drawNormals method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  drawNormals(renderstate, key) {\r\n    if (!this.__glnormalsgeom) return\r\n\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.quadDetail) {\r\n      gl.uniform2i(unifs.quadDetail.location, this.__quadDetail[0], this.__quadDetail[1])\r\n    }\r\n\r\n    this.__glnormalsgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glnormalsgeom.drawInstanced(drawCount)\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    // Note:  this.__glgeom is shared between all GLCADAssets using a global cache. See above\r\n    // this.__glgeom.destroy()\r\n\r\n    if (this.__glnormalsgeom) this.__glnormalsgeom.destroy()\r\n\r\n    for (const key in this.__subSets) {\r\n      let subSet = this.__subSets[key]\r\n      subSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLSurfaceDrawSet }\r\n","import { Lines, GLLines } from '@zeainc/zea-engine'\r\nimport { drawShaderAttribsStride } from './CADConstants.js'\r\n\r\n/** Class representing an Edge\r\n * @private\r\n */\r\nclass Edge extends Lines {\r\n  /**\r\n   * Create a strip.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super()\r\n    this.setNumVertices(detail + 1)\r\n    this.setNumSegments(detail)\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i <= detail; i++) {\r\n      if (i < detail) this.setSegmentVertexIndices(i, i, i + 1)\r\n      // Note: the 'x,y' values are used as uv coords\r\n      // to look up the actual vertex values in the texture.\r\n      // (with a 0.5, 0.5 offset)\r\n      positions.getValueRef(i).set(i / detail, 0.0, 0.0)\r\n    }\r\n    this.emit('geomDataTopologyChanged')\r\n  }\r\n}\r\n\r\n/** Class representing a sub set.\r\n * @private\r\n */\r\nclass SubSet {\r\n  /**\r\n   * Create a sub set.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    this.__gl = gl\r\n    this.__drawCoordsArray = null\r\n    this.__drawCoordsBuffer = null\r\n    this.__drawCount = 0 // The number of visible drawn geoms.\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, type, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  setDrawItems(itemsArray) {\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, itemsArray, gl.STATIC_DRAW)\r\n    this.__drawCount = itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  addDrawItems(itemsArray) {\r\n    // console.log(\"addDrawItems:\" + itemsArray);\r\n    if (!this.__drawCoordsArray) {\r\n      this.__drawCoordsArray = itemsArray\r\n    } else {\r\n      const new_Array = new Float32Array(this.__drawCoordsArray.length + itemsArray.length)\r\n      new_Array.set(this.__drawCoordsArray)\r\n      new_Array.set(itemsArray, this.__drawCoordsArray.length)\r\n      this.__drawCoordsArray = new_Array\r\n    }\r\n\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.__drawCoordsArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount += itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDrawCount() {\r\n    return this.__drawCount\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (this.__drawCount == 0) {\r\n      return 0\r\n    }\r\n    const gl = this.__gl\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n\r\n    const attrs = renderstate.attrs\r\n    this.__bindAttr(attrs.drawCoords.location, 4, gl.FLOAT, drawShaderAttribsStride * 4, 0)\r\n    // this.__bindAttr(attrs.drawItemTexAddr.location, 2, gl.FLOAT, drawShaderAttribsStride * 4, 4 * 4)\r\n\r\n    return this.__drawCount\r\n  }\r\n\r\n  destroy() {\r\n    const gl = this.__gl\r\n    gl.deleteBuffer(this.__drawCoordsBuffer)\r\n    this.__drawCoordsBuffer = null\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL surface draw set.\r\n * @private\r\n */\r\nclass GLCurveDrawSet {\r\n  /**\r\n   * Create a GL surface draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {number} x - The x value.\r\n   * @param {number} y - The y value.\r\n   */\r\n  constructor(gl, detail) {\r\n    // console.log(\"GLCurveDrawSet:\" + x + \",\" + y)\r\n    this.__gl = gl\r\n\r\n    if (detail == 0) console.error('invalid GLCurveDrawSet:' + detail)\r\n\r\n    if (!__cache[detail]) {\r\n      __cache[detail] = new GLLines(gl, new Edge(detail))\r\n    }\r\n    this.key = detail\r\n    this.__glgeom = __cache[detail]\r\n    this.__edgeDetail = detail\r\n    this.__freeIndices = []\r\n    this.__subSets = {}\r\n    this.__numDrawItems = 0\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  setDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    this.__subSets[key].setDrawItems(itemsArray)\r\n\r\n    this.__numDrawItems += itemsArray.length / 2\r\n    return this.__numDrawItems\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    this.__numDrawItems += this.__subSets[key].addDrawItems(itemsArray)\r\n    // console.log(this.key, \"key:\", key, this.__numDrawItems)\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @param {any} key - The key param.\r\n   * @return {number} - The return value.\r\n   */\r\n  getDrawCount(key) {\r\n    if (this.__subSets[key]) return this.__subSets[key].getDrawCount()\r\n    return 0\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  draw(renderstate, key) {\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.edgeDetail) {\r\n      gl.uniform1i(unifs.edgeDetail.location, this.__edgeDetail)\r\n    }\r\n\r\n    this.__glgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glgeom.drawInstanced(drawCount)\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    // Note:  this.__glgeom is shared between all GLCADAssets using a global cache. See above\r\n    // this.__glgeom.destroy()\r\n\r\n    if (this.__glnormalsgeom) this.__glnormalsgeom.destroy()\r\n\r\n    for (const key in this.__subSets) {\r\n      let subSet = this.__subSets[key]\r\n      subSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCurveDrawSet }\r\n","import { GLTexture2D, GLRenderTarget } from '@zeainc/zea-engine'\r\nimport { valuesPerCurveLibraryLayoutItem } from './CADConstants.js'\r\n\r\n/** Class representing a GL curve library.\r\n * @ignore\r\n */\r\nclass GLCurveLibrary {\r\n  /**\r\n   * Create a GL curve library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} surfacesLibrary - The surfacesLibrary value.\r\n   * @param {any} version - The version object.\r\n   */\r\n  constructor(gl, cadpassdata, surfacesLibrary, version) {\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__surfacesLibrary = surfacesLibrary\r\n    this.cadDataVersion = version\r\n\r\n    const curvesDataBuffer = this.__surfacesLibrary.getCurveBuffer()\r\n    const curveTexSize = Math.sqrt(curvesDataBuffer.byteLength / 8)\r\n\r\n    if (this.__cadpassdata.convertTo8BitTextures) {\r\n      this.__curveDataTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'UNSIGNED_BYTE',\r\n        width: curveTexSize * 2,\r\n        height: curveTexSize,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: new Uint8Array(curvesDataBuffer),\r\n      })\r\n    } else {\r\n      this.__curveDataTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'HALF_FLOAT',\r\n        width: curveTexSize,\r\n        height: curveTexSize,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: new Uint16Array(curvesDataBuffer),\r\n      })\r\n    }\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Curves\r\n\r\n  /**\r\n   * The evaluateCurves method.\r\n   * @param {any} curvesAtlasLayout - The curvesAtlasLayout param.\r\n   * @param {any} numCurves - The numCurves param.\r\n   * @param {any} curvesAtlasLayoutTextureSize - The curvesAtlasLayoutTextureSize param.\r\n   * @param {any} curvesAtlasTextureDim - The curvesAtlasTextureDim param.\r\n   */\r\n  evaluateCurves(curvesAtlasLayout, numCurves, curvesAtlasLayoutTextureSize, curvesAtlasTextureDim) {\r\n    // console.log(\"evaluateCurves:\" + assetId + \":\" + curvesAtlasTextureDim);\r\n\r\n    const count = numCurves\r\n    if (count == 0) return\r\n\r\n    const gl = this.__gl\r\n    {\r\n      this.__curveAtlasLayoutTexture = new GLTexture2D(this.__gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasLayoutTextureSize[0],\r\n        height: curvesAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: curvesAtlasLayout,\r\n      })\r\n    }\r\n\r\n    if (!this.__curvesAtlasRenderTarget) {\r\n      this.__curvesAtlasRenderTarget = new GLRenderTarget(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasTextureDim[0],\r\n        height: curvesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__curvesTangentAtlasRenderTarget = new GLRenderTarget(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasTextureDim[0],\r\n        height: curvesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n    } else if (\r\n      this.__curvesAtlasRenderTarget.width != curvesAtlasTextureDim[0] ||\r\n      this.__curvesAtlasRenderTarget.height != curvesAtlasTextureDim[1]\r\n    ) {\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__curvesAtlasRenderTarget.resize(curvesAtlasTextureDim[0], curvesAtlasTextureDim[1], true)\r\n    }\r\n\r\n    const renderstate = {}\r\n    this.__curvesAtlasRenderTarget.bindForWriting(renderstate, true)\r\n\r\n    if (this.cadDataVersion.compare([0, 0, 0]) > 0) {\r\n      renderstate.shaderopts = Object.assign({}, gl.shaderopts)\r\n      renderstate.shaderopts.defines = renderstate.shaderopts.defines + '#define EXPORT_KNOTS_AS_DELTAS 1'\r\n    }\r\n    if (this.cadDataVersion.compare([0, 0, 26]) > 0) {\r\n      renderstate.shaderopts.defines = renderstate.shaderopts.defines + '#define INTS_PACKED_AS_2FLOAT16 1'\r\n    }\r\n    if (this.__cadpassdata.convertTo8BitTextures) {\r\n      renderstate.shaderopts = Object.assign({}, gl.shaderopts)\r\n      renderstate.shaderopts.frag = Object.assign({}, gl.shaderopts.frag)\r\n      renderstate.shaderopts.frag.defines = '#define DECODE_16BIT_FLOAT_FROM_8BIT_INT 1\\n'\r\n    }\r\n\r\n    this.__cadpassdata.evaluateCurveShader.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.uniform2i(\r\n      unifs.curvesAtlasTextureSize.location,\r\n      this.__curvesAtlasRenderTarget.width,\r\n      this.__curvesAtlasRenderTarget.height\r\n    )\r\n\r\n    this.__curveDataTexture.bindToUniform(renderstate, unifs.curveDataTexture)\r\n    gl.uniform2i(unifs.curveDataTextureSize.location, this.__curveDataTexture.width, this.__curveDataTexture.height)\r\n\r\n    const buffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, curvesAtlasLayout, gl.STATIC_DRAW)\r\n\r\n    this.__bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, valuesPerCurveLibraryLayoutItem * 4, 0)\r\n    this.__bindAttr(attrs.curveDataCoords.location, 2, gl.FLOAT, valuesPerCurveLibraryLayoutItem * 4, 4 * 4)\r\n\r\n    // //////////////////////////////////////////////\r\n    // Bind each Fbo and render separately.\r\n    // Bizzarly, this has turned out to be much faster\r\n    // than using mutiple render targets...\r\n    gl.uniform1i(unifs.writeTangents.location, 0)\r\n\r\n    this.__cadpassdata.glplanegeom.drawInstanced(count)\r\n\r\n    this.__curvesTangentAtlasRenderTarget.bindForWriting(renderstate, true)\r\n\r\n    gl.uniform1i(unifs.writeTangents.location, 1)\r\n    this.__cadpassdata.glplanegeom.drawInstanced(count)\r\n    // //////////////////////////////////////////////\r\n\r\n    gl.deleteBuffer(buffer)\r\n\r\n    const logCurveData = curveId => {\r\n      this.__curvesAtlasRenderTarget.bindForReading()\r\n      const layout = [\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 0],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 1],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 2],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 3],\r\n      ]\r\n      console.log('----------------------------------')\r\n      console.log('logCurveData ' + curveId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3])\r\n      const pixels = new Float32Array(layout[2] * 4)\r\n      for (let i = 0; i < layout[3]; i++) {\r\n        gl.readPixels(layout[0], layout[1] + i, layout[2], 1, gl.RGBA, gl.FLOAT, pixels)\r\n        for (let j = 0; j < layout[2]; j++) {\r\n          console.log(j, ':', pixels[j * 4 + 0], pixels[j * 4 + 1], pixels[j * 4 + 2], pixels[j * 4 + 3])\r\n        }\r\n        // console.log(i+\":\" + pixels);\r\n      }\r\n    }\r\n    // console.log(\"----------------------------------\");\r\n    // logCurveData(35799)\r\n    // logCurveData(1)\r\n    // console.log(\"----------------------------------\");\r\n\r\n    this.__curvesTangentAtlasRenderTarget.unbind()\r\n    gl.finish()\r\n  }\r\n\r\n  /**\r\n   * The bindCurvesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindCurvesAtlasLayout(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (this.__curvesAtlasRenderTarget) {\r\n      if (unifs.curvesAtlasLayoutTexture) {\r\n        this.__curveAtlasLayoutTexture.bindToUniform(renderstate, unifs.curvesAtlasLayoutTexture)\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasLayoutTextureSize.location,\r\n          this.__curveAtlasLayoutTexture.width,\r\n          this.__curveAtlasLayoutTexture.height\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindCurvesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindCurvesAtlas(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (this.__curvesAtlasRenderTarget) {\r\n      this.__curvesAtlasRenderTarget.bindColorTexture(renderstate, unifs.curvesAtlasTexture)\r\n\r\n      if (unifs.curveTangentsTexture) {\r\n        this.__curvesTangentAtlasRenderTarget.bindColorTexture(renderstate, unifs.curveTangentsTexture)\r\n      }\r\n      if (unifs.curvesAtlasTextureSize) {\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasTextureSize.location,\r\n          this.__curvesAtlasRenderTarget.width,\r\n          this.__curvesAtlasRenderTarget.height\r\n        )\r\n      }\r\n\r\n      if (unifs.curvesAtlasLayoutTexture) {\r\n        this.__curveAtlasLayoutTexture.bindToUniform(renderstate, unifs.curvesAtlasLayoutTexture)\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasLayoutTextureSize.location,\r\n          this.__curveAtlasLayoutTexture.width,\r\n          this.__curveAtlasLayoutTexture.height\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__curveDataTexture.destroy()\r\n    if (this.__curveAtlasLayoutTexture) {\r\n      this.__curveAtlasLayoutTexture.destroy()\r\n      this.__curvesAtlasRenderTarget.destroy()\r\n      this.__curvesTangentAtlasRenderTarget.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCurveLibrary }\r\n","// import {\r\n//     Vec2,\r\n//     Vec3,\r\n//     Quat,\r\n//     Color,\r\n//     Box2,\r\n//     Box3\r\n// } from '../Math';\r\n\r\nconst decode16BitFloat = h => {\r\n  const s = (h & 0x8000) >> 15\r\n  const e = (h & 0x7c00) >> 10\r\n  const f = h & 0x03ff\r\n\r\n  if (e == 0) {\r\n    return (s ? -1 : 1) * Math.pow(2, -14) * (f / Math.pow(2, 10))\r\n  } else if (e == 0x1f) {\r\n    return f ? NaN : (s ? -1 : 1) * Infinity\r\n  }\r\n\r\n  return (s ? -1 : 1) * Math.pow(2, e - 15) * (1 + f / Math.pow(2, 10))\r\n}\r\n\r\n/** Class representing a bin reader. \r\n * @ignore\r\n*/\r\nclass BinReader {\r\n  /**\r\n   * Create a bin reader.\r\n   * @param {Buffer} data - The data buffer.\r\n   * @param {number} byteOffset - The byte offset value to start reading the buffer.\r\n   * @param {boolean} isMobileDevice - The isMobileDevice value.\r\n   */\r\n  constructor(data, byteOffset = 0, isMobileDevice = true) {\r\n    this.__data = data\r\n    this.__byteOffset = byteOffset\r\n    this.__dataView = new DataView(this.__data)\r\n    this.__isMobileDevice = isMobileDevice\r\n    this.utf8decoder = new TextDecoder()\r\n  }\r\n\r\n  /**\r\n   * Getter for isMobileDevice.\r\n   * @return {Boolean} - Returns true is a mobile device is detected.\r\n   */\r\n  get isMobileDevice() {\r\n    return this.__isMobileDevice\r\n  }\r\n\r\n  /**\r\n   * Getter for data.\r\n   * @return {Buffer} - The data buffer we are reading from,\r\n   */\r\n  get data() {\r\n    return this.__data\r\n  }\r\n\r\n  /**\r\n   * Getter for byteLength.\r\n   * @return {number} - The total length of the buffer\r\n   */\r\n  get byteLength() {\r\n    return this.__dataView.byteLength\r\n  }\r\n\r\n  /**\r\n   * Getter for remainingByteLength.\r\n   * @return {number} - The reemaining length of the buffer to read.\r\n   */\r\n  get remainingByteLength() {\r\n    return this.__dataView.byteLength - this.__byteOffset\r\n  }\r\n\r\n  /**\r\n   * The pos method.\r\n   * @return {number} - The current offset in the binary buffer\r\n   */\r\n  pos() {\r\n    return this.__byteOffset\r\n  }\r\n\r\n  /**\r\n   * The seek method.\r\n   * @param {number} byteOffset - The byteOffset param.\r\n   */\r\n  seek(byteOffset) {\r\n    this.__byteOffset = byteOffset\r\n  }\r\n\r\n  /**\r\n   * The advance method.\r\n   * @param {number} byteOffset - The byte Offset amount.\r\n   */\r\n  advance(byteOffset) {\r\n    this.__byteOffset += byteOffset\r\n  }\r\n\r\n  /**\r\n   * The loadUInt8 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt8() {\r\n    const result = this.__dataView.getUint8(this.__byteOffset)\r\n    this.__byteOffset += 1\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt16 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt16() {\r\n    const result = this.__dataView.getUint16(this.__byteOffset, true)\r\n    this.__byteOffset += 2\r\n    return result\r\n  }\r\n\r\n\r\n  /**\r\n   * The loadUInt32 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt32() {\r\n    const result = this.__dataView.getUint32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadSInt32 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadSInt32() {\r\n    const result = this.__dataView.getInt32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat16 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadFloat16() {\r\n    const uint16 = this.loadUInt16()\r\n    return decode16BitFloat(uint16)\r\n  }\r\n\r\n  /**\r\n   * The loadUFloat16 returns a float where the sign big indicates it is > 201.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUFloat16() {\r\n    const result = this.loadFloat16()\r\n    if (result < 0.0) {\r\n      return 2048.0 - result // Note: subtract a negative number to add it.\r\n    } else {\r\n      return result\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The loadFloat16From2xUInt8 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadFloat16From2xUInt8() {\r\n    const result = this.__dataView.getFloat16(this.__byteOffset, true)\r\n    // const uint8s = this.loadUInt8Array(2);\r\n    // return decode16BitFloat(uint8s);\r\n    this.__byteOffset += 2\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt32From2xUFloat16 loads a single Signed integer value from 2 Unsigned Float16 values.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt32From2xUFloat16() {\r\n    const partA = this.loadUFloat16()\r\n    const partB = this.loadUFloat16()\r\n    return partA + partB * 4096\r\n  }\r\n\r\n  /**\r\n   * The loadSInt32From2xFloat16 loads a single Signed integer value from 2 signed Float16 values.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadSInt32From2xFloat16() {\r\n    const partA = this.loadFloat16()\r\n    const partB = this.loadFloat16()\r\n    return partA + partB * 2048\r\n  }\r\n\r\n\r\n  /**\r\n   * The loadFloat32 method.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadFloat32() {\r\n    const result = this.__dataView.getFloat32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat32 method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt8Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    const result = new Uint8Array(this.__data, this.__byteOffset, size)\r\n    this.__byteOffset += size\r\n    const padd = this.__byteOffset % 4\r\n    // this.readPadd();\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt16Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt16Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Uint16Array()\r\n    this.readPadd(2)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Uint16Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getUint16(this.__byteOffset, true)\r\n        this.__byteOffset += 2\r\n      }\r\n    } else {\r\n      result = new Uint16Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 2\r\n    }\r\n    // this.readPadd();\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt32Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt32Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Uint32Array()\r\n    this.readPadd(4)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Uint32Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getUint32(this.__byteOffset, true)\r\n        this.__byteOffset += 4\r\n      }\r\n    } else {\r\n      result = new Uint32Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 4\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat32Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadFloat32Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Float32Array()\r\n    this.readPadd(4)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Float32Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getFloat32(this.__byteOffset, true)\r\n        this.__byteOffset += 4\r\n      }\r\n    } else {\r\n      result = new Float32Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 4\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadStr method.\r\n   * @return {string} - The return value.\r\n   */\r\n  loadStr() {\r\n    const numChars = this.loadUInt32()\r\n    const chars = new Uint8Array(this.__data, this.__byteOffset, numChars)\r\n    this.__byteOffset += numChars\r\n    let result = ''\r\n    for (let i = 0; i < numChars; i++)\r\n      result = result + String.fromCharCode(chars[i])\r\n    return result\r\n  }\r\n\r\n  /**\r\n    * The loadStrArray method.\r\n    * @return {array} - The return value.\r\n    */\r\n   loadStrArray() {\r\n    const size = this.loadUInt32()\r\n    const result = []\r\n    for (let i = 0; i < size; i++) {\r\n      result[i] = this.loadStr()\r\n    }\r\n    return result\r\n  }\r\n\r\n  // loadSInt32Vec2() {\r\n  //     const x = this.loadSInt32();\r\n  //     const y = this.loadSInt32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadUInt32Vec2() {\r\n  //     const x = this.loadUInt32();\r\n  //     const y = this.loadUInt32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat16Vec2() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat32Vec2() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat16Vec3() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     const z = this.loadFloat16();\r\n  //     return new Vec3(x, y, z);\r\n  // }\r\n\r\n  // loadFloat32Vec3() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     const z = this.loadFloat32();\r\n  //     return new Vec3(x, y, z);\r\n  // }\r\n\r\n  // loadFloat16Quat() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     const z = this.loadFloat16();\r\n  //     const w = this.loadFloat16();\r\n  //     return new Quat(x, y, z, w);\r\n  // }\r\n\r\n  // loadFloat32Quat() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     const z = this.loadFloat32();\r\n  //     const w = this.loadFloat32();\r\n  //     return new Quat(x, y, z, w);\r\n  // }\r\n\r\n  // loadRGBFloat32Color() {\r\n  //     const r = this.loadFloat32();\r\n  //     const g = this.loadFloat32();\r\n  //     const b = this.loadFloat32();\r\n  //     return new Color(r, g, b);\r\n  // }\r\n\r\n  // loadRGBAFloat32Color() {\r\n  //     const r = this.loadFloat32();\r\n  //     const g = this.loadFloat32();\r\n  //     const b = this.loadFloat32();\r\n  //     const a = this.loadFloat32();\r\n  //     return new Color(r, g, b, a);\r\n  // }\r\n\r\n  // loadRGBUInt8Color() {\r\n  //     const r = this.loadUInt8();\r\n  //     const g = this.loadUInt8();\r\n  //     const b = this.loadUInt8();\r\n  //     return new Color(r / 255, g / 255, b / 255);\r\n  // }\r\n\r\n  // loadRGBAUInt8Color() {\r\n  //     const r = this.loadUInt8();\r\n  //     const g = this.loadUInt8();\r\n  //     const b = this.loadUInt8();\r\n  //     const a = this.loadUInt8();\r\n  //     return new Color(r / 255, g / 255, b / 255, a / 255);\r\n  // }\r\n\r\n  // loadBox2() {\r\n  //     return new Box2(this.loadFloat32Vec2(), this.loadFloat32Vec2());\r\n  // }\r\n\r\n  // loadBox3() {\r\n  //     return new Box3(this.loadFloat32Vec3(), this.loadFloat32Vec3());\r\n  // }\r\n\r\n  /**\r\n   * The loadStr method.\r\n   * @param {any} stride - The stride param.\r\n   */\r\n  readPadd(stride) {\r\n    const padd = this.__byteOffset % stride\r\n    if (padd != 0) this.__byteOffset += stride - padd\r\n  }\r\n}\r\n\r\nexport { BinReader }\r\n","import { EventEmitter, GLFbo, GLTexture2D } from '@zeainc/zea-engine'\r\nimport { valuesPerSurfaceLibraryLayoutItem } from './CADConstants.js'\r\nimport { BinReader } from './Math/BinReader.js'\r\n\r\n/** Class representing a GL surface library.\r\n * @ignore\r\n */\r\nclass GLSurfaceLibrary extends EventEmitter {\r\n  /**\r\n   * Create a GL surface library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} surfacesLibrary - The surfacesLibrary value.\r\n   * @param {any} glCurveLibrary - The glCurveLibrary value.\r\n   */\r\n  constructor(gl, cadpassdata, surfacesLibrary, glCurveLibrary, version) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__surfacesLibrary = surfacesLibrary\r\n    this.__glCurveLibrary = glCurveLibrary\r\n    this.cadDataVersion = version\r\n\r\n    const surfacesDataBuffer = this.__surfacesLibrary.getSurfaceBuffer()\r\n    const surfaceTexSize = Math.sqrt(surfacesDataBuffer.byteLength / 8)\r\n\r\n    if (this.__cadpassdata.convertTo8BitTextures) {\r\n      this.__surfaceDataTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'UNSIGNED_BYTE',\r\n        width: surfaceTexSize * 2,\r\n        height: surfaceTexSize,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: new Uint8Array(surfacesDataBuffer),\r\n      })\r\n    } else {\r\n      this.__surfaceDataTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'HALF_FLOAT',\r\n        width: surfaceTexSize,\r\n        height: surfaceTexSize,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: new Uint16Array(surfacesDataBuffer),\r\n      })\r\n    }\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.__surfaceDrawSets = {}\r\n\r\n    // /////////////////////////////////////////////\r\n    // Precompile shaders.\r\n    const shaderopts = Object.assign({}, this.__gl.shaderopts)\r\n\r\n    if (this.cadDataVersion.compare([0, 0, 6]) >= 0) {\r\n      shaderopts.defines = shaderopts.defines + '#define EXPORT_KNOTS_AS_DELTAS 1\\n'\r\n    }\r\n    if (this.cadDataVersion.compare([0, 0, 26]) > 0) {\r\n      shaderopts.defines = shaderopts.defines + '#define INTS_PACKED_AS_2FLOAT16 1'\r\n    }\r\n    if (this.__cadpassdata.convertTo8BitTextures) {\r\n      shaderopts.frag = {\r\n        defines: '#define DECODE_16BIT_FLOAT_FROM_8BIT_INT 1\\n',\r\n      }\r\n    }\r\n\r\n    this.__cadpassdata.evaluateSurfaceShaders.forEach(shader => {\r\n      shader.compileForTarget(undefined, shaderopts)\r\n    })\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Surfaces\r\n\r\n  /**\r\n   * The drawSurfaceData method.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawSurfaceData() {\r\n    const renderstate = {}\r\n    if (!this.__surfaceDataTexture || !this.__cadpassdata.debugTrimSetsShader.bind(renderstate)) return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__surfaceDataTexture.bindToUniform(renderstate, renderstate.unifs.trimSetAtlasTexture)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The evaluateSurfaces method.\r\n   * @param {any} surfacesEvalAttrs - The surfacesEvalAttrs param.\r\n   * @param {any} surfacesAtlasLayout - The surfacesAtlasLayout param.\r\n   * @param {any} surfaceAtlasLayoutTextureSize - The surfaceAtlasLayoutTextureSize param.\r\n   * @param {any} surfacesAtlasTextureDim - The surfacesAtlasTextureDim param.\r\n   * @return {any} - The return value.\r\n   */\r\n  evaluateSurfaces(surfacesEvalAttrs, surfacesAtlasLayout, surfaceAtlasLayoutTextureSize, surfacesAtlasTextureDim) {\r\n    // console.log(\"evaluateSurfaces\");\r\n    const t0 = performance.now()\r\n\r\n    const totalSurfaceCount = surfacesAtlasLayout.length / valuesPerSurfaceLibraryLayoutItem\r\n    if (totalSurfaceCount == 0) return\r\n    const gl = this.__gl\r\n\r\n    {\r\n      this.__surfaceAtlasLayoutTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfaceAtlasLayoutTextureSize[0],\r\n        height: surfaceAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: surfacesAtlasLayout,\r\n      })\r\n    }\r\n\r\n    if (!this.__surfacesAtlasTexture) {\r\n      this.__surfacesAtlasTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfacesAtlasTextureDim[0],\r\n        height: surfacesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__surfacesFbo = new GLFbo(gl, this.__surfacesAtlasTexture)\r\n      this.__surfacesFbo.setClearColor([0, 0, 0, 0])\r\n      this.__surfacesFbo.bindAndClear()\r\n\r\n      this.__normalsTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfacesAtlasTextureDim[0],\r\n        height: surfacesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__normalsFbo = new GLFbo(gl, this.__normalsTexture)\r\n      this.__normalsFbo.setClearColor([0, 0, 0, 0])\r\n      this.__normalsFbo.bindAndClear()\r\n    } else if (\r\n      this.__surfacesAtlasTexture.width != surfacesAtlasTextureDim[0] ||\r\n      this.__surfacesAtlasTexture.height != surfacesAtlasTextureDim[1]\r\n    ) {\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__surfacesAtlasTexture.resize(surfacesAtlasTextureDim[0], surfacesAtlasTextureDim[1], true)\r\n      this.__surfacesFbo.resize() // hack to rebind the texture. Refactor the way textures are resized.\r\n    }\r\n\r\n    const renderstate = {}\r\n\r\n    surfacesEvalAttrs.forEach((attr, category) => {\r\n      this.__cadpassdata.evaluateSurfaceShaders[category].bind(renderstate)\r\n      this.__cadpassdata.glplanegeom.bind(renderstate)\r\n\r\n      const unifs = renderstate.unifs\r\n      const attrs = renderstate.attrs\r\n\r\n      this.__surfaceAtlasLayoutTexture.bindToUniform(renderstate, unifs.surfaceAtlasLayoutTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceAtlasLayoutTextureSize.location,\r\n        this.__surfaceAtlasLayoutTexture.width,\r\n        this.__surfaceAtlasLayoutTexture.height\r\n      )\r\n\r\n      gl.uniform2i(\r\n        unifs.surfacesAtlasTextureSize.location,\r\n        this.__surfacesAtlasTexture.width,\r\n        this.__surfacesAtlasTexture.height\r\n      )\r\n\r\n      this.__surfaceDataTexture.bindToUniform(renderstate, unifs.surfaceDataTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceDataTextureSize.location,\r\n        this.__surfaceDataTexture.width,\r\n        this.__surfaceDataTexture.height\r\n      )\r\n\r\n      // For the linear and radial loft.\r\n      if (unifs.curveTangentsTexture) this.__glCurveLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      const buffer = gl.createBuffer()\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n      gl.bufferData(gl.ARRAY_BUFFER, attr, gl.STATIC_DRAW)\r\n\r\n      this.__bindAttr(attrs.surfaceId.location, 1, gl.FLOAT, 4, 0)\r\n\r\n      // //////////////////////////////////////////////\r\n      // Bind each Fbo and render separately.\r\n      // Bizzarly, this has turned out to be much faster\r\n      // than using mutiple render targets...\r\n      this.__surfacesFbo.bind()\r\n      gl.uniform1i(unifs.writeNormals.location, 0)\r\n      this.__cadpassdata.glplanegeom.drawInstanced(attr.length)\r\n\r\n      this.__normalsFbo.bind()\r\n      gl.uniform1i(unifs.writeNormals.location, 1)\r\n      this.__cadpassdata.glplanegeom.drawInstanced(attr.length)\r\n      // //////////////////////////////////////////////\r\n\r\n      gl.deleteBuffer(buffer)\r\n    })\r\n    this.__surfacesFbo.unbind()\r\n\r\n    this.__surfacesAtlasLayout = surfacesAtlasLayout\r\n    // console.log(\"----------------------------------\");\r\n    // // console.log(surfacesAtlasLayout);\r\n    const logSurfaceData = surfaceId => {\r\n      this.__surfacesFbo.bindForReading()\r\n      const layout = [\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 0],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 1],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 2],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 3],\r\n      ]\r\n      console.log('----------------------------------')\r\n      console.log(\r\n        'logSurfaceData ' + surfaceId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3]\r\n      )\r\n      const pixels = new Float32Array(layout[2] * 4)\r\n      for (let i = 0; i < layout[3]; i++) {\r\n        gl.readPixels(layout[0], layout[1] + i, layout[2], 1, gl.RGBA, gl.FLOAT, pixels)\r\n        for (let j = 0; j < layout[2]; j++) {\r\n          console.log(i, j, ':', pixels[j * 4 + 0], pixels[j * 4 + 1], pixels[j * 4 + 2], pixels[j * 4 + 3])\r\n          break\r\n        }\r\n        // console.log(i+\":\" + pixels);\r\n      }\r\n    }\r\n    // logSurfaceData(9628)\r\n    // console.log(\"----------------------------------\");\r\n\r\n    const t = performance.now() - t0\r\n    // console.log(\"evaluateSurfaces - Done:\", t);\r\n\r\n    return t\r\n  }\r\n\r\n  /**\r\n   * The logSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   */\r\n  logSurfaceData(surfaceId) {\r\n    // const layout = [\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 0],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 1],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 2],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 3]];\r\n\r\n    // console.log(\"logGeomData \" + surfaceId + \":[\" + layout[0] +\",\"+ layout[1] + \"] detail :\" + layout[2] +\"x\"+ layout[3]);\r\n\r\n    const surfacesDataBuffer = this.__surfacesLibrary.getSurfaceBuffer()\r\n    const surfacesDataReader = new BinReader(surfacesDataBuffer)\r\n    surfacesDataReader.seek(8 + surfaceId * (8 /* num values per item*/ * 2) /* bpc*/ + 2 /* addr*/ * 2 /* bpc*/)\r\n\r\n    const detailU = surfacesDataReader.loadFloat16()\r\n    const detailV = surfacesDataReader.loadFloat16()\r\n    const sizeU = surfacesDataReader.loadFloat16()\r\n    const sizeV = surfacesDataReader.loadFloat16()\r\n    const trimSetIndex = surfacesDataReader.loadFloat16()\r\n    console.log(\r\n      'logGeomData ' +\r\n        surfaceId +\r\n        ' detailU:[' +\r\n        detailU +\r\n        ',' +\r\n        detailV +\r\n        '] sizeU [' +\r\n        sizeU +\r\n        ',' +\r\n        sizeV +\r\n        '] trimSetIndex:' +\r\n        trimSetIndex\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The drawSurfaceAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawSurfaceAtlas(renderstate) {\r\n    if (!this.__normalsTexture || !this.__cadpassdata.debugTrimSetsShader.bind(renderstate)) return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__normalsTexture.bindToUniform(renderstate, renderstate.unifs.trimSetAtlasTexture)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The bindSurfacesData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindSurfacesData(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    this.__surfaceDataTexture.bindToUniform(renderstate, unifs.surfaceDataTexture)\r\n    gl.uniform2i(\r\n      unifs.surfaceDataTextureSize.location,\r\n      this.__surfaceDataTexture.width,\r\n      this.__surfaceDataTexture.height\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The bindSurfacesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - returns true if the atlass was bound.\r\n   */\r\n  bindSurfacesAtlas(renderstate) {\r\n    if (!this.__surfacesAtlasTexture) return false\r\n    const unifs = renderstate.unifs\r\n    this.__surfacesAtlasTexture.bindToUniform(renderstate, unifs.surfacesAtlasTexture)\r\n    const gl = this.__gl\r\n    if (unifs.normalsTexture) this.__normalsTexture.bindToUniform(renderstate, unifs.normalsTexture)\r\n    if (unifs.surfacesAtlasTextureSize)\r\n      gl.uniform2i(\r\n        unifs.surfacesAtlasTextureSize.location,\r\n        this.__surfacesAtlasTexture.width,\r\n        this.__surfacesAtlasTexture.height\r\n      )\r\n\r\n    if (unifs.numSurfacesInLibrary) {\r\n      gl.uniform1i(unifs.numSurfacesInLibrary.location, this.__surfacesLibrary.getNumSurfaces())\r\n    }\r\n\r\n    if (unifs.surfaceAtlasLayoutTexture) {\r\n      this.__surfaceAtlasLayoutTexture.bindToUniform(renderstate, unifs.surfaceAtlasLayoutTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceAtlasLayoutTextureSize.location,\r\n        this.__surfaceAtlasLayoutTexture.width,\r\n        this.__surfaceAtlasLayoutTexture.height\r\n      )\r\n    }\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId) {\r\n    return this.__surfacesLibrary.getSurfaceData(surfaceId)\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__surfaceDataTexture.destroy()\r\n    if (this.__surfacesAtlasTexture) {\r\n      this.__surfacesAtlasTexture.destroy()\r\n      this.__normalsTexture.destroy()\r\n      this.__surfacesFbo.destroy()\r\n      this.__normalsFbo.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLSurfaceLibrary }\r\n","import { Float32, Plane, Mesh, GLMesh } from '@zeainc/zea-engine'\r\n\r\nimport { numValuesPerTrimSetCurveRef } from './CADConstants.js'\r\n\r\n/** This class abstracts the rendering of a collection of geometries to screen.\r\n * @extends Mesh\r\n * @ignore\r\n */\r\nclass Fan extends Mesh {\r\n  /**\r\n   * Create a fan.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super()\r\n    this.__detail = detail\r\n    this.addVertexAttribute('vertexIds', Float32)\r\n    this.__rebuild()\r\n  }\r\n\r\n  /**\r\n   * The __rebuild method.\r\n   * @private\r\n   */\r\n  __rebuild() {\r\n    this.setNumVertices(this.__detail + 2)\r\n    this.setFaceCounts([this.__detail])\r\n\r\n    for (let i = 0; i < this.__detail; i++) {\r\n      this.setFaceVertexIndices(i, [0, i + 1, i + 2])\r\n    }\r\n    const vertexIds = this.getVertexAttribute('vertexIds')\r\n    for (let i = 0; i <= vertexIds.length; i++) {\r\n      vertexIds.setFloat32Value(i, i)\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a strip.\r\n * @extends Plane\r\n * @ignore\r\n */\r\nclass Strip extends Plane {\r\n  /**\r\n   * Create a strip.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super(1, 2, detail, 1, false, false)\r\n  }\r\n\r\n  /**\r\n   * The __resize method.\r\n   * @private\r\n   */\r\n  __resize() {\r\n    const sizeX = this.__sizeXParam.getValue()\r\n    const sizeY = this.__sizeYParam.getValue()\r\n    const detailX = this.__detailXParam.getValue()\r\n    const detailY = this.__detailYParam.getValue()\r\n    const positions = this.getVertexAttribute('positions')\r\n    let voff = 0\r\n    for (let i = 0; i <= detailY; i++) {\r\n      const y = (i / detailY - 0.5) * sizeY\r\n      for (let j = 0; j <= detailX; j++) {\r\n        const x = j\r\n        positions.getValueRef(voff).set(x, y, 0.0)\r\n        voff++\r\n      }\r\n    }\r\n    this.setBoundingBoxDirty()\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL trim curve draw set.\r\n * @ignore\r\n */\r\nclass GLTrimCurveDrawSet {\r\n  /**\r\n   * Create a GL trim curve draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} detail - The detail value.\r\n   * @param {any} trimCurvesDataArray - The trimCurvesDataArray value.\r\n   */\r\n  constructor(gl, detail, trimCurvesDataArray) {\r\n    this.__gl = gl\r\n    this.__detail = detail\r\n\r\n    if (!__cache[detail]) {\r\n      __cache[detail] = {\r\n        glfangeom: new GLMesh(gl, new Fan(detail)),\r\n        glstripgeom: new GLMesh(gl, new Strip(detail)),\r\n      }\r\n    }\r\n    this.__glfangeom = __cache[detail].glfangeom\r\n    this.__glstripgeom = __cache[detail].glstripgeom\r\n\r\n    this.__buffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, trimCurvesDataArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount = trimCurvesDataArray.length / numValuesPerTrimSetCurveRef\r\n  }\r\n\r\n  /**\r\n   * The bindAttr method.\r\n   * @param {any} location - The location param.\r\n   * @param {any} channels - The channels param.\r\n   * @param {any} type - The type param.\r\n   * @param {any} stride - The stride param.\r\n   * @param {any} offset - The offset param.\r\n   */\r\n  bindAttr(location, channels, type, stride, offset) {\r\n    if (location < 0) return\r\n    const gl = this.__gl\r\n    gl.enableVertexAttribArray(location)\r\n    gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n    gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The setBuffer method.\r\n   */\r\n  setBuffer() {}\r\n\r\n  /**\r\n   * The drawFans method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawFans(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    this.__glfangeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    this.bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 0)\r\n    this.bindAttr(attrs.data0.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 4)\r\n    this.bindAttr(attrs.data1.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 8)\r\n    this.bindAttr(attrs.data2.location, 2, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 12)\r\n\r\n    gl.uniform1i(unifs.numCurveVertices.location, this.__detail + 1)\r\n\r\n    this.__glfangeom.drawInstanced(this.__drawCount)\r\n  }\r\n\r\n  /**\r\n   * The drawStrips method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawStrips(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    this.__glstripgeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    this.bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 0)\r\n    this.bindAttr(attrs.data0.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 4)\r\n    this.bindAttr(attrs.data1.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 8)\r\n    this.bindAttr(attrs.data2.location, 2, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 12)\r\n\r\n    gl.uniform1i(unifs.numCurveVertices.location, this.__detail + 1)\r\n\r\n    this.__glstripgeom.drawInstanced(this.__drawCount)\r\n  }\r\n\r\n  /**\r\n   * The cleanup method.\r\n   */\r\n  cleanup() {\r\n    // this.__gl.deleteBuffer(this.__buffer);\r\n  }\r\n}\r\n\r\nexport { GLTrimCurveDrawSet }\r\n","import { GLFbo, GLTexture2D } from '@zeainc/zea-engine'\r\nimport { GLTrimCurveDrawSet } from './GLTrimCurveDrawSet.js'\r\n\r\n/** Class representing a GL trim set library.\r\n * @ignore\r\n */\r\nclass GLTrimSetLibrary {\r\n  /**\r\n   * Create a GL trim set library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} trimSetLibrary - The trimSetLibrary value.\r\n   * @param {any} glCurvesLibrary - The glCurvesLibrary value.\r\n   */\r\n  constructor(gl, cadpassdata, trimSetLibrary, glCurvesLibrary) {\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__trimSetLibrary = trimSetLibrary\r\n    this.__glCurvesLibrary = glCurvesLibrary\r\n\r\n    const trimSetsBuffer = this.__trimSetLibrary.getBinaryBuffer()\r\n    const trimSetsTexSize = Math.sqrt(trimSetsBuffer.byteLength / 8)\r\n    this.__trimSetsTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'HALF_FLOAT',\r\n      width: trimSetsTexSize,\r\n      height: trimSetsTexSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: new Uint16Array(trimSetsBuffer),\r\n    })\r\n\r\n    this.__bindAttr = (\r\n      location,\r\n      channels,\r\n      type,\r\n      stride,\r\n      offset,\r\n      instanced = true\r\n    ) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(\r\n        location,\r\n        channels,\r\n        gl.FLOAT,\r\n        false,\r\n        stride,\r\n        offset\r\n      )\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.__trimCurveDrawSets = {}\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Trim Sets\r\n\r\n  /**\r\n   * The evaluateTrimSets method.\r\n   * @param {any} trimCurveDrawSets - The trimCurveDrawSets param.\r\n   * @param {any} trimSetAtlasTextureSize - The trimSetAtlasTextureSize param.\r\n   * @param {any} trimSetsAtlasLayoutData - The trimSetsAtlasLayoutData param.\r\n   * @param {any} trimSetsAtlasLayoutTextureSize - The trimSetsAtlasLayoutTextureSize param.\r\n   */\r\n  evaluateTrimSets(\r\n    trimCurveDrawSets,\r\n    trimSetAtlasTextureSize,\r\n    trimSetsAtlasLayoutData,\r\n    trimSetsAtlasLayoutTextureSize\r\n  ) {\r\n    // console.log(\"evaluateTrimSets:\" + trimSetAtlasTextureSize);\r\n    const gl = this.__gl\r\n\r\n    {\r\n      this.__trimSetsAtlasLayoutTexture = new GLTexture2D(this.__gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: trimSetsAtlasLayoutTextureSize[0],\r\n        height: trimSetsAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: trimSetsAtlasLayoutData,\r\n      })\r\n    }\r\n\r\n    if (!this.__trimSetAtlasTexture) {\r\n      this.__trimSetAtlasTextureSize = trimSetAtlasTextureSize\r\n\r\n      if (\r\n        this.__trimSetAtlasTextureSize[0] > this.__cadpassdata.maxTexSize ||\r\n        this.__trimSetAtlasTextureSize[1] > this.__cadpassdata.maxTexSize\r\n      ) {\r\n        console.warn(\r\n          'trimSetAtlas  is too big to fit in a texture. The image will be downsized:' +\r\n            this.__trimSetAtlasTextureSize +\r\n            ' maxTexSize:' +\r\n            this.__cadpassdata.maxTexSize\r\n        )\r\n      }\r\n\r\n      this.__trimSetAtlasMaskTexture = new GLTexture2D(gl, {\r\n        format: gl.name == 'webgl2' ? 'RG' : 'RGBA',\r\n        type: 'UNSIGNED_BYTE',\r\n        width: Math.min(\r\n          this.__trimSetAtlasTextureSize[0],\r\n          this.__cadpassdata.maxTexSize\r\n        ),\r\n        height: Math.min(\r\n          this.__trimSetAtlasTextureSize[1],\r\n          this.__cadpassdata.maxTexSize\r\n        ),\r\n        filter: 'NEAREST',\r\n      })\r\n      this.__trimSetAtlasMaskFbo = new GLFbo(\r\n        gl,\r\n        this.__trimSetAtlasMaskTexture\r\n      )\r\n      this.__trimSetAtlasMaskFbo.setClearColor([0, 0, 0, 0])\r\n\r\n      // Multi-channel signed distance field\r\n      // https://steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\r\n      // See: 4.3\r\n      const format = gl.name == 'webgl2' ? 'RG' : 'RGBA';\r\n      const filter = 'LINEAR'\r\n\r\n      this.__trimSetAtlasTexture = new GLTexture2D(gl, {\r\n        format,\r\n        type: 'UNSIGNED_BYTE',\r\n        width: Math.min(\r\n          this.__cadpassdata.maxTexSize,\r\n          this.__trimSetAtlasTextureSize[0]\r\n        ),\r\n        height: Math.min(\r\n          this.__cadpassdata.maxTexSize,\r\n          this.__trimSetAtlasTextureSize[1]\r\n        ),\r\n        magFilter: filter,\r\n        minFilter: filter,\r\n      })\r\n\r\n      this.__trimSetAtlasFbo = new GLFbo(\r\n        gl,\r\n        this.__trimSetAtlasTexture\r\n      )\r\n      this.__trimSetAtlasFbo.setClearColor([0, 0, 0, 0])\r\n    } else if (\r\n      this.__trimSetAtlasTexture.width != trimSetAtlasTextureSize[0] ||\r\n      this.__trimSetAtlasTexture.height != trimSetAtlasTextureSize[1]\r\n    ) {\r\n      this.__trimSetAtlasTextureSize = trimSetAtlasTextureSize\r\n\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__trimSetAtlasTexture.resize(\r\n        trimSetAtlasTextureSize[0],\r\n        trimSetAtlasTextureSize[1],\r\n        true\r\n      )\r\n      this.__trimSetAtlasFbo.resize() // hack to rebind the texture. Refactor the way textures are resized.\r\n\r\n      // this.__trimSetAtlasFbo.bind();\r\n    }\r\n\r\n    const renderstate = {}\r\n    // ////////////////////////////////////////////////\r\n    // Render the mask aread using fans\r\n\r\n    this.__trimSetAtlasMaskFbo.bindAndClear()\r\n\r\n    {\r\n      // / Setup additive blending so that all rendering passes accumulate into the same Fbo.\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.FUNC_ADD)\r\n      gl.blendFunc(gl.ONE, gl.ONE)\r\n\r\n      this.__cadpassdata.trimCurveFansShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n\r\n      this.__glCurvesLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      gl.uniform2i(\r\n        unifs.trimSetAtlasTextureSize.location,\r\n        this.__trimSetAtlasTextureSize[0],\r\n        this.__trimSetAtlasTextureSize[1]\r\n      )\r\n\r\n      // For vertex welding (Not yet implemented)\r\n      if (unifs.trimSetTexture) {\r\n        this.__trimSetsTexture.bindToUniform(renderstate, unifs.trimSetTexture)\r\n        if (unifs.trimSetTextureSize)\r\n          gl.uniform2i(\r\n            unifs.trimSetTextureSize.location,\r\n            this.__trimSetsTexture.width,\r\n            this.__trimSetsTexture.height\r\n          )\r\n\r\n        this.__trimSetsAtlasLayoutTexture.bindToUniform(\r\n          renderstate,\r\n          unifs.curvesAtlasLayoutTexture\r\n        )\r\n        if (unifs.curvesAtlasLayoutTextureSize)\r\n          gl.uniform2i(\r\n            unifs.curvesAtlasLayoutTextureSize.location,\r\n            this.__trimSetsAtlasLayoutTexture.width,\r\n            this.__trimSetsAtlasLayoutTexture.height\r\n          )\r\n      }\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(\r\n            this.__gl,\r\n            detail,\r\n            trimCurveDrawSets[key]\r\n          )\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawFans(renderstate)\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    // ////////////////////////////////////////////////////\r\n    // Render the float texture as a signed distance field\r\n\r\n    this.__trimSetAtlasFbo.bindAndClear()\r\n\r\n    // if(false)\r\n    {\r\n      // /////////////////////////\r\n      // Flatten the fans texture\r\n      this.__cadpassdata.flattenTrimSetsShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n      this.__trimSetAtlasMaskTexture.bindToUniform(\r\n        renderstate,\r\n        unifs.trimSetAtlasTexture\r\n      )\r\n      if (unifs.trimSetAtlasTextureSize)\r\n        this.__gl.uniform2i(\r\n          unifs.trimSetAtlasTextureSize.location,\r\n          this.__trimSetAtlasTextureSize[0],\r\n          this.__trimSetAtlasTextureSize[1]\r\n        )\r\n      this.__cadpassdata.glplanegeom.bind(renderstate)\r\n      this.__cadpassdata.glplanegeom.draw()\r\n    }\r\n\r\n    // //////////////////////////////////////\r\n    // Draw the Strips to clean up the edges\r\n    // if(false)\r\n    {\r\n      this.__cadpassdata.trimCurveStripsShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n\r\n      this.__glCurvesLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      gl.uniform2i(\r\n        unifs.trimSetAtlasTextureSize.location,\r\n        this.__trimSetAtlasTextureSize[0],\r\n        this.__trimSetAtlasTextureSize[1]\r\n      )\r\n      gl.uniform1f(unifs.stripWidth.location, 1.25)\r\n\r\n      // Initially a build up the data around the edges by rasterizing a full color pixel,\r\n      // followed by a subtractive pass that cuts down the borders\r\n      //\r\n      // Initially, after the fans are rasterized.\r\n      //     ----\r\n      //  .  |  .\r\n      //  .  |  .\r\n      //     ----\r\n      //\r\n      // Becomes\r\n      //  -------\r\n      //  .     .\r\n      //  .     .\r\n      //  -------\r\n      //\r\n      // Becomes\r\n      //    . ---\r\n      //    ./\r\n      //   /.\r\n      //  -------\r\n      // After the subtraction pass\r\n      gl.uniform1i(unifs.flatten.location, 1)\r\n      gl.disable(gl.BLEND)\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(\r\n            this.__gl,\r\n            detail,\r\n            trimCurveDrawSets[key]\r\n          )\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawStrips(renderstate)\r\n      }\r\n      \r\n      // Now subtract the gradient.\r\n      gl.uniform1i(unifs.flatten.location, 0)\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.MIN)\r\n      gl.blendFunc(gl.ONE, gl.ONE)\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(\r\n            this.__gl,\r\n            detail,\r\n            trimCurveDrawSets[key]\r\n          )\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawStrips(renderstate)\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    for (const key in trimCurveDrawSets) {\r\n      const trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n      if (trimCurveDrawSet) trimCurveDrawSet.cleanup()\r\n    }\r\n\r\n    this.__trimSetsAtlasLayoutData = trimSetsAtlasLayoutData\r\n    // console.log(\"----------------------------------\");\r\n    // const st_x = Math.round(trimSetAtlasTextureSize[0] / 2)\r\n    // const st_y = trimSetAtlasTextureSize[0] - 4;; //Math.round(trimSetAtlasTextureSize[1] / 2)\r\n    // gl.finish();\r\n    // this.logTrimSet(0);\r\n\r\n    gl.finish()\r\n  }\r\n\r\n  /**\r\n   * The logTrimSetMask method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   */\r\n  logTrimSetMask(trimSetId) {\r\n    const gl = this.__gl\r\n    this.__trimSetAtlasMaskFbo.bind()\r\n    const layout = [\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 0],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 1],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 2],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 3],\r\n    ]\r\n    console.log(\r\n      'logTrimSetMask ' +\r\n        trimSetId +\r\n        ':[' +\r\n        layout[0] +\r\n        ',' +\r\n        layout[1] +\r\n        ']:' +\r\n        layout[2] +\r\n        'x' +\r\n        layout[3]\r\n    )\r\n    const pixels = new Uint8Array(layout[2] * 4)\r\n    for (let i = 0; i < layout[3]; i++) {\r\n      gl.readPixels(\r\n        layout[0],\r\n        layout[1] + i,\r\n        layout[2],\r\n        1,\r\n        gl.name == 'webgl2' ? gl.RED : gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        pixels\r\n      )\r\n      let line = i + ' '\r\n      for (let j = 0; j < layout[2]; j++) {\r\n        // line += (pixels[j * 4] % 2 == 0 ? '-' : '*');\r\n        line += pixels[j * 4]\r\n      }\r\n      console.log(line)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The logTrimSet method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   */\r\n  logTrimSet(trimSetId) {\r\n    const gl = this.__gl\r\n    this.__trimSetAtlasFbo.bind()\r\n    const layout = [\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 0],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 1],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 2],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 3],\r\n    ]\r\n    console.log(\r\n      'logTrimSet ' +\r\n        trimSetId +\r\n        ':[' +\r\n        layout[0] +\r\n        ',' +\r\n        layout[1] +\r\n        ']:' +\r\n        layout[2] +\r\n        'x' +\r\n        layout[3]\r\n    )\r\n    const pixels = new Uint16Array(layout[2] * 4)\r\n    for (let i = 0; i < layout[3]; i++) {\r\n      gl.readPixels(\r\n        layout[0],\r\n        layout[1] + i,\r\n        layout[2],\r\n        1,\r\n        gl.RGBA,\r\n        gl.HALF_FLOAT,\r\n        pixels\r\n      )\r\n      let line = i + ' '\r\n      for (let j = 0; j < layout[2]; j++) {\r\n        // line += (pixels[j * 4] % 2 == 0 ? '-' : '*');\r\n        line += pixels[j * 4]\r\n      }\r\n      console.log(line)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindTrimSetAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindTrimSetAtlas(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    const { trimSetAtlasTexture, trimSetAtlasTextureSize } = unifs\r\n    if (this.__trimSetAtlasTexture && trimSetAtlasTexture) {\r\n      this.__trimSetAtlasTexture.bindToUniform(\r\n        renderstate,\r\n        trimSetAtlasTexture\r\n      )\r\n      if (trimSetAtlasTextureSize) {\r\n        gl.uniform2i(\r\n          trimSetAtlasTextureSize.location,\r\n          this.__trimSetAtlasTextureSize[0],\r\n          this.__trimSetAtlasTextureSize[1]\r\n        )\r\n      }\r\n      \r\n      if (this.ext_filter_anisotropic){\r\n        // Disable anisotropic filtering on this texture.\r\n        gl.texParameterf(gl.TEXTURE_2D, this.ext_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, 1.0);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindTrimSetAtlasLayout method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindTrimSetAtlasLayout(renderstate) {\r\n    // During debugging, we disable trim sets.\r\n    if (!this.__trimSetsAtlasLayoutTexture) return;\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    this.__trimSetsAtlasLayoutTexture.bindToUniform(\r\n      renderstate,\r\n      unifs.trimSetsAtlasLayoutTexture\r\n    )\r\n    gl.uniform2i(\r\n      unifs.trimSetsAtlasLayoutTextureSize.location,\r\n      this.__trimSetsAtlasLayoutTexture.width,\r\n      this.__trimSetsAtlasLayoutTexture.height\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The drawTrimSets method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawTrimSets(renderstate) {\r\n    if (\r\n      !this.__trimSetAtlasTexture ||\r\n      !this.__cadpassdata.debugTrimSetsShader.bind(renderstate)\r\n    )\r\n      return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__trimSetAtlasTexture.bindToUniform(\r\n      renderstate,\r\n      renderstate.unifs.trimSetAtlasTexture\r\n    )\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__trimSetsTexture.destroy()\r\n    if (this.__trimSetsAtlasLayoutTexture) {\r\n      this.__trimSetsAtlasLayoutTexture.destroy()\r\n      this.__trimSetAtlasMaskTexture.destroy()\r\n      this.__trimSetAtlasMaskFbo.destroy()\r\n      this.__trimSetAtlasTexture.destroy()\r\n      this.__trimSetAtlasFbo.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLTrimSetLibrary }\r\n","/* eslint-disable require-jsdoc */\r\nimport { EventEmitter, Vec3, Vec4, GLTexture2D, GLFbo, GLRenderTarget } from '@zeainc/zea-engine'\r\nimport { CADBody } from './CADBody.js'\r\n\r\nimport { floatsPerSceneBody, BODY_FLAG_CUTAWAY, BODY_FLAG_INVISIBLE } from './CADConstants.js'\r\n\r\n// import {\r\n//   GLCADAssetWorker_onmessage\r\n// } from './GLCADAssetWorker.js';\r\n\r\n/** Class representing a GLCADBody.\r\n * @ignore\r\n */\r\nexport class GLCADBody extends EventEmitter {\r\n  constructor(cadBody, bodyId) {\r\n    super()\r\n    this.cadBody = cadBody\r\n    this.bodyId = bodyId\r\n    this.flags = 0\r\n\r\n    this.dirtyValues = new Set()\r\n  }\r\n\r\n  bind(\r\n    cadpassdata,\r\n    sceneBodyItemData,\r\n    cadBodyTextureData,\r\n    bodyItemDataChanged,\r\n    highlightedBodies,\r\n    highlightChangeBatch,\r\n    pushhighlightChangeBatchToWorker\r\n  ) {\r\n    this.cadBodyTextureData = cadBodyTextureData\r\n\r\n    const cadBodyDescAddr = this.cadBody.getBodyDataTexelCoords()\r\n\r\n    // const offset = bodyId * floatsPerSceneBody\r\n    if (!this.cadBody.isVisible()) this.flags |= BODY_FLAG_INVISIBLE\r\n    if (\r\n      (this.cadBody.isCutawayEnabled && this.cadBody.isCutawayEnabled()) ||\r\n      (this.cadBody.hasParameter('CutawayEnabled') && this.cadBody.getParameter('CutawayEnabled').getValue())\r\n    ) {\r\n      this.flags |= BODY_FLAG_CUTAWAY\r\n    }\r\n\r\n    const material = this.cadBody.getMaterial()\r\n\r\n    const shaderId = cadpassdata.genShaderID(material.getShaderName())\r\n    // console.log('Shader:' + material.getShaderName() + ':' + shaderId);\r\n    let glmaterialcoords = material.getMetadata('glmaterialcoords')\r\n    if (!glmaterialcoords) {\r\n      glmaterialcoords = cadpassdata.materialLibrary.addMaterial(material)\r\n    }\r\n\r\n    sceneBodyItemData[0] = this.cadBody.getBodyDescId()\r\n    sceneBodyItemData[1] = shaderId\r\n\r\n    cadBodyTextureData[0] = this.cadBody.getBodyDescId()\r\n    cadBodyTextureData[1] = this.flags\r\n    cadBodyTextureData[2] = cadBodyDescAddr.x\r\n    cadBodyTextureData[3] = cadBodyDescAddr.y\r\n\r\n    cadBodyTextureData[4] = glmaterialcoords.x\r\n    cadBodyTextureData[5] = glmaterialcoords.y\r\n\r\n    this.visibilityChanged = () => {\r\n      // TODO: Actually modify the draw sets for each visibility chage.\r\n      // It should be similar to hilight changes.\r\n      const visibile = this.cadBody.isVisible()\r\n      if (!visibile) {\r\n        if ((this.flags & BODY_FLAG_INVISIBLE) == 0) {\r\n          this.flags |= BODY_FLAG_INVISIBLE\r\n          this.cadBodyTextureData[1] = this.flags\r\n          bodyItemDataChanged(this.bodyId)\r\n        }\r\n      } else {\r\n        if ((this.flags & BODY_FLAG_INVISIBLE) != 0) {\r\n          this.flags &= ~BODY_FLAG_INVISIBLE\r\n          this.cadBodyTextureData[1] = this.flags\r\n          bodyItemDataChanged(this.bodyId)\r\n        }\r\n      }\r\n    }\r\n    this.cadBody.on('visibilityChanged', this.visibilityChanged)\r\n\r\n    this.materialChanged = () => {\r\n      const material = this.cadBody.getMaterial()\r\n      let glmaterialcoords = material.getMetadata('glmaterialcoords')\r\n      if (!glmaterialcoords) {\r\n        glmaterialcoords = cadpassdata.materialLibrary.addMaterial(material)\r\n      }\r\n      cadBodyTextureData[4] = glmaterialcoords.x\r\n      cadBodyTextureData[5] = glmaterialcoords.y\r\n      bodyItemDataChanged(this.bodyId)\r\n    }\r\n    this.cadBody.getParameter('Material').on('valueChanged', this.materialChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Body Xfo\r\n    this.globalXfoParam = this.cadBody.getParameter('GlobalXfo')\r\n    this.updateXfo()\r\n    this.globalXfoChanged = () => {\r\n      bodyItemDataChanged(this.bodyId)\r\n      this.dirtyValues.add('Xfo')\r\n    }\r\n    this.globalXfoParam.on('valueChanged', this.globalXfoChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Highlight\r\n    if (this.cadBody.isHighlighted()) {\r\n      this.updateHighlightColor()\r\n      highlightedBodies.push(this.bodyId)\r\n    }\r\n\r\n    this.highlightChanged = () => {\r\n      if (!highlightChangeBatch.dirty) {\r\n        setTimeout(pushhighlightChangeBatchToWorker, 1)\r\n        highlightChangeBatch.dirty = true\r\n      }\r\n      const highlighted = this.cadBody.isHighlighted()\r\n      if (highlighted) {\r\n        this.dirtyValues.add('Highlight')\r\n        bodyItemDataChanged(this.bodyId)\r\n        if (highlightedBodies.indexOf(this.bodyId) == -1) {\r\n          highlightedBodies.push(this.bodyId)\r\n\r\n          // Note: filter out highlight/unhighlight in a single update.\r\n          const indexInSelChangeSet = highlightChangeBatch.unhighlightedBodyIds.indexOf(this.bodyId)\r\n          if (indexInSelChangeSet != -1) {\r\n            highlightChangeBatch.unhighlightedBodyIds.splice(indexInSelChangeSet, 1)\r\n          } else {\r\n            highlightChangeBatch.highlightedBodyIds.push(this.bodyId)\r\n          }\r\n        }\r\n      } else {\r\n        const index = highlightedBodies.indexOf(this.bodyId)\r\n        if (index != -1) {\r\n          highlightedBodies.splice(index, 1)\r\n\r\n          // Note: filter out highlight/unhighlight in a single update.\r\n          const indexInSelChangeSet = highlightChangeBatch.highlightedBodyIds.indexOf(this.bodyId)\r\n          if (indexInSelChangeSet != -1) {\r\n            highlightChangeBatch.highlightedBodyIds.splice(indexInSelChangeSet, 1)\r\n          } else {\r\n            highlightChangeBatch.unhighlightedBodyIds.push(this.bodyId)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.cadBody.on('highlightChanged', this.highlightChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Body Cut Plane\r\n    this.updateCutaway()\r\n    this.cutAwayChangedId = this.cadBody.on('cutAwayChanged', () => {\r\n      bodyItemDataChanged(this.bodyId)\r\n      this.dirtyValues.add('Cutaway')\r\n    })\r\n  }\r\n\r\n  updateCutaway() {\r\n    const cpoff = 24\r\n    if (this.cadBody.isCutawayEnabled()) {\r\n      if (!(this.flags & BODY_FLAG_CUTAWAY)) {\r\n        this.flags |= BODY_FLAG_CUTAWAY\r\n        this.cadBodyTextureData[1] = this.flags\r\n      }\r\n\r\n      const cutPlane = this.cadBody.getCutVector()\r\n      const cutPlaneDist = this.cadBody.getCutDist()\r\n      this.cadBodyTextureData[cpoff + 0] = cutPlane.x\r\n      this.cadBodyTextureData[cpoff + 1] = cutPlane.y\r\n      this.cadBodyTextureData[cpoff + 2] = cutPlane.z\r\n      this.cadBodyTextureData[cpoff + 3] = cutPlaneDist\r\n    } else {\r\n      if (this.flags & BODY_FLAG_CUTAWAY) {\r\n        this.flags &= ~BODY_FLAG_CUTAWAY\r\n        this.cadBodyTextureData[1] = this.flags\r\n      }\r\n    }\r\n  }\r\n\r\n  updateHighlightColor() {\r\n    const highlight = this.cadBody.getHighlight()\r\n    if (highlight) {\r\n      const hoff = 20\r\n      this.cadBodyTextureData[hoff + 0] = highlight.r\r\n      this.cadBodyTextureData[hoff + 1] = highlight.g\r\n      this.cadBodyTextureData[hoff + 2] = highlight.b\r\n      this.cadBodyTextureData[hoff + 3] = highlight.a\r\n    }\r\n  }\r\n\r\n  updateXfo() {\r\n    const bodyXfo = this.globalXfoParam.getValue()\r\n\r\n    const off = 8\r\n    this.cadBodyTextureData[off + 0] = bodyXfo.tr.x\r\n    this.cadBodyTextureData[off + 1] = bodyXfo.tr.y\r\n    this.cadBodyTextureData[off + 2] = bodyXfo.tr.z\r\n    // this.cadBodyTextureData[off + 3]\r\n    this.cadBodyTextureData[off + 4] = bodyXfo.ori.x\r\n    this.cadBodyTextureData[off + 5] = bodyXfo.ori.y\r\n    this.cadBodyTextureData[off + 6] = bodyXfo.ori.z\r\n    this.cadBodyTextureData[off + 7] = bodyXfo.ori.w\r\n    this.cadBodyTextureData[off + 8] = bodyXfo.sc.x\r\n    this.cadBodyTextureData[off + 9] = bodyXfo.sc.y\r\n    this.cadBodyTextureData[off + 10] = bodyXfo.sc.z\r\n  }\r\n\r\n  updateCadBodyTex() {\r\n    this.dirtyValues.forEach(key => {\r\n      if (key == 'Xfo') this.updateXfo()\r\n      else if (key == 'Highlight') this.updateHighlightColor()\r\n      else if (key == 'Cutaway') this.updateCutaway()\r\n    })\r\n    this.dirtyValues.clear()\r\n  }\r\n\r\n  destroy() {\r\n    this.cadBody.off('visibilityChanged', this.visibilityChanged)\r\n    if (this.cadBody.cutAwayChanged) {\r\n      this.cadBody.off('cutAwayChanged', this.cutAwayChangedId)\r\n    } else {\r\n      const cutParam = this.cadBody.getParameter('CutawayEnabled')\r\n      if (cutParam) {\r\n        cutParam.off('valueChanged', this.cutAwayEnabledId)\r\n      }\r\n    }\r\n    this.cadBody.getParameter('Material').off('valueChanged', this.materialChanged)\r\n    this.cadBody.getParameter('GlobalXfo').off('valueChanged', this.globalXfoChanged)\r\n    this.cadBody.off('highlightChanged', this.highlightChanged)\r\n  }\r\n}\r\n","const kIsNodeJS = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\nconst kRequire = kIsNodeJS && typeof module.require === 'function' ? module.require : null; // eslint-disable-line\n\nexport function createInlineWorkerFactory(fn, sourcemap = null) {\n    const source = fn.toString();\n    const start = source.indexOf('\\n', 10) + 1;\n    const end = source.indexOf('}', source.length - 1);\n    const body = source.substring(start, end) + (sourcemap ? `\\/\\/# sourceMappingURL=${sourcemap}` : '');\n    const blankPrefixLength = body.search(/\\S/);\n    const lines = body.split('\\n').map(line => line.substring(blankPrefixLength) + '\\n');\n\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        const concat = lines.join('\\n');\n        return function WorkerFactory(options) {\n            return new Worker(concat, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob(lines, { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function createURLWorkerFactory(url) {\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(url, options);\n        };\n    }\n    /* browser */\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function browserDecodeBase64(base64, enableUnicode) {\n    const binaryString = atob(base64);\n    if (enableUnicode) {\n        const binaryView = new Uint8Array(binaryString.length);\n        Array.prototype.forEach.call(binaryView, (el, idx, arr) => {\n            arr[idx] = binaryString.charCodeAt(idx);\n        });\n        return String.fromCharCode.apply(null, new Uint16Array(binaryView.buffer));\n    }\n    return binaryString;\n}\n\nexport function nodeDecodeBase64(base64, enableUnicode) {\n    return Buffer.from(base64, 'base64').toString(enableUnicode ? 'utf16' : 'utf8');\n}\n\nexport function createBase64WorkerFactory(base64, sourcemap = null, enableUnicode = false) {\n    const source = kIsNodeJS ? nodeDecodeBase64(base64, enableUnicode) : browserDecodeBase64(base64, enableUnicode);\n    const start = source.indexOf('\\n', 10) + 1;\n    const body = source.substring(start) + (sourcemap ? `\\/\\/# sourceMappingURL=${sourcemap}` : '');\n\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(body, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob([body], { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n","import { EventEmitter, Vec3, GLTexture2D, GLFbo, GLRenderTarget, MathFunctions } from '@zeainc/zea-engine'\r\nimport { CADBody } from './CADBody.js'\r\nimport { GLSurfaceDrawSet } from './GLSurfaceDrawSet.js'\r\nimport { GLCurveDrawSet } from './GLCurveDrawSet.js'\r\nimport { GLCurveLibrary } from './GLCurveLibrary.js'\r\nimport { GLSurfaceLibrary } from './GLSurfaceLibrary.js'\r\nimport { GLTrimSetLibrary } from './GLTrimSetLibrary.js'\r\nimport { GLCADBody } from './GLCADBody.js'\r\n\r\nimport {\r\n  pixelsPerDrawItem, // The number of RGBA pixels per draw item.\r\n  drawItemShaderAttribsStride,\r\n  floatsPerSceneBody,\r\n} from './CADConstants.js'\r\n\r\n// [bodyDescId, surfaceId, cadBodyDesc.xy], [glmaterialcoords.xy][tr-xyz], [ori], [sc], [highlight], [cutPlane]\r\nconst pixelsPerCADBody = 7\r\n\r\nimport GLCADAssetWorker from 'web-worker:./GLCADAssetWorker.js'\r\n// import {\r\n//   GLCADAssetWorker_onmessage\r\n// } from './GLCADAssetWorker.js';\r\n\r\n/**  Class representing a GL CAD asset.\r\n * @ignore\r\n */\r\nclass GLCADAsset extends EventEmitter {\r\n  /**\r\n   * Create a GL CAD asset.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} assetId - The assetId value.\r\n   * @param {any} cadAsset - The cadAsset value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   */\r\n  constructor(gl, assetId, cadAsset, cadpassdata) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__assetId = assetId\r\n    this.__cadAsset = cadAsset\r\n    this.__numSurfaces = cadAsset.getSurfaceLibrary().getNumSurfaces()\r\n    this.__numBodies = cadAsset.getBodyLibrary().getNumBodies()\r\n    this.__numMaterials = cadAsset.getMaterialLibrary().getNumMaterials()\r\n    this.__numHighlightedGeoms = 0\r\n    this.__ready = false\r\n\r\n    this.__visible = this.__cadAsset.isVisible()\r\n    this.__assetVisibilityChanged = this.__assetVisibilityChanged.bind(this)\r\n    this.__cadAsset.on('visibilityChanged', this.__assetVisibilityChanged)\r\n\r\n    const updateDisplayEdges = () => {\r\n      this.displayEdges = this.__cadAsset.getParameter('Display Edges').getValue()\r\n      if (this.displayEdges) cadpassdata.incDisplayEdges()\r\n      else cadpassdata.decDisplayEdges()\r\n    }\r\n    updateDisplayEdges()\r\n    this.displayEdgesChangedId = this.__cadAsset.getParameter('Display Edges').on('valueChanged', updateDisplayEdges)\r\n\r\n    const updateEdgeColor = () => {\r\n      this.edgeColor = this.__cadAsset\r\n        .getParameter('Edge Color')\r\n        .getValue()\r\n        .asArray()\r\n      this.emit('updated')\r\n    }\r\n    updateEdgeColor()\r\n    this.edgesColorChangedId = this.__cadAsset.getParameter('Edge Color').on('valueChanged', updateEdgeColor)\r\n\r\n    this.__cadpassdata = cadpassdata\r\n\r\n    this.__curveLibrary = new GLCurveLibrary(\r\n      gl,\r\n      cadpassdata,\r\n      this.__cadAsset.getSurfaceLibrary(),\r\n      cadAsset.getVersion()\r\n    )\r\n    this.__surfaceLibrary = new GLSurfaceLibrary(\r\n      gl,\r\n      cadpassdata,\r\n      this.__cadAsset.getSurfaceLibrary(),\r\n      this.__curveLibrary,\r\n      cadAsset.getVersion()\r\n    )\r\n    const trimSetsBuffer = this.__cadAsset.getTrimSetLibrary().getBinaryBuffer()\r\n    if (trimSetsBuffer && trimSetsBuffer.byteLength > 8) {\r\n      this.__trimSetLibrary = new GLTrimSetLibrary(\r\n        gl,\r\n        cadpassdata,\r\n        this.__cadAsset.getTrimSetLibrary(),\r\n        this.__curveLibrary\r\n      )\r\n    }\r\n\r\n    {\r\n      const bodyLibraryBuffer = this.__cadAsset.getBodyLibrary().getBinaryBuffer()\r\n      if (bodyLibraryBuffer) {\r\n        const bodyTexSize = Math.sqrt(bodyLibraryBuffer.byteLength / 16) // RGBA32 pixels\r\n        this.__bodyDescTexture = new GLTexture2D(gl, {\r\n          format: 'RGBA',\r\n          type: 'FLOAT',\r\n          width: bodyTexSize,\r\n          height: bodyTexSize,\r\n          filter: 'NEAREST',\r\n          wrap: 'CLAMP_TO_EDGE',\r\n          mipMapped: false,\r\n          data: new Float32Array(bodyLibraryBuffer),\r\n        })\r\n      }\r\n    }\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.__trimCurveDrawSets = {}\r\n    this.__surfaceDrawSets = {}\r\n    this.__curveDrawSets = {}\r\n\r\n    // ////////////////////////////////////////////////\r\n\r\n    this.loadWorker()\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __assetVisibilityChanged() {\r\n    this.__visible = this.__cadAsset.isVisible()\r\n    this.emit('assetVisibilityChanged')\r\n  }\r\n\r\n  /**\r\n   * The getCADAsset method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCADAsset() {\r\n    return this.__cadAsset\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfaces method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfaces() {\r\n    return this.__numSurfaces\r\n  }\r\n\r\n  /**\r\n   * The getNumBodies method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumBodies() {\r\n    return this.__numBodies\r\n  }\r\n\r\n  /**\r\n   * The getNumMaterials method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumMaterials() {\r\n    return this.__numMaterials\r\n  }\r\n\r\n  /**\r\n   * The incHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  incHighlightedCount(count) {\r\n    this.__numHighlightedGeoms += count\r\n    this.__cadpassdata.incHighlightedCount(count)\r\n  }\r\n\r\n  /**\r\n   * The decHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  decHighlightedCount(count) {\r\n    this.__numHighlightedGeoms -= count\r\n    this.__cadpassdata.decHighlightedCount(count)\r\n  }\r\n\r\n  /**\r\n   * The loadWorker method.\r\n   */\r\n  loadWorker() {\r\n    const numBodyItems = this.__cadAsset.getNumBodyItems()\r\n    if (numBodyItems == 0) return\r\n\r\n    // let tmp = 0;\r\n    // this.__cadAsset.traverse((treeItem) => {\r\n    //     if (treeItem instanceof CADBody) {\r\n    //       console.log(treeItem.getPath())\r\n    //       tmp++;\r\n    //       return false;\r\n    //     } else\r\n    //       return true;\r\n    // });\r\n    // if(numBodyItems != tmp){\r\n    //   console.log(\"numBodyItems\", numBodyItems, tmp)\r\n    //   numBodyItems = tmp;\r\n    // }\r\n\r\n    // Only support power 2 textures. Else we get strange corruption on some GPUs\r\n    // in some scenes.\r\n    let cadBodiesTextureSize = MathFunctions.nextPow2(Math.round(Math.sqrt(numBodyItems * pixelsPerCADBody) + 0.5))\r\n    // Size should be a multiple of pixelsPerCADBody, so each geom item is always contiguous\r\n    // in memory. (makes updating a lot easier. See __updateItemInstanceData below)\r\n    if (cadBodiesTextureSize % pixelsPerCADBody != 0)\r\n      cadBodiesTextureSize += pixelsPerCADBody - (cadBodiesTextureSize % pixelsPerCADBody)\r\n\r\n    this.cadBodiesTextureData = new Float32Array(cadBodiesTextureSize * cadBodiesTextureSize * 4) // 4==RGBA pixels.\r\n\r\n    // Calculate the entroid to offset all the Xfo values.\r\n    // This is to work around an issue on Mobile GPUs where\r\n    // the fragment shader stage only supports Flaot16 operations.\r\n    // The Matrix calculated in the DrawItems shader contains artifacts\r\n    // because of the low precision.\r\n    // If the asset is invisible when loaded, then the bbox is\r\n    // not valid and the centroid becomes NaN\r\n    const assetBBox = this.__cadAsset.getParameter('BoundingBox').getValue()\r\n    // this.__assetCentroid = assetBBox.center()\r\n    // if (\r\n    //   Number.isNaN(this.__assetCentroid.x) ||\r\n    //   Number.isNaN(this.__assetCentroid.y) ||\r\n    //   Number.isNaN(this.__assetCentroid.z)\r\n    // ) {\r\n    this.__assetCentroid = new Vec3()\r\n    // }\r\n\r\n    const sceneBodyItemsData = new Float32Array(numBodyItems * floatsPerSceneBody)\r\n\r\n    let index = 0\r\n    this.__cadBodies = []\r\n    const highlightedBodies = []\r\n\r\n    const highlightChangeBatch = {\r\n      highlightedBodyIds: [],\r\n      unhighlightedBodyIds: [],\r\n      dirty: false,\r\n    }\r\n    const pushhighlightChangeBatchToWorker = () => {\r\n      this.__postMessageToWorker({\r\n        eventType: 'bodyHighlightChanged',\r\n        highlightedBodyIds: highlightChangeBatch.highlightedBodyIds,\r\n        unhighlightedBodyIds: highlightChangeBatch.unhighlightedBodyIds,\r\n      })\r\n      highlightChangeBatch.highlightedBodyIds = []\r\n      highlightChangeBatch.unhighlightedBodyIds = []\r\n      highlightChangeBatch.dirty = false\r\n    }\r\n\r\n    this.__dirtyBodyIndices = []\r\n    const bodyItemDataChanged = bodyId => {\r\n      if (this.__dirtyBodyIndices.indexOf(bodyId) == -1) {\r\n        this.__dirtyBodyIndices.push(bodyId)\r\n        this.emit('updated')\r\n      }\r\n    }\r\n\r\n    const bindCADBody = cadBody => {\r\n      const bodyId = index\r\n      if (bodyId >= numBodyItems) return\r\n\r\n      // Data passed to the web worker to help setup layout.\r\n      const sceneBodyItemDataByteOffset = bodyId * floatsPerSceneBody * 4 /*bytes/channel*/\r\n      const sceneBodyItemData = new Float32Array(\r\n        sceneBodyItemsData.buffer,\r\n        sceneBodyItemDataByteOffset,\r\n        floatsPerSceneBody\r\n      )\r\n\r\n      const cadBodyTextureDataByteOffset = bodyId * pixelsPerCADBody * 4 /*channels/pixel*/ * 4 /*bytes/channel*/\r\n      const cadBodyTextureData = new Float32Array(\r\n        this.cadBodiesTextureData.buffer,\r\n        cadBodyTextureDataByteOffset,\r\n        pixelsPerCADBody * 4 /*channels/pixel*/\r\n      )\r\n\r\n      const glCADBody = new GLCADBody(cadBody, bodyId)\r\n      glCADBody.bind(\r\n        this.__cadpassdata,\r\n        sceneBodyItemData,\r\n        cadBodyTextureData,\r\n        bodyItemDataChanged,\r\n        highlightedBodies,\r\n        highlightChangeBatch,\r\n        pushhighlightChangeBatchToWorker\r\n      )\r\n\r\n      this.__cadBodies.push(glCADBody)\r\n      index++\r\n    }\r\n\r\n    this.__cadAsset.traverse(treeItem => {\r\n      if (treeItem instanceof CADBody) {\r\n        bindCADBody(treeItem)\r\n        return false\r\n      } else {\r\n        return true\r\n      }\r\n    })\r\n\r\n    ////////////////////////////////////////\r\n    // Greate the GLTexture.\r\n    const gl = this.__gl\r\n    this.__cadBodiesTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'FLOAT',\r\n      width: cadBodiesTextureSize,\r\n      height: cadBodiesTextureSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: this.cadBodiesTextureData,\r\n    })\r\n\r\n    ////////////////////////////////////////\r\n    // Detail Factor\r\n    // The detail factor is used to convert surface 'cost'\r\n    // to a given tesselation level.\r\n    // Here we start with a given tesselation desired for a\r\n    // circle the size of the asset bounding box.\r\n    // We calculate the cost of the circle (curvature * length^2)\r\n    const unitsScale = this.__cadAsset.getUnitsConversion()\r\n    const assetBBoxRadius = (assetBBox.size().length() * 0.5) / unitsScale\r\n\r\n    //////////////////////\r\n    // Calculate a detail value for a circle enclosing our bbox.\r\n    const lod = this.__cadAsset.lod\r\n    const detail = 128 * Math.pow(2, lod)\r\n    // Calculate the arc angle for a cricle subdivided to the detail level\r\n    const arcAngle = (Math.PI * 2.0) / detail\r\n    // Calculate the deviation to the circle at the middle of the arc.\r\n    const errorTolerance = assetBBoxRadius - assetBBoxRadius * Math.cos(arcAngle / 2)\r\n\r\n    // The smallest area of a drawn item.\r\n    // The renderer will skip any surfaces smaller than this item.\r\n    const surfaceAreaThreshold = 0 //Math.PI * (assetBBoxRadius * assetBBoxRadius * 0.000000005 * Math.pow(2, lod))\r\n    // Note: on the hospital sprinker system we get the following values on the GTX laptop.\r\n    // assetBBoxRadius: 67447  surfaceAreaThreshold: 285\r\n    // Skipping about 30 surfaces.\r\n\r\n    console.log(\r\n      'assetBBoxRadius:',\r\n      assetBBoxRadius,\r\n      ' errorTolerance:',\r\n      errorTolerance,\r\n      ' surfaceAreaThreshold:',\r\n      surfaceAreaThreshold\r\n    )\r\n\r\n    ////////////////////////////////////////\r\n    const curvesDataBuffer = this.__cadAsset.getSurfaceLibrary().getCurveBuffer()\r\n    const surfacesDataBuffer = this.__cadAsset.getSurfaceLibrary().getSurfaceBuffer()\r\n    const cadDataVersion = this.__cadAsset.getVersion()\r\n\r\n    const trimSetsBuffer = this.__cadAsset.getTrimSetLibrary().getBinaryBuffer()\r\n    let trimTexelSize = -1\r\n    if (trimSetsBuffer) {\r\n      const numAssets = this.__cadpassdata.assetCount\r\n      trimTexelSize = this.__cadAsset.getTrimSetLibrary().getTexelSize(lod, numAssets)\r\n      // const mult = Math.pow(2, this.__cadAsset.getLOD());\r\n      // trimTexelSize = this.__cadAsset.getTrimTexelSize() * mult;\r\n    }\r\n\r\n    const bodyLibraryBufferToc = this.__cadAsset.getBodyLibrary().getToc()\r\n    const bodyLibraryBuffer = this.__cadAsset.getBodyLibrary().getBinaryBuffer()\r\n\r\n    const transferables = [surfacesDataBuffer, bodyLibraryBufferToc, bodyLibraryBuffer]\r\n    if (trimSetsBuffer) transferables.push(trimSetsBuffer)\r\n\r\n    const assemblyData = {\r\n      eventType: 'loadAssembly',\r\n      assetId: this.__assetId,\r\n      curvesDataBuffer,\r\n      surfacesDataBuffer,\r\n      cadDataVersion,\r\n      trimSetsBuffer,\r\n      lod: this.__cadAsset.getLOD(),\r\n      maxTexSize: this.__cadpassdata.maxTexSize / 2,\r\n      errorTolerance,\r\n      surfaceAreaThreshold,\r\n      trimTexelSize,\r\n      sceneBodyItemsData,\r\n      bodyLibraryBufferToc,\r\n      bodyLibraryBuffer,\r\n      highlightedBodies,\r\n    }\r\n    this.__postMessageToWorker(assemblyData, transferables)\r\n  }\r\n\r\n  updateBodyTexture(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    const texId = this.__gl.TEXTURE0 + renderstate.boundTextures + 1\r\n    gl.activeTexture(texId)\r\n    gl.bindTexture(gl.TEXTURE_2D, this.__cadBodiesTexture.glTex)\r\n    const size = this.__cadBodiesTexture.width\r\n    for (let i = 0; i < this.__dirtyBodyIndices.length; i++) {\r\n      const bodyId = this.__dirtyBodyIndices[i]\r\n      const yoffset = Math.floor((bodyId * pixelsPerCADBody) / size)\r\n      const xoffset = (bodyId * pixelsPerCADBody) % size\r\n\r\n      const glCADBody = this.__cadBodies[bodyId]\r\n      glCADBody.updateCadBodyTex()\r\n\r\n      const width = pixelsPerCADBody\r\n      const height = 1\r\n\r\n      const cadBodyTextureDataByteOffset = bodyId * pixelsPerCADBody * 4 /*channels/pixel*/ * 4 /*bytes/channel*/\r\n      const cadBodyTextureData = new Float32Array(\r\n        this.cadBodiesTextureData.buffer,\r\n        cadBodyTextureDataByteOffset,\r\n        pixelsPerCADBody * 4 /*channels/pixel*/\r\n      )\r\n      this.__cadBodiesTexture.populate(cadBodyTextureData, width, height, xoffset, yoffset, false)\r\n    }\r\n    gl.bindTexture(gl.TEXTURE_2D, null)\r\n\r\n    this.__dirtyBodyIndices = []\r\n  }\r\n\r\n  /**\r\n   * The __postMessageToWorker method.\r\n   * @param {any} data - The data param.\r\n   * @param {any} transferables - The transferables param.\r\n   * @private\r\n   */\r\n  __postMessageToWorker(data, transferables) {\r\n    // if(this.__cadpassdata.debugMode) {\r\n    //   setTimeout(()=>{\r\n    //     GLCADAssetWorker_onmessage(data, this.__onWorkerMessage.bind(this));\r\n    //   },100);\r\n    // }\r\n    // else\r\n    {\r\n      if (!this.__worker) this.__worker = new GLCADAssetWorker()\r\n      this.__worker.onmessage = event => {\r\n        this.__onWorkerMessage(event.data) // loading done...\r\n      }\r\n      this.__worker.postMessage(data, this.__cadpassdata.debugMode ? [] : transferables)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __onWorkerMessage method.\r\n   * @param {any} data - The data param.\r\n   * @private\r\n   */\r\n  __onWorkerMessage(data) {\r\n    switch (data.eventType) {\r\n      case 'loadAssetDone':\r\n        console.log('Layout Asset:', this.getCADAsset().getName(), data.profiling)\r\n\r\n        // ///////////////////////////////\r\n        // Curves, Surfaces and Trim Sets\r\n\r\n        // this.__gl.finish();\r\n\r\n        if (data.curvesAtlasLayout) {\r\n          this.__curveLibrary.evaluateCurves(\r\n            data.curvesAtlasLayout,\r\n            data.numCurves,\r\n            data.curvesAtlasLayoutTextureSize,\r\n            data.curvesAtlasTextureDim\r\n          )\r\n        }\r\n\r\n        // Note: rollup is generating radom problems in production builds\r\n        // values are getting assigned classes. The profiling values here\r\n        // become assigned class definitions, which then cause crashes or\r\n        // garbage logging\r\n        // Here, if we bundle the values into an object, then its ok.\r\n        // This is probably due to the use to WebWorkers this this file.\r\n        // We should try updating rollup and see if these hacks can be\r\n        // removed.\r\n        const values = {}\r\n\r\n        if (data.surfacesEvalAttrs) {\r\n          values.surfaceEvalTime = this.__surfaceLibrary.evaluateSurfaces(\r\n            data.surfacesEvalAttrs,\r\n            data.surfacesAtlasLayout,\r\n            data.surfacesAtlasLayoutTextureSize,\r\n            data.surfacesAtlasTextureDim\r\n          )\r\n        }\r\n\r\n        if (data.trimCurveDrawSets && data.trimSetAtlasTextureSize[0] > 0 && data.trimSetAtlasTextureSize[1] > 0) {\r\n          this.__trimSetLibrary.evaluateTrimSets(\r\n            data.trimCurveDrawSets,\r\n            data.trimSetAtlasTextureSize,\r\n            data.trimSetsAtlasLayoutData,\r\n            data.trimSetsAtlasLayoutTextureSize\r\n          )\r\n        }\r\n\r\n        // ///////////////////////////////\r\n        // Draw Items\r\n\r\n        this.__bodyAtlasDim = data.bodyAtlasDim\r\n        // this.updateDrawItems(data.evalDrawItemShaderAttribs)\r\n        this.updateDrawSets(values, data.surfaceDrawSets, data.curveDrawSets)\r\n        this.__ready = true\r\n\r\n        this.emit('loaded', {\r\n          numSurfaces: data.profiling.numSurfaces,\r\n          numSurfaceInstances: data.profiling.numSurfaceInstances,\r\n          surfaceEvalTime: values.surfaceEvalTime,\r\n          numBodies: data.profiling.numBodies,\r\n          numMaterials: this.__numMaterials,\r\n          numTriangles: values.numTriangles,\r\n          numDrawSets: values.numDrawSets,\r\n        })\r\n        this.emit('updated')\r\n        break\r\n      case 'highlightedSurfaceDrawSetsChanged':\r\n        for (const drawSetKey in data.highlightedSurfaceDrawSets) {\r\n          const drawSet = this.__surfaceDrawSets[drawSetKey]\r\n          if (!drawSet) {\r\n            console.warn('Selecting invalid items:', drawSetKey)\r\n            continue\r\n          }\r\n          drawSet.setDrawItems(data.highlightedSurfaceDrawSets[drawSetKey], 1)\r\n        }\r\n        this.incHighlightedCount(data.numHighlighted)\r\n        this.decHighlightedCount(data.numUnhighlighted)\r\n        this.emit('updated')\r\n        break\r\n    }\r\n\r\n    // if (data.lodChanges.length != 0){\r\n    //     const eachLODChange = (change)=>{\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setLod(change.lod - 1);\r\n    //     }\r\n    //     // console.log(\"lodChanges:\" + data.lodChanges.length)\r\n    //     data.lodChanges.forEach(eachLODChange);\r\n    // }\r\n    // if (data.becomingInvisible.length != 0 || data.becomingVisible.length != 0){\r\n    //     const eachBecomingInvisibleChange = (change)=>{\r\n    //         // console.log(\"BecomingInvisible:\" + change.bodyIndex + \":\" + change.surfaceIndex);\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setInvisible();\r\n    //     }\r\n    //     // console.log(\"becomingInvisible:\" + data.becomingInvisible.length)\r\n    //     data.becomingInvisible.forEach(eachBecomingInvisibleChange);\r\n\r\n    //     const eachBecomingVisibleChange = (change)=>{\r\n    //         // console.log(\"BecomingVisible:\" + change.bodyIndex + \":\" + change.surfaceIndex);\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setVisible();\r\n    //     }\r\n    //     // console.log(\"becomingVisible:\" + data.becomingVisible.length)\r\n    //     data.becomingVisible.forEach(eachBecomingVisibleChange);\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The updateDrawItems method.\r\n   * @param {any} evalDrawItemShaderAttribs - The evalDrawItemShaderAttribs param.\r\n   */\r\n  updateDrawSets(values, surfaceDrawSets, curveDrawSets) {\r\n    values.numTriangles = 0\r\n    values.numDrawSets = 0\r\n\r\n    if (surfaceDrawSets) {\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const drawSetKey in surfaceDrawSets) {\r\n        let drawSet = this.__surfaceDrawSets[drawSetKey]\r\n        // Note: on initialization, there are no draw sets, so\r\n        // we always construct the draw set here.\r\n        if (!drawSet) {\r\n          const parts = drawSetKey.split('x')\r\n          const detailX = parseInt(parts[0])\r\n          const detailY = parseInt(parts[1])\r\n          drawSet = new GLSurfaceDrawSet(this.__gl, detailX, detailY)\r\n          this.__surfaceDrawSets[drawSetKey] = drawSet\r\n        }\r\n\r\n        const drawSetData = surfaceDrawSets[drawSetKey]\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const subSetKey in drawSetData) {\r\n          const drawItemsData = drawSetData[subSetKey]\r\n          values.numTriangles += drawSet.addDrawItems(drawItemsData, subSetKey)\r\n        }\r\n\r\n        values.numDrawSets++\r\n      }\r\n    }\r\n    if (curveDrawSets) {\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const drawSetKey in curveDrawSets) {\r\n        let drawSet = this.__curveDrawSets[drawSetKey]\r\n        // Note: on initialization, there are no draw sets, so\r\n        // we always construct the draw set here.\r\n        if (!drawSet) {\r\n          const detail = parseInt(drawSetKey)\r\n          drawSet = new GLCurveDrawSet(this.__gl, detail)\r\n          this.__curveDrawSets[drawSetKey] = drawSet\r\n        }\r\n\r\n        const drawSetData = curveDrawSets[drawSetKey]\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const subSetKey in drawSetData) {\r\n          const drawItemsData = drawSetData[subSetKey]\r\n          drawSet.addDrawItems(drawItemsData, subSetKey)\r\n        }\r\n\r\n        values.numDrawSets++\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindDrawItemsAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n\r\n  bindDrawItemsAtlas(renderstate) {\r\n    this.__drawItemsTarget.bindColorTexture(renderstate, renderstate.unifs.drawItemsTexture)\r\n    // this.__drawItemsTexture.bindToUniform(renderstate, renderstate.unifs.drawItemsTexture);\r\n    if (renderstate.unifs.vert_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(\r\n        renderstate.unifs.vert_drawItemsTextureSize.location,\r\n        this.__bodyAtlasDim[0],\r\n        this.__bodyAtlasDim[1]\r\n      )\r\n    }\r\n    if (renderstate.unifs.frag_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(\r\n        renderstate.unifs.frag_drawItemsTextureSize.location,\r\n        this.__bodyAtlasDim[0],\r\n        this.__bodyAtlasDim[1]\r\n      )\r\n    }\r\n  }\r\n\r\n  bind(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    // console.log(\"bind:\", Object.keys(unifs))\r\n\r\n    // this.bindDrawItemsAtlas(renderstate)\r\n    // if (unifs.drawItemsTexture) {\r\n    //   this.__drawItemsTarget.bindColorTexture(\r\n    //     renderstate,\r\n    //     unifs.drawItemsTexture\r\n    //   )\r\n    // }\r\n\r\n    if (unifs.vert_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(unifs.vert_drawItemsTextureSize.location, this.__bodyAtlasDim[0], this.__bodyAtlasDim[1])\r\n    }\r\n    if (unifs.frag_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(unifs.frag_drawItemsTextureSize.location, this.__bodyAtlasDim[0], this.__bodyAtlasDim[1])\r\n    }\r\n\r\n    if (unifs.bodyDescTexture) {\r\n      this.__bodyDescTexture.bindToUniform(renderstate, unifs.bodyDescTexture)\r\n      gl.uniform2i(unifs.bodyDescTextureSize.location, this.__bodyDescTexture.width, this.__bodyDescTexture.height)\r\n      if (unifs.bodyDescTextureSize_frag) {\r\n        gl.uniform2i(\r\n          unifs.bodyDescTextureSize_frag.location,\r\n          this.__bodyDescTexture.width,\r\n          this.__bodyDescTexture.height\r\n        )\r\n      }\r\n    }\r\n\r\n    if (unifs.cadBodiesTexture) {\r\n      this.__cadBodiesTexture.bindToUniform(renderstate, unifs.cadBodiesTexture)\r\n      if (unifs.cadBodiesTextureSize_vert)\r\n        gl.uniform1i(unifs.cadBodiesTextureSize_vert.location, this.__cadBodiesTexture.width)\r\n      if (unifs.cadBodiesTextureSize_frag)\r\n        gl.uniform1i(unifs.cadBodiesTextureSize_frag.location, this.__cadBodiesTexture.width)\r\n    }\r\n\r\n    // if (unifs.cutNormal) {\r\n    //   gl.uniform3fv(unifs.cutNormal.location, this.__cutNormal.asArray())\r\n    //   gl.uniform1f(unifs.planeDist.location, this.__cutDist)\r\n    //   if (unifs.cutColor) {\r\n    //     gl.uniform4fv(unifs.cutColor.location, this.__cutColor.asArray())\r\n    //   }\r\n    // }\r\n\r\n    if (unifs.assetCentroid) {\r\n      gl.uniform3fv(unifs.assetCentroid.location, this.__assetCentroid.asArray())\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  draw(renderstate) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    if (this.__dirtyBodyIndices.length > 0) {\r\n      this.updateBodyTexture(renderstate)\r\n    }\r\n\r\n    this.bind(renderstate)\r\n\r\n    if (!this.__surfaceLibrary.bindSurfacesAtlas(renderstate)) {\r\n      renderstate.boundTextures = boundTextures\r\n      return\r\n    }\r\n\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, renderstate.shaderId)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawHighlightedGeoms method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawHighlightedGeoms(renderstate) {\r\n    if (!this.__visible || this.__numHighlightedGeoms == 0) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    // Now draw the highlight outline.\r\n    const highlightOutlineID = 1\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, highlightOutlineID)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawNormals method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} shaderKey - The shaderKey param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawNormals(renderstate, shaderKey) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.drawNormals(renderstate, shaderKey)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawEdges method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} shaderKey - The shaderKey param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawEdges(renderstate, shaderKey) {\r\n    if (!this.__visible || !this.__ready || !this.displayEdges) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n    if (this.__dirtyBodyIndices.length > 0) {\r\n      this.updateBodyTexture(renderstate)\r\n    }\r\n\r\n    this.bind(renderstate)\r\n    this.__curveLibrary.bindCurvesAtlas(renderstate)\r\n\r\n    const gl = this.__gl\r\n    gl.uniform4fv(renderstate.unifs.edgeColor.location, this.edgeColor)\r\n\r\n    for (const key in this.__curveDrawSets) {\r\n      const drawSet = this.__curveDrawSets[key]\r\n      drawSet.draw(renderstate, shaderKey)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawGeomData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawGeomData(renderstate) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    const gl = this.__gl\r\n    const assetIndexUnif = renderstate.unifs.assetIndex\r\n    if (assetIndexUnif) {\r\n      gl.uniform1i(assetIndexUnif.location, this.__assetId)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, renderstate.shaderId)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The getGeomItem method.\r\n   * @param {any} bodyId - The bodyId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getGeomItem(bodyId) {\r\n    return this.__cadBodies[bodyId].cadBody\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId) {\r\n    return this.__cadAsset.getSurfaceLibrary().getSurfaceData(surfaceId)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawSurfaceAtlas(renderstate) {\r\n    if (this.__surfaceLibrary) this.__surfaceLibrary.drawSurfaceAtlas(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The drawTrimSets method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawTrimSets(renderstate) {\r\n    if (this.__trimSetLibrary) this.__trimSetLibrary.drawTrimSets(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__cadAsset.off('visibilityChanged', this.__assetVisibilityChanged)\r\n\r\n    this.__cadBodiesTexture.destroy()\r\n\r\n    this.__cadBodies.forEach(glCADBody => glCADBody.destroy())\r\n    this.__cadBodies = []\r\n    this.__curveLibrary.destroy()\r\n    this.__surfaceLibrary.destroy()\r\n\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.destroy()\r\n    }\r\n\r\n    for (const drawSetKey in this.__surfaceDrawSets) {\r\n      let drawSet = this.__surfaceDrawSets[drawSetKey]\r\n      drawSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCADAsset }\r\n","import { EventEmitter, GrowingPacker, GLTexture2D, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL CAD material library.\r\n * @ignore\r\n */\r\nclass GLCADMaterialLibrary extends EventEmitter {\r\n  /**\r\n   * Create a GL CAD material library.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__materialDatas = []\r\n    this.__dirtyIndices = []\r\n    this.__numItems = 0\r\n    this.__materialPacker = new GrowingPacker(256, 256)\r\n\r\n    this.__needsUpload = false\r\n  }\r\n\r\n  /**\r\n   * The addMaterial method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addMaterial(material) {\r\n    if (material.getMetadata('glmaterialcoords')) {\r\n      return\r\n    }\r\n\r\n    this.__numItems++\r\n\r\n    const coords = this.__materialPacker.addBlock({ w: 2, h: 1 })\r\n    const materialId = this.__materialDatas.length\r\n    this.__materialDatas.push({\r\n      material,\r\n      coords,\r\n    })\r\n\r\n    material.on('parameterValueChanged', () => {\r\n      // this.__renderer.requestRedraw();\r\n      this.__dirtyIndices.push(materialId)\r\n      this.emit('updated')\r\n    })\r\n\r\n    material.setMetadata('glmaterialcoords', coords)\r\n\r\n    this.__dirtyIndices.push(materialId)\r\n\r\n    return coords\r\n  }\r\n\r\n  /**\r\n   * The needsUpload method.\r\n   * @return {any} - The return value.\r\n   */\r\n  needsUpload() {\r\n    return this.__dirtyIndices.length > 0\r\n  }\r\n\r\n  /**\r\n   * The uploadMaterials method.\r\n   */\r\n  uploadMaterials() {\r\n    const gl = this.__gl\r\n    const width = this.__materialPacker.root.w\r\n    const height = this.__materialPacker.root.h\r\n    console.log('Num Used Materials:' + this.__numItems, width, height)\r\n    if (!this.__materialsTexture) {\r\n      this.__materialsTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width,\r\n        height,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__materialsTexture.clear()\r\n    } else if (this.__materialsTexture.width != width || this.__materialsTexture.height != height) {\r\n      throw new Error('Cannot resize here. Need a resize the preserves the data.')\r\n      this.__materialsTexture.resize(width, height)\r\n      this.__dirtyIndices = Array(this.__bodyDrawItems.length)\r\n        .fill()\r\n        .map((v, i) => i)\r\n    }\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, this.__materialsTexture.glTex)\r\n    const typeId = this.__materialsTexture.getTypeID()\r\n    const formatId = this.__materialsTexture.getFormatID()\r\n\r\n    const eachMaterial = value => {\r\n      const materialData = this.__materialDatas[value]\r\n      const material = materialData.material\r\n\r\n      let shaderClass = Registry.getBlueprint(material.getShaderName())\r\n      if (!shaderClass || !shaderClass.getPackedMaterialData) {\r\n        shaderClass = Registry.getBlueprint('GLDrawCADSurfaceShader')\r\n      }\r\n\r\n      const matData = shaderClass.getPackedMaterialData(material)\r\n\r\n      const width = matData.length / 4 // 4==RGBA pixels.\r\n      const height = 1\r\n\r\n      const coords = materialData.coords\r\n      if (typeId == gl.FLOAT) {\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, coords.x, coords.y, width, height, formatId, typeId, matData)\r\n      } else {\r\n        const unit16s = Math.convertFloat32ArrayToUInt16Array(matData)\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, coords.x, coords.y, width, height, formatId, typeId, unit16s)\r\n      }\r\n    }\r\n    this.__dirtyIndices.forEach(eachMaterial)\r\n    this.__dirtyIndices = []\r\n    gl.bindTexture(gl.TEXTURE_2D, null)\r\n  }\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (!this.__materialsTexture) return false\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (unifs.materialsTexture) this.__materialsTexture.bindToUniform(renderstate, unifs.materialsTexture)\r\n    if (unifs.materialsTextureSize)\r\n      gl.uniform2i(unifs.materialsTextureSize.location, this.__materialsTexture.width, this.__materialsTexture.height)\r\n    return true\r\n  }\r\n}\r\nexport { GLCADMaterialLibrary }\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLBinReader.glsl',\r\n  `\r\n\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n\r\n/////////////////////////////////////////////////////////////////\r\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\r\n// Note: modulo on some GPUS. (e.g. iPhone)\r\n// often incur errors in modulo, leaving a result\r\n// that appears to boe the y param. in this use case\r\n// we are only interested in integer moduos anyway\r\n// so we just trim off erronious values. .Seems to work. \r\nfloat fixed_mod(float x, float y) {\r\n  float res = mod(x, y);\r\n  return (abs(y - res) < 0.5) ? 0.0 : res;\r\n}\r\n\r\nfloat shift_right(float v, float amt) {\r\n  v = floor(v) + 0.5;\r\n  return floor(v / exp2(amt));\r\n}\r\n\r\nfloat shift_left(float v, float amt) {\r\n  return floor(v * exp2(amt) + 0.5);\r\n}\r\n\r\nfloat mask_last(float v, float bits) {\r\n  return fixed_mod(v, shift_left(1.0, bits));\r\n}\r\n\r\nfloat extract_bits(float num, float from, float to) {\r\n  from = floor(from + 0.5);\r\n  to = floor(to + 0.5);\r\n  return mask_last(shift_right(num, from), to - from);\r\n}\r\n\r\n\r\n/////////////////////////////////////////////////////////////////\r\n\r\nfloat decode16BitFloatFrom2xUInt8_IEEE(vec2 c){\r\n  float v = 0.;\r\n\r\n  // int h = c.x + c.y * 256;\r\n  // const s = (h & 0x8000) >> 15;\r\n  // const e = (h & 0x7C00) >> 10;\r\n  // const f = h & 0x03FF;\r\n\r\n\r\n  // float h = c.x + c.y * 256.0;\r\n  // float s = extract_bits(h, 15.0, 16.0);\r\n  // float e = extract_bits(h, 10.0, 15.0);\r\n  // float f = extract_bits(h, 0.0, 10.0);\r\n\r\n  // float s = extract_bits(c.y, 7.0, 8.0);\r\n  // float e = extract_bits(c.y, 2.0, 7.0);\r\n\r\n  int s = (c.y >= 127.5) ? 1 : 0;\r\n  float e = shift_right(c.y - ((s == 1) ? 128.0 : 0.0), 2.0);\r\n  float f = c.x + mask_last(c.y, 2.0) * 256.0;\r\n  // return float(s);\r\n\r\n  if(e < 0.5) {\r\n    return ((s!=0)?-1.0:1.0) * exp2(-14.0) * (f/exp2(10.0));\r\n  } else if (int(e) == 0x1F) {\r\n    float NaN = 0.0;\r\n    float Inf = 0.0;\r\n    return (f==0.0)?(NaN):(((s!=0)?-1.0:1.0)*Inf);\r\n  }\r\n\r\n  return ((s!=0)?-1.0:1.0) * exp2(e-15.0) * (1.0+(f/exp2(10.0)));\r\n}\r\n\r\n#endif\r\n\r\n// RGBA16 textures\r\nvec4 GLSLBinReader_texelFetch2D(sampler2D texture, ivec2 textureSize, ivec2 address) {\r\n  return fetchTexel(texture, textureSize, address);\r\n}\r\n\r\nstruct GLSLBinReader {\r\n  ivec2 textureSize; \r\n  ivec4 region;\r\n  ivec2 start; /* the base address from which we base the offsets */\r\n  int offset; /* how far we have read into the buffer . Note: value is in channels. so 4 == 1 pixel.*/\r\n  vec4 buffer; \r\n  ivec2 bufferaddress;\r\n  int bpc; // bits per channel. (e.g. 8, 16, 32)\r\n};\r\n\r\nvoid GLSLBinReader_init(inout GLSLBinReader reader, ivec2 textureSize, ivec4 region, ivec2 start, int bpc) {\r\n  reader.textureSize = textureSize;\r\n  reader.region = region;\r\n  reader.start = start;\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n  reader.start = ivec2(start.x * 2, start.y);\r\n#else\r\n  reader.start = start;\r\n#endif\r\n  reader.bpc = bpc;\r\n  reader.bufferaddress = ivec2(-1, -1);\r\n}\r\n\r\nvoid GLSLBinReader_init(inout GLSLBinReader reader, ivec2 textureSize, int bpc) {\r\n  reader.textureSize = textureSize;\r\n  reader.region = ivec4(0, 0, textureSize.x, textureSize.y);\r\n  reader.start = ivec2(0,0);\r\n  reader.bpc = bpc;\r\n  reader.bufferaddress = ivec2(-1, -1);\r\n}\r\n\r\n\r\nivec2 GLSLBinReader_getAddress(in GLSLBinReader reader, int offset) {\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n  ivec2 address = ivec2(reader.start.x + (offset/2), reader.start.y);\r\n#else\r\n  ivec2 address = ivec2(reader.start.x + (offset/4), reader.start.y);\r\n#endif\r\n  address.y += address.x / reader.region.z;\r\n  address.x = imod(address.x, reader.region.z);\r\n  return address;\r\n}\r\n\r\n\r\nfloat GLSLBinReader_readFloat(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n\r\n  ivec2 address = GLSLBinReader_getAddress(reader, offset);\r\n\r\n  if(address != reader.bufferaddress){\r\n    reader.buffer = GLSLBinReader_texelFetch2D(texture, reader.textureSize, reader.region.xy + address);\r\n    reader.bufferaddress = address;\r\n  }\r\n\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n\r\n  int swizelIndex = imod(offset, 2);\r\n  if(swizelIndex == 0)\r\n    return decode16BitFloatFrom2xUInt8_IEEE(reader.buffer.xy * 255.0);\r\n  return decode16BitFloatFrom2xUInt8_IEEE(reader.buffer.zw * 255.0);\r\n\r\n#else\r\n\r\n  int swizelIndex = imod(offset, 4);\r\n  if(swizelIndex == 0)\r\n    return reader.buffer.x;\r\n  if(swizelIndex == 1)\r\n    return reader.buffer.y;\r\n  if(swizelIndex == 2)\r\n    return reader.buffer.z;\r\n  return reader.buffer.w;\r\n  \r\n#endif\r\n}\r\n\r\n\r\nint GLSLBinReader_readInt(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture, offset) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture, offset);\r\n    return int(flt);\r\n  }\r\n}\r\n\r\nint GLSLBinReader_readUInt(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture, offset) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture, offset);\r\n    if (flt < 0.0) {\r\n      return int(2048.0 - flt);\r\n    }\r\n    else {\r\n      return int(flt);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 GLSLBinReader_readVec4(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  ivec2 address = GLSLBinReader_getAddress(reader, offset);\r\n  return GLSLBinReader_texelFetch2D(texture, reader.textureSize, reader.region.xy + address);\r\n}\r\n\r\n\r\nvec3 GLSLBinReader_readVec3(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  return GLSLBinReader_readVec4(reader, texture, offset).rgb;\r\n}\r\n\r\nvec2 GLSLBinReader_readVec2(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  return vec2(\r\n    GLSLBinReader_readFloat(reader, texture, offset),\r\n    GLSLBinReader_readFloat(reader, texture, offset+1)\r\n  );\r\n}\r\n\r\n\r\n\r\nfloat GLSLBinReader_readFloat(inout GLSLBinReader reader, sampler2D texture) {\r\n  float result = GLSLBinReader_readFloat( reader,  texture, reader.offset);\r\n  reader.offset++;\r\n  return result;\r\n}\r\n\r\nint GLSLBinReader_readInt(inout GLSLBinReader reader, sampler2D texture) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture) * 255.0);\r\n  else\r\n    return int(GLSLBinReader_readFloat(reader, texture));\r\n}\r\n\r\nint GLSLBinReader_readUInt(inout GLSLBinReader reader, sampler2D texture) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture);\r\n    if (flt < 0.0) {\r\n      return int(2048.0 - flt);\r\n    }\r\n    else {\r\n      return int(flt);\r\n    }\r\n  }\r\n}\r\n\r\nint GLSLBinReader_readUIntFrom2xUFloat16(inout GLSLBinReader reader, sampler2D texture) {\r\n  int partA = GLSLBinReader_readUInt(reader, texture);\r\n  int partB = GLSLBinReader_readUInt(reader, texture);\r\n  \r\n#ifdef INTS_PACKED_AS_2FLOAT16\r\n  // Changed on version 0.0.28\r\n  return partA + (partB * 4096);\r\n#else\r\n  return partA + (partB * 256);\r\n#endif\r\n}\r\n\r\nvec4 GLSLBinReader_readVec4(inout GLSLBinReader reader, sampler2D texture) {\r\n  vec4 result = GLSLBinReader_readVec4( reader, texture, reader.offset);\r\n  reader.offset += 4;\r\n  return result;\r\n}\r\n\r\n\r\nvec3 GLSLBinReader_readVec3(inout GLSLBinReader reader, sampler2D texture) {\r\n  return GLSLBinReader_readVec4(reader, texture).rgb;\r\n}\r\n\r\nvec2 GLSLBinReader_readVec2(inout GLSLBinReader reader, sampler2D texture) {\r\n  return vec2(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLMath.glsl',\r\n  `\r\n\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n\r\n  ////////////////////////////////////////\r\n  \r\n  struct Xfo2d {\r\n    vec2 tr;\r\n    float rot;\r\n    vec2 sc;\r\n  };\r\n\r\n  vec2 rotateVec2(float rot, vec2 vec){\r\n    float cosa = cos(rot);\r\n    float sina = sin(rot);\r\n    return vec2(vec.x * cosa - vec.y * sina, vec.x * sina + vec.y * cosa);\r\n  }\r\n\r\n  vec2 Xfo2D_transformVec2(Xfo2d xfo2d, vec2 pos){\r\n    return xfo2d.tr + rotateVec2(xfo2d.rot, pos * xfo2d.sc);\r\n  }\r\n\r\n  ////////////////////////////////////////\r\n\r\n\r\n  vec4 quat_fromAxisAndAngle(vec3 axis, float angle) {\r\n    float halfAngle = angle / 2.0;\r\n    vec3 vec = axis* sin(halfAngle);\r\n    return vec4(vec.x, vec.y, vec.z, cos(halfAngle));\r\n  }\r\n\r\n  vec4 quat_conjugate(vec4 quat) {\r\n    return vec4(-quat.x, -quat.y, -quat.z, quat.w);\r\n  }\r\n\r\n  vec4 quat_multiply(vec4 lhs, vec4 rhs) {\r\n    float ax = lhs.x;\r\n    float ay = lhs.y;\r\n    float az = lhs.z;\r\n    float aw = lhs.w;\r\n    float bx = rhs.x;\r\n    float by = rhs.y;\r\n    float bz = rhs.z;\r\n    float bw = rhs.w;\r\n    return vec4(\r\n      ax * bw + aw * bx + ay * bz - az * by,\r\n      ay * bw + aw * by + az * bx - ax * bz,\r\n      az * bw + aw * bz + ax * by - ay * bx,\r\n      aw * bw - ax * bx - ay * by - az * bz\r\n    );\r\n  }\r\n\r\n  vec3 quat_rotateVec3(vec4 quat, vec3 rhs) {\r\n    vec4 vq = vec4(rhs.x, rhs.y, rhs.z, 0.0);\r\n    vec4 pq = quat_multiply(quat_multiply(quat, vq), quat_conjugate(quat));\r\n    return vec3(pq.x, pq.y, pq.z);\r\n  }\r\n\r\n\r\n  mat4 tr_toMat4(vec3 tr) {\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    vec4 col0 = vec4(1.0, 0.0, 0.0, 0.0);\r\n    vec4 col1 = vec4(0.0, 1.0, 0.0, 0.0);\r\n    vec4 col2 = vec4(0.0, 0.0, 1.0, 0.0);\r\n    vec4 col3 = vec4(tr, 1.0);\r\n    return mat4(col0, col1, col2, col3);\r\n  }\r\n\r\n  mat4 quat_toMat4(vec4 quat) {\r\n\r\n    float x2 = quat.x + quat.x;\r\n    float y2 = quat.y + quat.y;\r\n    float z2 = quat.z + quat.z;\r\n\r\n    float xx = quat.x * x2;\r\n    float yx = quat.y * x2;\r\n    float yy = quat.y * y2;\r\n    float zx = quat.z * x2;\r\n    float zy = quat.z * y2;\r\n    float zz = quat.z * z2;\r\n    float wx = quat.w * x2;\r\n    float wy = quat.w * y2;\r\n    float wz = quat.w * z2;\r\n\r\n\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    vec4 col0 = vec4(\r\n      1.0 - yy - zz,\r\n      yx - wz,\r\n      zx + wy,\r\n      0.0);\r\n\r\n    vec4 col1 = vec4(\r\n      yx + wz,\r\n      1.0 - xx - zz,\r\n      zy - wx,\r\n      0.0);\r\n\r\n    vec4 col2 = vec4(\r\n      zx - wy,\r\n      zy + wx,\r\n      1.0 - xx - yy,\r\n      0.0);\r\n\r\n    vec4 col3 = vec4(\r\n      0.0,\r\n      0.0,\r\n      0.0,\r\n      1.0);\r\n\r\n    // return mat4(col0, col1, col2, col3);\r\n    return transpose(mat4(col0, col1, col2, col3));\r\n  }\r\n\r\n  mat4 sc_toMat4(vec3 sc) {\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    return mat4(\r\n      sc.x, 0.0,  0.0,  0.0,\r\n      0.0,  sc.y, 0.0,  0.0,\r\n      0.0,  0.0,  sc.z, 0.0,\r\n      0.0,  0.0,  0.0,  1.0);\r\n  }\r\n\r\n  struct Xfo {\r\n    vec3 tr;\r\n    vec4 ori;\r\n    vec3 sc;\r\n  };\r\n\r\n  Xfo xfo_multiply(Xfo xfo, Xfo other){\r\n    return Xfo(\r\n      xfo.tr + quat_rotateVec3(xfo.ori, xfo.sc * other.tr),\r\n      quat_multiply(xfo.ori, other.ori),\r\n      xfo.sc * other.sc\r\n    );\r\n  }\r\n\r\n  mat4 xfo_toMat4(Xfo xfo){\r\n    mat4 sc_mat4 = sc_toMat4(xfo.sc);\r\n    mat4 ori_mat4  = quat_toMat4(xfo.ori);\r\n    mat4 tr_mat4  = tr_toMat4(xfo.tr);\r\n    mat4 result = tr_mat4 * ori_mat4 * sc_mat4;\r\n    return result;\r\n  }\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADCurves.glsl',\r\n  `\r\n\r\n  // http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_curves\r\n\r\n\r\n\r\n// http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_surfaces\r\n\r\n\r\nvec2 loadVec2(inout GLSLBinReader reader, sampler2D texture) {\r\n  return vec2(GLSLBinReader_readFloat(reader, texture),  GLSLBinReader_readFloat(reader, texture));\r\n}\r\n\r\nfloat mapDomain1d(vec2 domain, float param) {\r\n  float u = domain.x + param * ( domain.y - domain.x );\r\n  return u;\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Line\r\n\r\nPosNorm calcLinePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float u = mapDomain1d( domain, param );\r\n  vec3 pos = vec3(u, 0.0, 0.0);\r\n  vec3 norm = vec3(1.0, 0.0, 0.0);\r\n  return PosNorm(pos, norm, CURVE_TYPE_LINE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Circle\r\n\r\nPosNorm calcCirclePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float radius = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  float u = mapDomain1d( domain, param );\r\n  vec3 pos = vec3(cos(u) * radius, sin(u) * radius, 0.0);\r\n  vec3 norm = vec3(-sin(u), cos(u), 0.0);\r\n  return PosNorm(pos, norm, CURVE_TYPE_CIRCLE);\r\n}\r\n\r\n\r\n\r\n/////////////////////////////////////////\r\n// Elipse3d\r\n// An ellipse is a periodic curve parametrized as follows: C(t) = P + X * R_major * cos(t) + Y * R_minor * sin(t), where\r\n\r\n// P is an origin point,\r\n// X and Y are directions,\r\n// R_major and R_minor are major and minor radii,\r\n// t belongs to [0, 2 * PI].\r\n// Note that major radius is always along the X-axis and minor radius - along the Y-axis, and that with t=0 the point corresponds to a major radius.\r\n\r\n\r\nPosNorm calcElipsePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float u = mapDomain1d( domain, param );\r\n  float minorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float majorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  vec3 pos = vec3(cos(u) * majorRadius, sin(u) * minorRadius, 0.0);\r\n  vec3 norm = normalize(vec3(-sin(u) * majorRadius, cos(u) * minorRadius, 0.0)); // TODO: fix this broken line.\r\n\r\n  // pos = vec3(float(minorRadius));\r\n\r\n  return PosNorm(pos, norm, CURVE_TYPE_ELIPSE);\r\n}\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSimpleSurfaces.glsl',\r\n  `\r\n\r\n  // http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_surfaces\r\n\r\n\r\n/////////////////////////////////////////\r\n// Plane\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcPlaneSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 pos = vec3(uv.x, uv.y, 0.0);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_PLANE);\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Poly Plane\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcPolyPlaneSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Domain does not need to be mapped in this case.\r\n  vec2 uv = params;\r\n  vec2 p0 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p1 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p2 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p3 = GLSLBinReader_readVec2(reader, texture);\r\n\r\n  vec2 pos = mix(mix(p0, p1, uv.x), mix(p3, p2, uv.x), uv.y);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(vec3(pos, 0.0), normal, SURFACE_TYPE_POLY_PLANE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Fan\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcFanSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Domain does not need to be mapped in this case.\r\n  vec2 uv = params;\r\n  // Skip forward 2 values for each vertex.\r\n  reader.offset += int(2.0 * floor(v_vertexCoord.x));\r\n  vec2 pos = GLSLBinReader_readVec2(reader, texture);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(vec3(pos, 0.0), normal, SURFACE_TYPE_FAN);\r\n}\r\n\r\n\r\n\r\n/////////////////////////////////////////\r\n// Cone\r\n// A conical surface is parametrized as follows: S(u,v) = P + r * cos(u) * Dx + r * sin(u) * Dy + v * cos() * Dz, where\r\n\r\n// P is an origin point,\r\n// Dx, Dy and Dz are directions (unit vectors) of X, Y and Z axes respectively,\r\n//  - semi-angle, i.e. an angle between Dz and any generatrix,\r\n// r = R + v * sin(), i.e. a radius of a circle at respective parameter v,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to (-infinity, +infinity).\r\n// U-parameter is an angle along the circle at a given parameter V and V-parameter is a length along the cone. Thus, U-isolines are lines and V-isoline are circles.\r\n\r\n// V-isoline at V=0 is a circle of radius R in the plane defined by an axis placement.\r\n\r\n// Conical surface contains both halfs of mathematical cone.\r\n\r\n// Conical surface is U-periodical with period 2 * PI. At a cone apex, r equals 0, hence V-parameter of an apex equals -R / sin()\r\n\r\n\r\nPosNorm calcConeSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n  float semiAngle = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  float r_at_v = r + v * sin(semiAngle);\r\n  vec3 pos = vec3(r_at_v * cos(u), r_at_v * sin(u), v * cos(semiAngle));\r\n  vec3 normal = normalize(vec3(cos(u)*cos(semiAngle), sin(u)*cos(semiAngle), -sin(semiAngle)));\r\n  return PosNorm(pos, normal, SURFACE_TYPE_CONE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Cylinder\r\n// A cylindrical surface is parametrized as follows: S(u,v) = P + R * cos(u) * dX + R * sin(u) * dY + v * dZ, where\r\n\r\n// P is an origin point,\r\n// dX, dY and dZ are directions (unit vectors) of X, Y and Z axes respectively,\r\n// R is a radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to (-infinity, +infinity).\r\n\r\n\r\nPosNorm calcCylinderSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 normal = vec3(cos(uv.x), sin(uv.x), 0.0);\r\n  vec3 pos = r * normal + vec3(0.0, 0.0, uv.y);\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_CYLINDER);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Sphere\r\n// A spherical surface is parametrized as follows: S(u,v) = P + R * cos(v) * (cos(u) * Dx + sin(u) * Dy) + R * sin(v) * Dz, where\r\n\r\n// P is an origin point,\r\n// Dx, Dy and Dz are directions (unit vectors) of X, Y and Z axes respectively,\r\n// R is a radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to [-PI/2, +PI/2].\r\n// U-parameter is an angle of rotation around the Dz axis counterclockwise (i.e. similar to longitude on the Earth), and V-parameter is an angle between plane defined by an axis placement and line from P to a point on a sphere (i.e. latitude). Thus, U-isolines are semi-circles and V-isoline are circles.\r\n\r\n// V-isoline at V=0 is a circle of radius R in the plane defined by an axis placement. U-isoline at U=0 corresponds to a semi-circle from south to north pole.\r\n\r\n// Spherical surface is U-periodical with period 2 * PI.\r\n\r\n// If a face lies on a full spherical surface its boundary wire will contain two a degenerated edges corresponding to the south and north poles (V equals -PI/2 and PI/2 respectively), and a seam-edge.\r\n\r\n\r\nPosNorm calcSphereSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  vec3 normal = vec3(cos(v) * cos(u), cos(v) * sin(u), sin(v));\r\n  vec3 pos = r * normal;\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_SPHERE);\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Torus\r\n\r\n// A toroidal surface is parametrized as follows: S(u,v) = (R1 + R2 * cos(v)) * (cos(u) * Dx + sin(u) * Dy) + R2 * sin(v) * Dz, where\r\n\r\n// R1 is a major radius,\r\n// R2 is a minor radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to [0, 2 * PI],\r\n// U-parameter is an angle when rotating around the Dz axis counterclockwise, and V-parameter is an angle in circular section at a given parameter U. Thus, U-isolines circles lying in the plane containing Z axis and V-isolines are circles in the planes perpendicular to Z axis.\r\n\r\n// V-isoline at V=0 is a circle of radius (R1 + R2) in the plane defined by an axis placement. U-isoline at U=0 is a circle of radius R2 in the plane containing Z and X axes.\r\n\r\n// Radii R1 and R2 must be positive. If R2 > R1 then toroidal surface will be self-intersecting.\r\n\r\n// Toroidal surface is both U- and V-periodical with periods 2 * PI.\r\n\r\n// If a face lies on a full toroidal surface its boundary wire will contain two seam-edges, corresponding to U=0 and U=2*PI, and V=0 and V=2*PI respectively.\r\n\r\n\r\nPosNorm calcTorusSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float majorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float minorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  vec3 pos = (majorRadius + minorRadius * cos(v)) * vec3(cos(u), sin(u), 0.0) + vec3(0.0, 0.0, minorRadius * sin(v));\r\n\r\n  vec3 normal = vec3(cos(v) * cos(u), cos(v) * sin(u), sin(v));\r\n  // vec3 pos = majorRadius * normal;\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_TORUS);\r\n}\r\n\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADCompoundSurfaces.glsl',\r\n  `\r\n\r\n/////////////////////////////////////////\r\n// LinearExtrusion\r\n\r\nPosNorm calcLinearExtrusionSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  \r\n  int curve_index = GLSLBinReader_readUIntFrom2xUFloat16(reader, texture);\r\n\r\n  vec3 curve_tr = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec4 curve_ori = vec4(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n    );\r\n  vec3 curve_sc = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  PosNorm curveResult = evalCADCurve3d(curve_index, uv.x);\r\n  \r\n  vec3 pos = quat_rotateVec3(curve_ori, curveResult.pos * curve_sc) + curve_tr;\r\n  pos.z += uv.y;\r\n\r\n  vec3 normal = normalize(cross(vec3(0.0, 0.0, 1.0), quat_rotateVec3(curve_ori, curveResult.normal)));\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_LINEAR_EXTRUSION);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Revolution\r\nPosNorm calcRevolutionSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture, bool flipDomain) {\r\n  box2 domain = loadBox2(reader, texture);\r\n\r\n  int curve_index = GLSLBinReader_readUIntFrom2xUFloat16(reader, texture);\r\n\r\n  vec3 curve_tr = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec4 curve_ori = vec4(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n    );\r\n  vec3 curve_sc = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 axis = vec3(0.0, 0.0, 1.0);\r\n  PosNorm curveResult;\r\n  vec4 rev;\r\n  if (flipDomain) {\r\n    curveResult = evalCADCurve3d(curve_index, uv.x);\r\n    rev = quat_fromAxisAndAngle(axis, uv.y);\r\n  } else {\r\n    curveResult = evalCADCurve3d(curve_index, uv.y);\r\n    rev = quat_fromAxisAndAngle(axis, uv.x);\r\n  }\r\n\r\n  vec3 p_t = quat_rotateVec3(curve_ori, curveResult.pos * curve_sc) + curve_tr;\r\n  vec3 pos = quat_rotateVec3(rev, p_t);\r\n\r\n  vec3 p_n = quat_rotateVec3(rev, quat_rotateVec3(curve_ori, curveResult.normal));\r\n  \r\n  vec3 tangent;\r\n  if (abs(1.0 - dot(p_n, axis)) > 0.001) {\r\n    tangent = cross(p_n, axis);\r\n  } else {\r\n    tangent = cross(pos, axis);\r\n  }\r\n  // TODO: Find a conclusive test file that demonstrates this as correct.\r\n  // I think it is the master cylinder sample.\r\n  // vec3 normal = normalize(cross(p_n, tangent));\r\n  vec3 normal = normalize(cross(tangent, p_n));\r\n\r\n  // vec3 pos;\r\n  // vec3 normal;\r\n  // pos.x = float(partA);\r\n  // pos.y = float(partB);\r\n  // pos.z = float(curve_index);\r\n  return PosNorm(pos, normal, SURFACE_TYPE_REVOLUTION);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// OffsetSurface\r\n\r\nPosNorm calcOffsetSurfaceSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  int surfaceId = GLSLBinReader_readUInt(reader, texture);\r\n  float offset = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n/*\r\n  GLSLBinReader subSurfaceReader = reader;\r\n  subSurfaceReader.start = \r\n  GLSLBinReader_init(reader, surfaceDataTextureSize, region, start, 32);\r\n\r\n  vec3 p = calcCurvePoint(uv.x);\r\n  vec3 pos = p + dir * (dist * uv.y);\r\n  \r\n*/\r\n  vec3 pos;\r\n  vec3 normal;\r\n  return PosNorm(pos, normal, SURFACE_TYPE_OFFSET_SURFACE);\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBS.glsl',\r\n  `\r\n\r\n#define MAX_KNOTS 256\r\n// Note: The BRP motorcycle features many surfaces of degree 15.\r\n#define MAX_DEGREE 16\r\n\r\nfloat kp(int index, inout GLSLBinReader r, sampler2D t, int offset) {\r\n  return GLSLBinReader_readFloat(r, t, offset+index);\r\n}\r\n\r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n\r\nint findSpan(float u, in int degree, in int numKnots, int kpOff, inout GLSLBinReader r, sampler2D t, out highp float knots[MAX_DEGREE*2+1]) {\r\n  \r\n  float nextKnot = kp(0, r, t, kpOff);\r\n  float knot = nextKnot;\r\n\r\n  int span = 1;\r\n  int n = numKnots - degree - 1;\r\n  // Linear Search...\r\n  for (; span<n; span++){\r\n    nextKnot += kp(span, r, t, kpOff);\r\n    if (span > degree && u < nextKnot){\r\n      span--;\r\n      break;\r\n    }\r\n    knot = nextKnot;\r\n  }\r\n  if (span == n) {\r\n    span--;\r\n  }\r\n\r\n\r\n  //Calculate knot values\r\n  knots[degree] = knot;\r\n  float left = knot;\r\n  float right = knot; \r\n  for (int i=1; i<=degree; i++) {\r\n    left -= kp(span-i+1, r, t, kpOff);\r\n    right += kp(span+i, r, t, kpOff);\r\n    knots[degree-i] = left;\r\n    knots[degree+i] = right;\r\n  }\r\n\r\n  return span;\r\n}\r\n\r\nvoid calcBasisValues(in float u, in int degree, in highp float knots[MAX_DEGREE*2+1], out highp float basisValues[MAX_DEGREE+1], out highp float bvD[MAX_DEGREE+1]) {\r\n  \r\n  highp vec2 savedTemp;\r\n  highp float left[MAX_DEGREE+1];\r\n  highp float right[MAX_DEGREE+1];\r\n\r\n  //Basis[0] is always 1.0\r\n  basisValues[0] = 1.0;\r\n  // Calculate basis values\r\n  for (int i=1; i<=degree; i++) {\r\n    left[i] = u - knots[degree+1-i];\r\n    right[i] = knots[degree+i] - u;\r\n\r\n    savedTemp.x = 0.0;\r\n    for (int j=0; j<i; j++) {\r\n      float rv = right[j+1];\r\n      float lv = left[i-j];\r\n      savedTemp.y = basisValues[j] / (rv + lv);\r\n      basisValues[j] = savedTemp.x + rv * savedTemp.y;\r\n      savedTemp.x = lv * savedTemp.y;\r\n    }\r\n    basisValues[i] = savedTemp.x;\r\n\r\n    // Calculate N' if on second to last iteration\r\n    if (i == degree-1 || degree == 1) {\r\n      savedTemp.x = 0.0;\r\n      //Loop through all basis values\r\n      for (int j=0; j<degree; j++) {\r\n        // Calculate a temp variable\r\n        int jr_z = j + 1;\r\n        //Calculate right side\r\n        float kp_0 = knots[jr_z + degree];\r\n        float kp_1 = knots[jr_z];\r\n        savedTemp.y = (float(degree) * basisValues[j]) / (kp_0 - kp_1);\r\n        // Calculate derivative value\r\n        bvD[j] = savedTemp.x - savedTemp.y;\r\n        // Swap right side to left\r\n        savedTemp.x = savedTemp.y;\r\n      }\r\n      //Save the last der-basis\r\n      bvD[degree] = savedTemp.x;\r\n    }\r\n  }\r\n}\r\n\r\n#else\r\n\r\n// http://read.pudn.com/downloads134/sourcecode/math/569665/nurbsR2006b/findspan.c__.htm\r\n// Note: I have found the 'early outs' in the Three code to be more correct\r\n// https://github.com/mrdoob/three.js/blob/b8d8a8625465bd634aa68e5846354d69f34d2ff5/examples/js/curves/NURBSUtils.js\r\nint findSpan(float u, in int degree, in int numKnots, int kpOff, inout GLSLBinReader r, sampler2D t, bool periodic) {\r\n  \r\n  // early outs\r\n  int n = numKnots - degree - 1;\r\n  if(u >= kp(n, r, t, kpOff))\r\n    return n-1;\r\n  if(u <= kp(degree, r, t, kpOff)) {\r\n    return degree;\r\n  }\r\n\r\n  // Linear Search...\r\n#ifdef ENABLE_ES3\r\n  int i = degree; \r\n  for (; i<n; i++){\r\n#else\r\n  // Note: loop values must be constant.\r\n  // Loops start at 1 because that is the minimum degree for a curve.\r\n  for (int i = 1; i<MAX_KNOTS; i++){\r\n    if(i >= degree && i < numKnots-1){\r\n#endif\r\n    if (u < kp(i+1, r, t, kpOff)){\r\n      return i;\r\n    }\r\n#ifndef ENABLE_ES3\r\n  }\r\n#endif\r\n  }\r\n\r\n  return i;\r\n}\r\n\r\n\r\nvoid calcBasisValues(in float u, in int span, int degree, int kpOff, int numKnots, inout GLSLBinReader r, sampler2D t, out highp float basisValues[MAX_DEGREE+1], out highp float bvD[MAX_DEGREE+1]) {\r\n  \r\n  highp vec2 savedTemp;\r\n  highp float left[MAX_DEGREE+1];\r\n  highp float right[MAX_DEGREE+1];\r\n\r\n  // Basis[0] is always 1.0\r\n  basisValues[0] = 1.0;\r\n  // Calculate basis values\r\n#ifdef ENABLE_ES3\r\n  for (int i=1; i<=degree; i++) {\r\n#else\r\n  for (int i=1; i<MAX_DEGREE; i++) {\r\n    if(i > degree) // i<=degree\r\n      break;\r\n#endif\r\n    left[i] = u - kp(span+1-i, r, t, kpOff);\r\n    right[i] = kp(span+i, r, t, kpOff) - u;\r\n\r\n    savedTemp.x = 0.0;\r\n#ifdef ENABLE_ES3\r\n    for (int j=0; j<i; j++) {\r\n#else\r\n    for (int j=0; j<MAX_DEGREE; j++) {\r\n      if(j >= i) // j < i\r\n        break;\r\n#endif\r\n      float rv = right[j+1];\r\n      float lv = left[i-j];\r\n      savedTemp.y = basisValues[j] / (rv + lv);\r\n      basisValues[j] = savedTemp.x + rv * savedTemp.y;\r\n      savedTemp.x = lv * savedTemp.y;\r\n    }\r\n    basisValues[i] = savedTemp.x;\r\n    \r\n    // Calculate N' if on second to last iteration\r\n    if (i == degree-1 || degree == 1) {\r\n      savedTemp.x = 0.0;\r\n      // Loop through all basis values\r\n#ifdef ENABLE_ES3\r\n      for (int j=0; j<degree; j++) {\r\n#else\r\n      for (int j=0; j<MAX_DEGREE; j++) {\r\n        if(j >= degree) // j < degree\r\n          break;\r\n#endif\r\n        // Calculate a temp variable\r\n        int jr_z = span - degree + j + 1;\r\n        // Calculate right side\r\n        float kp_0 = kp(jr_z + degree, r, t, kpOff);\r\n        float kp_1 = kp(jr_z, r, t, kpOff);\r\n        savedTemp.y = (float(degree) * basisValues[j]) / (kp_0 - kp_1);\r\n        // Calculate derivative value\r\n        bvD[j] = savedTemp.x - savedTemp.y;\r\n        // Swap right side to left\r\n        savedTemp.x = savedTemp.y;\r\n      }\r\n      // Save the last der-basis\r\n#ifdef ENABLE_ES3\r\n      bvD[degree] = savedTemp.x;\r\n#else\r\n      if(degree == 1)\r\n        bvD[1] = savedTemp.x;\r\n      else if(degree == 2)\r\n        bvD[2] = savedTemp.x;\r\n      else if(degree == 3)\r\n        bvD[3] = savedTemp.x;\r\n      else if(degree == 4)\r\n        bvD[4] = savedTemp.x;\r\n      else if(degree == 5)\r\n        bvD[5] = savedTemp.x;\r\n      else if(degree == 6)\r\n        bvD[6] = savedTemp.x;\r\n      else if(degree == 7)\r\n        bvD[7] = savedTemp.x;\r\n      else if(degree == 8)\r\n        bvD[8] = savedTemp.x;\r\n      else if(degree == 9)\r\n        bvD[9] = savedTemp.x;\r\n      else if(degree == 10)\r\n        bvD[10] = savedTemp.x;\r\n      else if(degree == 11)\r\n        bvD[11] = savedTemp.x;\r\n      else if(degree == 12)\r\n        bvD[12] = savedTemp.x;\r\n      else if(degree == 13)\r\n        bvD[13] = savedTemp.x;\r\n      else if(degree == 14)\r\n        bvD[14] = savedTemp.x;\r\n      else if(degree == 15)\r\n        bvD[15] = savedTemp.x;\r\n#endif\r\n    }\r\n  }\r\n}\r\n\r\n\r\n#endif\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBSCurves.glsl',\r\n  `\r\n\r\nstruct NURBSCurveData {\r\n  vec2 domain;\r\n  bool periodic;\r\n  int degree;\r\n  int numCPs;\r\n  int numKnots;\r\n\r\n  int cpStart;\r\n  int kpStart;\r\n};\r\n\r\nvoid loadNURBSCurve3dData(inout GLSLBinReader reader, sampler2D texture, out NURBSCurveData result) {\r\n\r\n  result.domain.x = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.degree = GLSLBinReader_readUInt(reader, texture);\r\n\r\n  result.numCPs = GLSLBinReader_readUInt(reader, texture);\r\n  result.numKnots = GLSLBinReader_readUInt(reader, texture);\r\n  int flags = GLSLBinReader_readUInt(reader, texture);\r\n  result.periodic = testFlag(flags, CURVE_FLAG_PERIODIC);\r\n\r\n  result.cpStart = 2*4; // 2 RGBA pixels of data before the knot values start.\r\n  result.kpStart = result.cpStart + (result.numCPs*4);\r\n}\r\n\r\nvec4 curve_cp3d(int u, inout GLSLBinReader r, NURBSCurveData d, sampler2D t) {\r\n  int index = u * 4;\r\n  return GLSLBinReader_readVec4(r, t, d.cpStart + index);\r\n}\r\n\r\n// https://github.com/akshatamohanty/wildcat-cad/blob/650e18d665ccde3dbc4c78029e35c38951581c92/Source/Geometry/Shaders/ns23_default_plM.fsh\r\n// https://github.com/mrdoob/three.js/blob/6c7f000734f8579da37fb39e5c2e9e5e2dfb14f8/examples/js/curves/NURBSUtils.js\r\n\r\n/*\r\n  Calculate rational B-Spline curve point. See The NURBS Book, page 134, algorithm A4.3.\r\n*/\r\nPosNorm calcNURBSCurve3dPoint(float param, inout GLSLBinReader r, sampler2D t) {\r\n\r\n  NURBSCurveData d;\r\n  loadNURBSCurve3dData(r, t, d);\r\n\r\n  float u = d.domain.x + param * ( d.domain.y - d.domain.x ); // linear mapping param->u\r\n  //if(d.periodic)\r\n  //    u = wrap(u, kp(0, r, t, d.kpStart), kp(d.numKnots-1, r, t, d.kpStart));\r\n \r\n  float bv[MAX_DEGREE+1];\r\n  float bvds[MAX_DEGREE+1];\r\n\r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n  highp float knots[MAX_DEGREE*2+1];\r\n  int span = findSpan(u, d.degree, d.numKnots, d.kpStart, r, t, knots);\r\n  //return PosNorm(vec3(span, knots[d.degree], knots[d.degree+1]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  //return PosNorm(vec3(knots[d.degree-1], knots[d.degree], knots[d.degree+1]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  //return PosNorm(vec3(knots[d.degree+1], knots[d.degree+2], knots[d.degree+3]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n\r\n  calcBasisValues(u, d.degree, knots, bv, bvds);\r\n  // return PosNorm(vec3(bv[0], bv[1], bv[2]), vec3(bv[3], bv[4], bv[5]), CURVE_TYPE_NURBS_CURVE);\r\n#else\r\n  int span = findSpan(u, d.degree, d.numKnots, d.kpStart, r, t, d.periodic);\r\n  // return PosNorm(vec3(float(span)), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  // return PosNorm(vec3(kp(span-1, r, t, d.kpStart), kp(span-0, r, t, d.kpStart), kp(span+1, r, t, d.kpStart)), vec3(0.0), CURVE_TYPE_NURBS_CURVE);\r\n\r\n  // Invalid knot vectors exist where all the values are identical.\r\n  if (kp(span, r, t, d.kpStart) == kp(span+1, r, t, d.kpStart)) {\r\n    for(int x=0; x <= d.degree; x++)\r\n      bv[x] = 0.0;\r\n    bv[d.degree] = 1.0;\r\n  }\r\n  else {\r\n    calcBasisValues(u, span, d.degree, d.kpStart, d.numKnots, r, t, bv, bvds);\r\n  }\r\n  // return PosNorm(vec3(bv[0], bv[1], bv[2]), vec3(bv[3], bv[4], bv[5]), CURVE_TYPE_NURBS_CURVE);\r\n#endif\r\n\r\n\r\n  float w = 0.0;\r\n  vec3 pos = vec3(0.0);\r\n  vec3 tangent = vec3(0.0);\r\n\r\n  int cv0 = (span - d.degree);\r\n#ifdef ENABLE_ES3\r\n  for(int x=0; x <= d.degree; x++) {\r\n#else\r\n  for(int x=0; x < MAX_DEGREE; x++) {\r\n    if(x > d.degree) // x<=degree\r\n      break;\r\n#endif\r\n    int index = cv0 + x;\r\n    vec4 pt = curve_cp3d(index, r, d, t);\r\n\r\n    if(d.degree < 3) {\r\n      // Rhino style evaluation....\r\n      highp float bvw = bv[x];\r\n      pos += pt.xyz * bvw;\r\n      w += pt.w * bvw;\r\n    }\r\n    else {\r\n      // Tiny NURBS/CADEx style evaluation....\r\n      highp float bvw = pt.w * bv[x];\r\n      pos += pt.xyz * bvw;\r\n      w += bvw;\r\n    }\r\n\r\n    tangent += pt.xyz * bvds[x];\r\n  }\r\n\r\n  pos /= w;\r\n\r\n\r\n  // Calc tangent\r\n  if(d.degree == 1){\r\n    vec3 pt0 = curve_cp3d(cv0, r, d, t).xyz;\r\n    vec3 pt1 = curve_cp3d(cv0+1, r, d, t).xyz;\r\n    tangent = pt1 - pt0;\r\n  }\r\n  else {\r\n    if (length(tangent) < 0.05) {\r\n\r\n      float spanLerp = u - knots[span];\r\n      float spanRange = knots[span+1] - knots[span];\r\n      int cv = int(floor((spanLerp / spanRange) * float(d.degree-1)));\r\n\r\n      vec3 pt0 = curve_cp3d(cv, r, d, t).xyz;\r\n      vec3 pt1 = curve_cp3d(cv+1, r, d, t).xyz;\r\n      tangent = pt1 - pt0;\r\n    }\r\n  }\r\n\r\n  return PosNorm(pos, normalize(tangent), CURVE_TYPE_NURBS_CURVE);\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBSSurfaces.glsl',\r\n  `\r\n\r\nstruct NURBSSurfaceData {\r\n  box2 domain;\r\n  bool periodicU;\r\n  bool periodicV;\r\n  int degreeU;\r\n  int degreeV;\r\n  int numCPsU;\r\n  int numCPsV;\r\n  int numKnotsU;\r\n  int numKnotsV;\r\n\r\n  int cpStart;\r\n  int kpUStart;\r\n  int kpVStart;\r\n};\r\n\r\nvoid loadNURBSSurfaceData(inout GLSLBinReader reader, sampler2D texture, out NURBSSurfaceData result) {\r\n\r\n  result.domain.p0.x = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.p0.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.p1.x = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  result.domain.p1.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.degreeU = GLSLBinReader_readInt(reader, texture);\r\n  if(result.degreeU > MAX_DEGREE)\r\n    result.degreeU = MAX_DEGREE;\r\n  result.degreeV = GLSLBinReader_readInt(reader, texture);\r\n  if(result.degreeV > MAX_DEGREE)\r\n    result.degreeV = MAX_DEGREE;\r\n  result.numCPsU = GLSLBinReader_readInt(reader, texture);\r\n\r\n  result.numCPsV = GLSLBinReader_readInt(reader, texture);\r\n  result.numKnotsU = GLSLBinReader_readInt(reader, texture);\r\n  result.numKnotsV = GLSLBinReader_readInt(reader, texture);\r\n  int flags = GLSLBinReader_readInt(reader, texture);\r\n  result.periodicU = testFlag(flags, SURFACE_FLAG_PERIODIC_U);\r\n  result.periodicV = testFlag(flags, SURFACE_FLAG_PERIODIC_V);\r\n\r\n  result.cpStart  = 3*4; // 3 RGBA pixels of data before the knot values start.\r\n  result.kpUStart = result.cpStart + (result.numCPsU*result.numCPsV*4);\r\n  result.kpVStart = result.kpUStart + result.numKnotsU;\r\n}\r\n\r\nvec4 surface_cp(int u, int v, inout GLSLBinReader r, NURBSSurfaceData d, sampler2D t) {\r\n  int index = (u + (v * d.numCPsU)) * 4;\r\n  return GLSLBinReader_readVec4(r, t, d.cpStart + index);\r\n}\r\n\r\n/*\r\n  Calculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\r\n*/\r\nPosNorm calcNURBSSurfacePoint(vec2 params, inout GLSLBinReader r, sampler2D t) {\r\n\r\n  vec3 tmp;\r\n  NURBSSurfaceData d;\r\n  loadNURBSSurfaceData(r, t, d);\r\n\r\n  // ///////////////////////////////////////\r\n  // // vec3 cp_pos = vec3(params.x + float(d.degreeU), params.y + float(d.degreeV), 0.0 );\r\n  // vec3 cp_pos = vec3(params.x + float(d.numCPsU), params.y + float(d.numCPsV), 0.0 );\r\n  // return PosNorm(cp_pos, tmp);\r\n  // ///////////////////////////////////////\r\n\r\n  // ///////////////////////////////////////\r\n  // int knot_x = int(params.x * float(d.numCPsU-1));\r\n  // int knot_y = int(params.y * float(d.numCPsV-1));\r\n  // vec4 cp_pos = surface_cp(knot_x, knot_y, r, d, t);\r\n  // return PosNorm(cp_pos.xyz, tmp);\r\n  // ///////////////////////////////////////\r\n\r\n  vec2 uv = mapDomain(d.domain, params); // linear mapping params -> uv\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n\r\n  highp float basisValuesU[MAX_DEGREE+1];\r\n  highp float basisValuesV[MAX_DEGREE+1];\r\n  highp float bvdsU[MAX_DEGREE+1];\r\n  highp float bvdsV[MAX_DEGREE+1];\r\n  \r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n  highp float knotsU[MAX_DEGREE*2+1];\r\n  highp float knotsV[MAX_DEGREE*2+1];\r\n  int spanU = findSpan(u, d.degreeU, d.numKnotsU, d.kpUStart, r, t, knotsU);\r\n  int spanV = findSpan(v, d.degreeV, d.numKnotsV, d.kpVStart, r, t, knotsV);\r\n  calcBasisValues(u, d.degreeU, knotsU, basisValuesU, bvdsU);\r\n  calcBasisValues(v, d.degreeV, knotsV, basisValuesV, bvdsV);\r\n\r\n#else\r\n  int spanU = findSpan(u, d.degreeU, d.numKnotsU, d.kpUStart, r, t, d.periodicU);\r\n  int spanV = findSpan(v, d.degreeV, d.numKnotsV, d.kpVStart, r, t, d.periodicV);\r\n\r\n  calcBasisValues(u, spanU, d.degreeU, d.kpUStart, d.numKnotsU, r, t, basisValuesU, bvdsU);\r\n  calcBasisValues(v, spanV, d.degreeV, d.kpVStart, d.numKnotsV, r, t, basisValuesV, bvdsV);\r\n#endif\r\n\r\n  // ///////////////////////////////////////\r\n  // return PosNorm(vec3(knotsV[11], knotsV[12], knotsV[13]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(knotsV[14], knotsV[15], knotsV[16]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(knotsV[17], knotsV[18], knotsV[19]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(basisValuesU[0], basisValuesU[1], basisValuesU[2]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // ///////////////////////////////////////\r\n\r\n  ivec2 indices;\r\n  highp float w = 0.0;\r\n  highp vec3 pos = vec3(0.0);\r\n  highp vec3 tangentU = vec3(0.0);\r\n  highp vec3 tangentV = vec3(0.0);\r\n  int cvU0 = (spanU - d.degreeU);\r\n  int cvV0 = (spanV - d.degreeV);\r\n#ifdef ENABLE_ES3\r\n  for(int y=0; y <= d.degreeV; y++) {\r\n#else\r\n  for(int y=0; y < MAX_DEGREE; y++) {\r\n     if(y > d.degreeV) // y<=degree\r\n         break;\r\n#endif\r\n    indices.y = cvV0 + y;\r\n\r\n#ifdef ENABLE_ES3\r\n    for(int x=0; x <= d.degreeU; x++) {\r\n#else\r\n    for(int x=0; x < MAX_DEGREE; x++) {\r\n      if(x > d.degreeU) // x<=degree\r\n        break;\r\n#endif\r\n      indices.x = cvU0 + x;\r\n      \r\n      vec4 cv = surface_cp(indices.x, indices.y, r, d, t);\r\n      vec3 pt = cv.xyz;\r\n      float weight = cv.w;\r\n\r\n      float bvU = basisValuesU[x];\r\n      float bvV = basisValuesV[y];\r\n\r\n// #define USE_RHNIO_EVALUATION_MATH 1\r\n#ifdef USE_RHNIO_EVALUATION_MATH\r\n      // Rhino style evaluation....\r\n      float bvw = bvU * bvV;\r\n      pos += pt * bvw;\r\n      w += weight * bvw;\r\n#else\r\n      // Tiny NURBS/CADEx style evaluation....\r\n      highp float bvw = weight * bvU * bvV;\r\n      pos += pt * bvw;\r\n      w += bvw;\r\n#endif\r\n        \r\n      float bvdU = bvdsU[x];\r\n      float bvdV = bvdsV[y];\r\n\r\n      tangentU += pt * bvdU * bvV;\r\n      tangentV += pt * bvU * bvdV;\r\n    }\r\n  }\r\n\r\n  pos /= w;\r\n\r\n  ///////////////////////////////////////////////////////\r\n  // Calculate normal.\r\n  float spanRangeU = knotsU[d.degreeU + 1] - knotsU[d.degreeU];\r\n  float spanRangeV = knotsV[d.degreeV + 1] - knotsV[d.degreeV];\r\n  float eqKnotRangeU = ( d.domain.p1.x - d.domain.p0.x ) / float(d.numKnotsU);\r\n  float eqKnotRangeV = ( d.domain.p1.y - d.domain.p0.y ) / float(d.numKnotsV);\r\n  \r\n  \r\n  if (spanRangeU / eqKnotRangeU < 0.01) { \r\n    // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n    // we have span segment which has close to zero delta, and \r\n    // so the normals are broken. We want to advace along the \r\n    // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n    // length of the span rather than when we have a pinched corner, \r\n    // where we move along the toher direction.\r\n    // console.log(v, 'spanRangeU:', spanRangeU, ' eqKnotRangeU:', eqKnotRangeU, spanRangeU / eqKnotRangeU)\r\n\r\n    int cvU = cvU0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvU = cvU0 + d.degreeU - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the U range, then \r\n      // we will grab the next in the row. \r\n      cvU = cvU0 + 1;\r\n    }\r\n\r\n    float spanLerpV = (u - knotsV[d.degreeV]) / spanRangeV;\r\n    int cvV = cvV0 + int(floor(spanLerpV * float(d.degreeV)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU+1, cvV, r, d, t).xyz;\r\n\r\n    tangentU = pt1 - pt0;\r\n  } else if (length(tangentU) < 0.001) {\r\n    // Note: on values to big, we get false positives.\r\n    // See: 2_SR00404681_1_RI510090.CATPart.zcad\r\n    // long narrow nurbs surface above the tail light.\r\n    // Reduced from 0.05 to 0.001 fixed it.\r\n\r\n    // The derivative in the V direction is zero, \r\n    // so we calculate the linear derivative for the next control points along.\r\n    \r\n    int cvV;\r\n    if (spanV > d.degreeV) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvV = cvV0 + d.degreeV - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the V range, then \r\n      // we will grab the next in the row. \r\n      cvV = cvV0 + 1;\r\n    }\r\n    \r\n    float spanLerpU = (u - knotsU[d.degreeU]) / spanRangeU;\r\n    int cvU = cvU0 + int(floor(spanLerpU * float(d.degreeU)));\r\n    \r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU+1, cvV, r, d, t).xyz;\r\n\r\n    tangentU = pt1 - pt0;\r\n  }\r\n\r\n  if (spanRangeV / eqKnotRangeV < 0.01) {\r\n    // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n    // we have span segment which has close to zero delta, and \r\n    // so the normals are broken. We want to advace along the \r\n    // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n    // length of the span rather than when we have a pinched corner, \r\n    // where we move along the toher direction.\r\n    // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n    int cvV = cvV0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvV = cvV0 + d.degreeV - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the V range, then \r\n      // we will grab the next in the row. \r\n      cvV = cvV0 + 1;\r\n    }\r\n\r\n    float spanLerpU = (u - knotsU[d.degreeU]) / spanRangeU;\r\n    int cvU = cvU0 + int(floor(spanLerpU * float(d.degreeU)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU, cvV+1, r, d, t).xyz;\r\n\r\n    tangentV = pt1 - pt0;\r\n    \r\n  } else if (length(tangentV) < 0.001) { \r\n    // Note: on values to big, we get false positives.\r\n    // See: 2_SR00404681_1_RI510090.CATPart.zcad\r\n    // long narrow nurbs surface above the tail light.\r\n    // Reduced from 0.05 to 0.001 fixed it.\r\n\r\n    // The derivative in the V direction is close to zero, \r\n    // so we calculate the linear derivative for the next control points along.\r\n\r\n    int cvU = cvU0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvU = cvU0 + d.degreeU - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the U range, then\r\n      // we will grab the next in the row.\r\n      cvU = cvU0 + 1;\r\n    }\r\n\r\n    float spanLerpV = (u - knotsV[d.degreeV]) / spanRangeV;\r\n    int cvV = cvV0 + int(floor(spanLerpV * float(d.degreeV)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU, cvV+1, r, d, t).xyz;\r\n\r\n    tangentV = pt1 - pt0;\r\n  }\r\n\r\n  // vec3 normal = tangentV;\r\n  // Note: in the gear_box_final_asm.zcad. the nurbs surfaces were all flipped\r\n  // This is only apparent in cut-away scenes, which the gearbox demo is.\r\n  // vec3 normal = normalize(cross(tangentV, tangentU));\r\n  vec3 normal = normalize(cross(tangentU, tangentV));\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_NURBS_SURFACE);\r\n}\r\n\r\n`\r\n)\r\n","import { GLShader, shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nimport './GLSLBinReader.js';\r\nimport './GLSLMath.js';\r\nimport './GLSLCADCurves.js';\r\nimport './GLSLCADSurfaces.js';\r\nimport './GLSLNURBS.js';\r\nimport './GLSLNURBSCurves.js';\r\nimport './GLSLNURBSSurfaces.js';\r\n\r\nconst GLEvaluateCADSurfaceShader_VERTEX_SHADER = shaderLibrary.parseShader(\r\n  'GLEvaluateCADSurfaceShader.vertexShader',\r\n  `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute float surfaceId;\r\n\r\nuniform sampler2D surfaceAtlasLayoutTexture;\r\nuniform ivec2 surfaceAtlasLayoutTextureSize;\r\n\r\nuniform ivec2 surfacesAtlasTextureSize;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n/* VS Outputs */\r\nvarying float v_surfaceId;      // flat\r\nvarying vec3 v_geomDataCoords;  // flat\r\nvarying vec2 v_patchSize;       // flat\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  GLSLBinReader reader;\r\n  GLSLBinReader_init(reader, surfaceAtlasLayoutTextureSize, 32);\r\n  vec4 patchCoords = GLSLBinReader_readVec4(reader, surfaceAtlasLayoutTexture, int(surfaceId)*8);\r\n  vec4 surfaceDataCoords = GLSLBinReader_readVec4(reader, surfaceAtlasLayoutTexture, (int(surfaceId)*8)+4);\r\n\r\n  vec2 patchPos = patchCoords.xy;\r\n  v_patchSize = patchCoords.zw;\r\n\r\n  v_surfaceId = surfaceId;\r\n  v_geomDataCoords = surfaceDataCoords.xyz;\r\n  v_vertexCoord = (positions.xy + 0.5) * v_patchSize;\r\n\r\n  vec2 pos = (patchPos + v_vertexCoord) / vec2(surfacesAtlasTextureSize);\r\n  gl_Position = vec4((pos - 0.5) * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceFragmentShader.glsl',\r\n  `\r\n\r\nstruct PosNorm {\r\n  vec3 pos;\r\n  vec3 normal;\r\n  int geomType;\r\n};\r\n\r\n/* VS Outputs */\r\nvarying float v_surfaceId;      // flat\r\nvarying vec3 v_geomDataCoords;  // flat\r\nvarying vec2 v_patchSize;       // flat\r\nvarying vec2 v_vertexCoord;\r\n\r\nuniform sampler2D surfaceDataTexture;\r\nuniform ivec2 surfaceDataTextureSize;\r\nuniform int writeNormals;\r\n\r\nvec2 initReader(inout GLSLBinReader reader) {\r\n\r\n  // compute exact xy coords per pixel by rounding the vertex coord to the nearest integer and then dividing my patch size.\r\n  // The interpollated xy coords from the quad are not exact because the quad must cover the pixels with some margin.\r\n\r\n  vec2 params = vec2(floor(v_vertexCoord.x), floor(v_vertexCoord.y));\r\n  if(v_patchSize.x > 1.0)\r\n    params.x /= v_patchSize.x - 1.0;\r\n  if(v_patchSize.y > 1.0)\r\n    params.y /= v_patchSize.y - 1.0;\r\n\r\n  ivec4 region = ivec4(0, 0, surfaceDataTextureSize.x, surfaceDataTextureSize.y);\r\n  ivec2 start = ivec2(v_geomDataCoords.xy);\r\n  int flags = int(v_geomDataCoords.z);\r\n  if(testFlag(flags, SURFACE_FLAG_FLIPPED_UV))  {\r\n    float tmp = params.x;\r\n    params.x = params.y;\r\n    params.y = tmp;\r\n  }\r\n\r\n  GLSLBinReader_init(reader, surfaceDataTextureSize, region, start, 32);\r\n\r\n  return params;\r\n}\r\n\r\n\r\nstruct box2 {\r\n  vec2 p0;\r\n  vec2 p1;\r\n};\r\n\r\nbox2 loadBox2(inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain;\r\n  domain.p0.x = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p0.y = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p1.x = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p1.y = GLSLBinReader_readFloat(reader, texture);\r\n  return domain;\r\n}\r\n\r\nvec2 mapDomain(box2 domain, vec2 params) {\r\n  return domain.p0 + params * ( domain.p1 - domain.p0 );\r\n}\r\n\r\n\r\n`\r\n)\r\n\r\n/** Class representing a GL evaluate simple CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateSimpleCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate simple CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages[\r\n      'VERTEX_SHADER'\r\n    ] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages[\r\n      'FRAGMENT_SHADER'\r\n    ] = shaderLibrary.parseShader(\r\n      'GLEvaluateSimpleCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLCADSimpleSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_PLANE) {\r\n    posNorm = calcPlaneSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_POLY_PLANE) {\r\n    posNorm = calcPolyPlaneSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_FAN) {\r\n    posNorm = calcFanSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_CONE) {\r\n    posNorm = calcConeSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_CYLINDER) {\r\n    posNorm = calcCylinderSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_SPHERE) {\r\n    posNorm = calcSphereSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_TORUS) {\r\n    posNorm = calcTorusSurfacePoint(params, reader, texture);\r\n  }\r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n  // gl_FragData[0] = vec4(posNorm.pos, 1.0);\r\n  // gl_FragData[1] = vec4(posNorm.normal, 1.0);\r\n\r\n  // fragColor.r = v_geomDataCoords.x;\r\n  // fragColor.g = v_geomDataCoords.y;\r\n  // fragColor.r = floor(v_vertexCoord.x);\r\n  // fragColor.g = floor(v_vertexCoord.y);\r\n  // fragColor.b = v_patchSize.x;\r\n  // fragColor.a = v_patchSize.y;\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\n/** Class representing a GL evaluate compound CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateCompoundCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate compound CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages[\r\n      'VERTEX_SHADER'\r\n    ] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages[\r\n      'FRAGMENT_SHADER'\r\n    ] = shaderLibrary.parseShader(\r\n      'GLEvaluateCompoundCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\nuniform sampler2D curveTangentsTexture;\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\nvec3 getCurveVertex(ivec2 curvePatchCoords, int vertexCoord) {\r\n  return fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(curvePatchCoords.x + vertexCoord, curvePatchCoords.y)).rgb;\r\n}\r\n\r\nvec3 getCurveTangent(ivec2 curvePatchCoords, int vertexCoord) {\r\n  return fetchTexel(curveTangentsTexture, curvesAtlasTextureSize, ivec2(curvePatchCoords.x + vertexCoord, curvePatchCoords.y)).rgb;\r\n}\r\n\r\nPosNorm evalCADCurve3d(int curveId, float u) {\r\n\r\n  GLSLBinReader curveLayoutDataReader;\r\n  GLSLBinReader_init(curveLayoutDataReader, curvesAtlasLayoutTextureSize, 32);\r\n  ivec4 curvePatch = ivec4(GLSLBinReader_readVec4(curveLayoutDataReader, curvesAtlasLayoutTexture, curveId * 8));\r\n\r\n  float t = float(curvePatch.z - 1) * u;\r\n  int vertexId0 = min(int(floor(t + 0.5)), curvePatch.z - 1);\r\n  // int vertexId1 = floor(t) + 1.0;\r\n  // float lerp = t - floor(t);\r\n\r\n  vec3 p0 = getCurveVertex(curvePatch.xy, vertexId0);\r\n  // vec3 p1 = getCurveVertex(curvePatch.xy, vertexId1);\r\n  vec3 t0 = getCurveTangent(curvePatch.xy, vertexId0);\r\n  // vec3 t1 = getCurveTangent(curvePatch.xy, vertexId1);\r\n\r\n  PosNorm res;\r\n  res.pos = p0;//mix(p0, p1, lerp);\r\n  res.normal = normalize(t0);//mix(t0, t1, lerp));\r\n  res.geomType = 0;\r\n\r\n  // res.pos.x = u;\r\n  // res.pos.y = float(curveId);\r\n  // res.pos.x = float(curvePatch.x);\r\n  // res.pos.y = float(curvePatch.y);\r\n  // res.pos.z = float(curvePatch.z);\r\n  return res;\r\n}\r\n\r\n\r\n<%include file=\"GLSLCADCompoundSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_LINEAR_EXTRUSION) {\r\n    posNorm = calcLinearExtrusionSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_REVOLUTION) {\r\n    posNorm = calcRevolutionSurfacePoint(params, reader, texture, false);\r\n  } else if(geomType == SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN) {\r\n    posNorm = calcRevolutionSurfacePoint(params, reader, texture, true);\r\n  } \r\n  \r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\n/** Class representing a GL evaluate NURBS CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateNURBSCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate NURBS CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages[\r\n      'VERTEX_SHADER'\r\n    ] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages[\r\n      'FRAGMENT_SHADER'\r\n    ] = shaderLibrary.parseShader(\r\n      'GLEvaluateNURBSCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLNURBS.glsl\"/>\r\n<%include file=\"GLSLNURBSSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    posNorm = calcNURBSSurfacePoint(params, reader, texture);\r\n  }\r\n  \r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nexport {\r\n  GLEvaluateSimpleCADSurfaceShader,\r\n  GLEvaluateCompoundCADSurfaceShader,\r\n  GLEvaluateNURBSCADSurfaceShader,\r\n}\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADConstants.glsl',\r\n  `\r\n  const int SURFACE_FLAG_PERIODIC_U = 1; // 1<<0;\r\n  const int SURFACE_FLAG_PERIODIC_V = 2; // 1<<1;\r\n  const int SURFACE_FLAG_UNUSED2 = 4; // 1<<2;\r\n  const int SURFACE_FLAG_UNUSED3 = 8; // 1<<3;\r\n  const int SURFACE_FLAG_FLIPPED_NORMAL = 16; // 1<<4\r\n  const int SURFACE_FLAG_FLIPPED_UV = 32; // 1<<5\r\n  const int SURFACE_FLAG_COST_IS_DETAIL_U = 64; // 1<<6;\r\n  const int SURFACE_FLAG_COST_IS_DETAIL_V = 128; // 1<<7;\r\n\r\n  const int BODY_FLAG_CUTAWAY = 256; // 1<<8\r\n  const int BODY_FLAG_INVISIBLE = 512; // 1<<9\r\n\r\n  const int CURVE_FLAG_PERIODIC = 1; // 1<<0;\r\n  const int CURVE_FLAG_UNUSED2 = 4; // 1<<2;\r\n  const int CURVE_FLAG_COST_IS_DETAIL = 8;//1<<3;\r\n\r\n\r\n  const int SURFACE_TYPE_PLANE = 0;\r\n  const int SURFACE_TYPE_CONE = 1;\r\n  const int SURFACE_TYPE_CYLINDER = 2;\r\n  const int SURFACE_TYPE_SPHERE = 3;\r\n  const int SURFACE_TYPE_TORUS = 4;\r\n  const int SURFACE_TYPE_LINEAR_EXTRUSION = 5;\r\n  const int SURFACE_TYPE_REVOLUTION = 6;\r\n  const int SURFACE_TYPE_BEZIER_SURFACE = 7;\r\n  const int SURFACE_TYPE_NURBS_SURFACE = 8;\r\n  const int SURFACE_TYPE_OFFSET_SURFACE = 9;\r\n  const int SURFACE_TYPE_TRIMMED_RECT_SURFACE = 10;\r\n\r\n  const int SURFACE_TYPE_POLY_PLANE = 14;\r\n  const int SURFACE_TYPE_FAN = 15;\r\n  const int SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN = 16;\r\n\r\n\r\n  const int CURVE_TYPE_LINE = 20;\r\n  const int CURVE_TYPE_CIRCLE = 21;\r\n  const int CURVE_TYPE_ELIPSE = 22;\r\n  // const int CURVE_TYPE_HYPERBOLA = 23;\r\n  // const int CURVE_TYPE_PARABOLA = 24;\r\n  // const int CURVE_TYPE_BEZIERCURVE = 25;\r\n  const int CURVE_TYPE_NURBS_CURVE = 26;\r\n  // const int CURVE_TYPE_OFFSET_CURVE = 27;\r\n  // const int CURVE_TYPE_TRIMMED_CURVE = 28;\r\n\r\n\r\n  const int geomLibraryHeaderSize = 4; // 2 pixels at the start of the GeomLibrary and CurveLibrary\r\n\r\n  // [bodyDescId, surfaceId, cadBodyDesc.xy], [glmaterialcoords.xy][tr-xyz], [ori], [sc], [highlight], [cutPlane]\r\n  const int pixelsPerCADBody = 7;\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADGeomDrawing.vertexShader.glsl',\r\n  `\r\n\r\n\r\nuniform sampler2D cadBodiesTexture;\r\nuniform int cadBodiesTextureSize_vert;\r\n  \r\nvec4 getCADBodyPixel(int cadBodyId, int pixelOffset) {\r\n  int offset = cadBodyId * pixelsPerCADBody;\r\n  ivec2 start;\r\n  start.y += offset / cadBodiesTextureSize_vert;\r\n  start.x = imod(offset, cadBodiesTextureSize_vert);\r\n  return fetchTexel(cadBodiesTexture, ivec2(cadBodiesTextureSize_vert), ivec2(start.x + pixelOffset, start.y));\r\n}\r\n\r\n<%include file=\"GLSLMath.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n\r\nconst int pixelsPerDrawItem = 10; // The number of RGBA pixels per draw item.\r\nconst int valuesPerSurfaceTocItem = 9;\r\nconst int bytesPerValue = 4; // 32 bit floats\r\n\r\n// Before enabling this, enable the 2nd vertex attribute (drawItemTexAddr)\r\n// in the Draw shader and in the GLDrawSet, and in the GLCADAssetWorker\r\n#define CALC_GLOBAL_XFO_DURING_DRAW\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\nmat4 getCADBodyMatrix(int cadBodyId) {\r\n  vec3 body_tr = getCADBodyPixel(cadBodyId, 2).rgb;\r\n  vec4 body_ori = normalize(getCADBodyPixel(cadBodyId, 3));\r\n  vec3 body_sc = getCADBodyPixel(cadBodyId, 4).rgb;\r\n  Xfo bodyXfo = Xfo(body_tr, body_ori, body_sc);\r\n  return xfo_toMat4(bodyXfo);\r\n  // return mat4(1.0);\r\n}\r\n\r\nuniform sampler2D bodyDescTexture;\r\nuniform ivec2 bodyDescTextureSize;\r\n\r\nGLSLBinReader setupBodyDescReader(ivec2 bodyDescAddr) {\r\n  GLSLBinReader bodyDescReader;\r\n  ivec4 region = ivec4(0, 0, bodyDescTextureSize.x, bodyDescTextureSize.y);\r\n  ivec2 start = ivec2(bodyDescAddr.x, bodyDescAddr.y);\r\n  GLSLBinReader_init(bodyDescReader, bodyDescTextureSize, region, start, 32);\r\n  return bodyDescReader;\r\n}\r\n\r\nXfo getDrawItemXfo(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  GLSLBinReader bodyDescReader = setupBodyDescReader(bodyDescAddr);\r\n  \r\n  // Skip over the bbox, numSurfaces and then to the current surface data.  \r\n  #ifdef ENABLE_BODY_EDGES\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (1/*numCurves*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/));\r\n  #else\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/));\r\n  #endif\r\n  #ifdef ENABLE_PER_FACE_COLORS\r\n  offsetOfItemRef += drawItemIndexInBody * 4/*color*/; // Skip over the color.\r\n  #endif\r\n  \r\n  vec3 surface_tr = vec3(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+1),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+2),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+3)\r\n    );\r\n\r\n  vec4 surface_ori = normalize(vec4(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+4),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+5),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+6),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+7)\r\n    ));\r\n\r\n  vec3 surface_sc = vec3(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+8),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+9),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+10)\r\n  );\r\n\r\n  Xfo surfaceXfo = Xfo(surface_tr, surface_ori, surface_sc);\r\n  return surfaceXfo;\r\n\r\n}\r\nmat4 getDrawItemMatrix(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  return xfo_toMat4(getDrawItemXfo(bodyDescAddr, drawItemIndexInBody));\r\n  // return mat4(1.0);\r\n}\r\n\r\n#else // CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\nuniform sampler2D drawItemsTexture;\r\nuniform ivec2 vert_drawItemsTextureSize;\r\n\r\n// The Draw Items texture is laid out with 8 pixels per draw item.\r\nvec4 getDrawItemData(int offset) {\r\n  return fetchTexel(drawItemsTexture, vert_drawItemsTextureSize, ivec2(ftoi(drawItemTexAddr.x) + offset, ftoi(drawItemTexAddr.y)));\r\n}\r\n\r\nmat4 getModelMatrix() {\r\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\r\n  vec4 col0 = getDrawItemData(0);\r\n  vec4 col1 = getDrawItemData(1);\r\n  vec4 col2 = getDrawItemData(2);\r\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\r\n  return transpose(result);\r\n}\r\n\r\n#endif // CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\n  `\r\n)\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceDrawing.vertexShader.glsl',\r\n  `\r\n  \r\n<%include file=\"GLSLCADGeomDrawing.vertexShader.glsl\"/>\r\n\r\n\r\n// GEOM\r\nuniform sampler2D surfaceAtlasLayoutTexture;\r\nuniform ivec2 surfaceAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D surfacesAtlasTexture;\r\nuniform ivec2 surfacesAtlasTextureSize;\r\nuniform sampler2D normalsTexture;\r\n\r\nvec4 getSurfaceVertex(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n  return fetchTexel(surfacesAtlasTexture, surfacesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y)));\r\n}\r\n\r\nvec3 getSurfaceNormal(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n  return fetchTexel(normalsTexture, surfacesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y))).rgb;\r\n}\r\n\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADGeomDrawing.fragmentShader.glsl',\r\n  `\r\n  uniform sampler2D cadBodiesTexture;\r\n  uniform int cadBodiesTextureSize_frag;\r\n  \r\n  vec4 getCADBodyPixel(int cadBodyId, int pixelOffset) {\r\n    \r\n    int offset = cadBodyId * pixelsPerCADBody;\r\n    ivec2 start;\r\n    start.y += offset / cadBodiesTextureSize_frag;\r\n    start.x = imod(offset, cadBodiesTextureSize_frag);\r\n  \r\n    return fetchTexel(cadBodiesTexture, ivec2(cadBodiesTextureSize_frag), ivec2(start.x + pixelOffset, start.y));\r\n  }\r\n  \r\n  // Is this still used?\r\n  uniform sampler2D drawItemsTexture;\r\n  uniform ivec2 frag_drawItemsTextureSize;\r\n  // The Draw Items texture is laid out with 8 pixels per draw item.\r\n  vec4 getDrawItemData(int offset) {\r\n    return fetchTexel(drawItemsTexture, frag_drawItemsTextureSize, ivec2(ftoi(v_drawCoords.x) + offset, ftoi(v_drawCoords.y)));\r\n  }\r\n  \r\n  \r\n\r\n//////////////////////////////////////////////\r\n// Cutaways\r\n\r\n<%include file=\"cutaways.glsl\"/>\r\n\r\n// bool applyCutaway(int cadBodyId, int flags) {\r\n//   if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n//     vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n//     vec3 cutNormal = cadBodyPixel6.xyz;\r\n//     float cutPlaneDist = cadBodyPixel6.w;\r\n//     if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n//         discard;\r\n//     }\r\n//     return true;\r\n//   }\r\n//   return false;\r\n// }\r\n\r\n// int applyCutaway(int flags, bool backFacing, vec3 cutColor, inout vec4 fragColor) {\r\n//   bool cut = testFlag(flags, BODY_FLAG_CUTAWAY);\r\n//   if(cut){\r\n//     if(cutaway(v_worldPos, cutNormal, planeDist)) {\r\n//       return 1;\r\n//     }\r\n//     if(backFacing){\r\n//       fragColor = vec4(cutColor, 1.0);\r\n//       return 2;\r\n//     }\r\n//   }\r\n//   return 0;\r\n// }\r\n  `\r\n  )\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceDrawing.fragmentShader.glsl',\r\n`\r\n  \r\n<%include file=\"GLSLCADGeomDrawing.fragmentShader.glsl\"/>\r\n\r\n\r\nuniform sampler2D materialsTexture;\r\nuniform ivec2 materialsTextureSize;\r\n\r\nvec4 getMaterialValue(vec2 materialCoords, int valueIndex) {\r\n  return fetchTexel(materialsTexture, materialsTextureSize, ivec2(ftoi(materialCoords.x) + valueIndex, ftoi(materialCoords.y)));\r\n}\r\n\r\n\r\n//////////////////////////////////////////////\r\n// Surface Colors\r\n\r\nuniform sampler2D bodyDescTexture;\r\nuniform ivec2 bodyDescTextureSize_frag;\r\n\r\nGLSLBinReader setupBodyDescReader(ivec2 bodyDescAddr) {\r\n  GLSLBinReader bodyDescReader;\r\n  ivec4 region = ivec4(0, 0, bodyDescTextureSize_frag.x, bodyDescTextureSize_frag.y);\r\n  ivec2 start = ivec2(bodyDescAddr.x, bodyDescAddr.y);\r\n  GLSLBinReader_init(bodyDescReader, bodyDescTextureSize_frag, region, start, 32);\r\n  return bodyDescReader;\r\n}\r\n\r\nvec4 getDrawItemColor(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  GLSLBinReader bodyDescReader = setupBodyDescReader(bodyDescAddr);\r\n  \r\n  #ifdef ENABLE_BODY_EDGES\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (1/*numCurves*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/ + 4/*color*/));\r\n  #else\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/ + 4/*color*/));\r\n  #endif\r\n\r\n  vec4 color = vec4(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+11),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+12),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+13),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+14)\r\n  );\r\n\r\n  return color;\r\n}\r\n\r\n//////////////////////////////////////////////\r\n// Trimming\r\nuniform sampler2D trimSetsAtlasLayoutTexture;\r\nuniform ivec2 trimSetsAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nbool applyTrim(vec4 trimPatchQuad, inout vec3 trimCoords, int flags) {\r\n  if(trimPatchQuad.z > 0.0 && trimPatchQuad.w > 0.0){\r\n    // Remove cobwebs along borders.\r\n    // Tis appears to eliminate cobwebs along borders of trim sets. \r\n    // It does indicate that a math eror exists somewhere else\r\n    // that we would get cobwebs here.\r\n    // To repro, load Dead Eye Bearing and zoom out.\r\n    if (v_textureCoord.x < 0.0 || v_textureCoord.x >= 1.0 || v_textureCoord.y < 0.0 || v_textureCoord.y >= 1.0)\r\n      return true;\r\n\r\n    trimCoords.xy = trimPatchQuad.xy + (trimPatchQuad.zw * v_textureCoord);\r\n\r\n    vec2 trimUv = (trimCoords.xy) / vec2(trimSetAtlasTextureSize);\r\n    vec4 trimTexel = texture2D(trimSetAtlasTexture, trimUv);\r\n\r\n    trimCoords.z = max(trimTexel.r, trimTexel.g);\r\n    \r\n    if (trimTexel.r < 0.5 || trimTexel.g < 0.5) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  else {\r\n    // This is a non-trimmed surface, so return false.\r\n    trimCoords = vec3(-1.0);\r\n    return false;\r\n  }\r\n}\r\n\r\n\r\n`\r\n)\r\n","import { GLShader } from '@zeainc/zea-engine'\r\n/** Class representing a GL CAD shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLCADShader extends GLShader {\r\n  /**\r\n   * Create a GL CAD shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n    this.stack = [{}]\r\n  }\r\n\r\n  /**\r\n   * The setPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   */\r\n  setPreprocessorValue(name) {\r\n    this.getState()[name] = name\r\n  }\r\n\r\n  /**\r\n   * The clearPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   */\r\n  clearPreprocessorValue(name) {\r\n    delete this.getState()[name]\r\n  }\r\n\r\n  /**\r\n   * The getState method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getState() {\r\n    return this.stack[this.stack.length - 1]\r\n  }\r\n\r\n  /**\r\n   * The pushState method.\r\n   */\r\n  pushState() {\r\n    this.stack.push(Object.assign({}, this.getState()))\r\n  }\r\n\r\n  /**\r\n   * The popState method.\r\n   */\r\n  popState() {\r\n    this.stack.pop()\r\n    this.applyOptions()\r\n  }\r\n\r\n  /**\r\n   * The applyOptions method.\r\n   */\r\n  applyOptions() {\r\n    const directives = []\r\n    const state = this.getState()\r\n    for (const key in state) {\r\n      directives.push(state[key])\r\n    }\r\n    const defines = this.__gl.shaderopts.defines + directives.join('\\n') + '\\n'\r\n    this.__key = defines\r\n    this.compileForTarget(this.__key, {\r\n      defines,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    return super.bind(renderstate, this.__key)\r\n  }\r\n}\r\n\r\nexport { GLCADShader }\r\n","import { shaderLibrary, GLShader, Registry } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADSurfaceNormalsShader_VERTEX_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADSurfaceNormalsShader.vertexShader',\r\n  `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // (DrawItemData Coords (x, y) \r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform ivec2 quadDetail;\r\nuniform vec3 assetCentroid;\r\nuniform float normalLength;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.vertexShader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int surfaceId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n\r\n    vec2 texCoords = positions.xy + 0.5;\r\n    \r\n    v_drawCoords = drawCoords;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int cadBodyFlags = ftoi(cadBodyPixel0.g);\r\n    \r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(cadBodyFlags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    // if(v_surfaceType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    //     // int drawItemIndexInBody = int(metadata.b+0.5);\r\n    //     int sideLen = int(ceil(sqrt(float(numSurfacesInLibrary))));\r\n    //     int x = drawItemIndexInBody % sideLen;\r\n    //     int y = drawItemIndexInBody / sideLen;\r\n    //     modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n    //                     0.0, 1.0, 0.0, 0.0, \r\n    //                     0.0, 0.0, 1.0, 0.0,  \r\n    //                     float(x), float(y), 0.0, 1.0);\r\n    // }\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    mat4 surfaceMat = getDrawItemMatrix(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * surfaceMat;\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n    mat4 viewProjectionMatrix = projectionMatrix * viewMatrix;\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader surfaceLayoutDataReader;\r\n    GLSLBinReader_init(surfaceLayoutDataReader, surfaceAtlasLayoutTextureSize, 16);\r\n    vec4 surfaceDataAddr = GLSLBinReader_readVec4(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8);\r\n    int surfaceFlags = GLSLBinReader_readInt(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8 + 6);\r\n\r\n    bool isFan = int(quadDetail.y) == 0;\r\n    vec2 vertexCoords = texCoords * (isFan ? vec2(quadDetail) + vec2(1.0, 1.0) : vec2(quadDetail));\r\n\r\n    vec3 normal = getSurfaceNormal(surfaceDataAddr.xy, vertexCoords);\r\n    vec4 pos = vec4(getSurfaceVertex(surfaceDataAddr.xy, vertexCoords).rgb, 1.0);\r\n\r\n    bool flippedNormal = testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    if(flippedNormal){\r\n        normal = -normal;\r\n    }\r\n  \r\n    vec4 worldPos = modelMatrix * pos;\r\n    vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\r\n\r\n    // if (positions.z > 0.5)\r\n    //   worldPos = vec4(vec3(0.0), 1.0);\r\n    worldPos += vec4(worldNormal * positions.z * normalLength, 0.0);\r\n    \r\n    gl_Position = viewProjectionMatrix * worldPos;\r\n\r\n    \r\n    v_textureCoord = texCoords;\r\n    if(testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_UV))\r\n        v_textureCoord = vec2(v_textureCoord.y, v_textureCoord.x);\r\n\r\n    // v_textureCoord.y = 1.0 - v_textureCoord.y; // Flip y\r\n}`\r\n)\r\n\r\nconst FRAGMENT_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADSurfaceNormalsShader.fragmentShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform color BaseColor;\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    vec4 baseColor      = vec4(1.0,0.0,0.0,1.0);\r\n\r\n//#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(baseColor.rgb);\r\n//#endif\r\n\r\n}\r\n`\r\n)\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface normals shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceNormalsShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw CAD surface normals shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLDrawCADSurfaceNormalsShader_VERTEX_SHADER\r\n    this.__shaderStages['FRAGMENT_SHADER'] = FRAGMENT_SHADER\r\n\r\n    this.nonSelectable = true\r\n    this.finalize()\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    return paramDescs\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADSurfaceNormalsShader', GLDrawCADSurfaceNormalsShader)\r\n\r\nexport { GLDrawCADSurfaceNormalsShader_VERTEX_SHADER, GLDrawCADSurfaceNormalsShader }\r\n","import { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL draw trim curve fans shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDrawTrimCurveFansShader extends GLShader {\r\n  /**\r\n   * Create a GL draw trim curve fans shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveFansShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute float vertexIds;\r\ninstancedattribute vec4 patchCoords;         // instanced attribute..\r\ninstancedattribute vec4 data0;     // instanced attribute..\r\ninstancedattribute vec4 data1;     // instanced attribute..\r\ninstancedattribute vec2 data2;     // instanced attribute..\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\n\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nuniform int numCurveVertices;\r\n\r\nstruct CurveRef {\r\n  int curveId;\r\n  vec2 tr;\r\n  mat2 mat;\r\n  int flags;\r\n\r\n  ivec2 addr;\r\n  int numCurveVertices;\r\n\r\n};\r\n\r\nvec2 getCurveVertex(in CurveRef curveRef, int vertexId) {\r\n    if(curveRef.flags != 0)\r\n      vertexId = curveRef.numCurveVertices - vertexId - 1;\r\n    return curveRef.tr + curveRef.mat * fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(curveRef.addr.x + vertexId, curveRef.addr.y)).rg;\r\n}\r\n\r\n\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D trimSetTexture;\r\nuniform ivec2 trimSetTextureSize;\r\n\r\n\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nCurveRef getCurveRef(inout GLSLBinReader trimsetDataReader, in int curveRefStart, inout GLSLBinReader curvesAtlasLayoutDataReader) {\r\n\r\n  CurveRef curveRef;\r\n\r\n  // Get the Curve Id from the trimSet Atlas\r\n  curveRef.curveId = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, curveRefStart + 0);\r\n\r\n  // Get the Xfo for the curve\r\n  curveRef.tr = vec2(\r\n    GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 1), \r\n    GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 2)\r\n    );\r\n  curveRef.mat = mat2(\r\n    vec2(\r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 3), \r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 4)\r\n    ),\r\n    vec2(\r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 5), \r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 6)\r\n    ));\r\n\r\n  // Get the flags for the curve\r\n  curveRef.flags = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, curveRefStart + 7);\r\n\r\n\r\n  curveRef.addr = ivec2(\r\n    GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 0), \r\n    GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 1)\r\n    );\r\n  curveRef.numCurveVertices = GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 2);\r\n\r\n  return curveRef;\r\n}\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  vec2 pos;\r\n  int vertexId = ftoi(vertexIds);\r\n  if(vertexId == 0) {\r\n    pos = (patchCoords.xy + patchCoords.zw * 0.5) / vec2(trimSetAtlasTextureSize);\r\n  }\r\n  else {\r\n    vertexId--;\r\n\r\n    CurveRef curveRef;\r\n    curveRef.tr = data0.xy;\r\n    curveRef.mat = mat2(data0.zw, data1.xy);\r\n    curveRef.flags = ftoi(data2.x);\r\n\r\n    curveRef.addr = ivec2(ftoi(data1.z), ftoi(data1.w));\r\n    curveRef.numCurveVertices = numCurveVertices;\r\n\r\n    //////////////////////////////////////////////\r\n    pos = getCurveVertex(curveRef, vertexId);\r\n\r\n    /*\r\n    //////////////////////////////////////////////\r\n    \r\n    int loopStartPos = ftoi(data0.x);\r\n    int curveIndexWithLoop = ftoi(data0.y);\r\n\r\n    GLSLBinReader trimsetDataReader;\r\n    GLSLBinReader_init(trimsetDataReader, trimSetTextureSize, 16);\r\n    int numCurves = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, loopStartPos);\r\n\r\n    GLSLBinReader curvesAtlasLayoutDataReader;\r\n    GLSLBinReader_init(curvesAtlasLayoutDataReader, curvesAtlasLayoutTextureSize, 32);\r\n\r\n    CurveRef curveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (curveIndexWithLoop * 8), curvesAtlasLayoutDataReader);\r\n    pos = getCurveVertex( curveRef, vertexId );\r\n\r\n\r\n    // Tranform the curve points by the xfo2d to put it into the coords of the trim set.\r\n    Xfo2d xfo2d = Xfo2d(data0.xy, data1.x, data0.zw);\r\n    pos = Xfo2D_transformVec2(xfo2d, pos);\r\n\r\n\r\n    //////////////////////////////////\r\n    // Due to the reduced precision we use to store our data\r\n    // we get cracks in the trim textures. To fix this we weld\r\n    // the end points of the trim curves here.\r\n    // For each end point of a curve, we find the joining end point \r\n    // and average their positions.\r\n\r\n    if(vertexId == 0) {\r\n      // Lookup the vertex of the previous curve.\r\n      int prevCurveIndexWithinLoop = curveIndexWithLoop - 1;\r\n      if(prevCurveIndexWithinLoop < 0)\r\n        prevCurveIndexWithinLoop += numCurves;\r\n      CurveRef prevCurveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (prevCurveIndexWithinLoop * 8), curvesAtlasLayoutDataReader);\r\n\r\n      // Get the end of the previous curve.\r\n      vec2 prevCurveEndPos = getCurveVertex( prevCurveRef, prevCurveRef.numCurveVertices-1 );\r\n\r\n      pos = (pos + prevCurveEndPos) * 0.5;\r\n    }\r\n    else if(vertexId == numCurveVertices-1) {\r\n      // Lookup the vertex of the next curve.\r\n      int nextCurveIndexWithinLoop = curveIndexWithLoop + 1;\r\n      if(nextCurveIndexWithinLoop >= numCurves)\r\n        nextCurveIndexWithinLoop = 0;\r\n      CurveRef nextCurveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (nextCurveIndexWithinLoop * 8), curvesAtlasLayoutDataReader);\r\n\r\n      // Get the start of the next curve.\r\n      vec2 nextCurveEndPos = getCurveVertex( nextCurveRef, 0 );\r\n      pos = (pos + nextCurveEndPos) * 0.5;\r\n    }\r\n\r\n    */\r\n    //////////////////////////////////////////////\r\n\r\n\r\n    // Now transform the trim set into the coords of the full texture.\r\n    pos = (patchCoords.xy + (pos * patchCoords.zw));\r\n    pos /= vec2(trimSetAtlasTextureSize);\r\n  }\r\n\r\n  // transform the position into clip space.\r\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0), 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveFansShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    fragColor = vec4(1.0/255.0,0.0,0.0,1.0);\r\n    \r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawTrimCurveFansShader', GLDrawTrimCurveFansShader)\r\n\r\nexport { GLDrawTrimCurveFansShader }\r\n","import { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL flatten trim sets shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLFlattenTrimSetsShader extends GLShader {\r\n  /**\r\n   * Create a GL flatten trim sets shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLFlattenTrimSetsShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\nvoid main()\r\n{\r\n    v_texCoord = (positions.xy + 0.5);\r\n    gl_Position =  vec4(positions.xy * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLFlattenTrimSetsShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n\r\n// returns true if the texel will be kept\r\n// When the fans are rendered, the pixels are acumulated. \r\n// An even number means that the pixel should be discarded\r\n// and an odd number mean the pixel should be kept.\r\nbool sampleAtlas(vec2 offset){\r\n    return mod(texture2D(trimSetAtlasTexture, v_texCoord + (offset / vec2(trimSetAtlasTextureSize))).r * 255.0, 2.0) > 0.5;\r\n}\r\n\r\nint scoreAtlas(vec2 offset){\r\n  if(sampleAtlas(offset))\r\n    return 1;\r\n  else\r\n    return 0;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n  // if(sampleAtlas(vec2(0.0, 0.0))){\r\n  //   fragColor = vec4(1.0, 0.5, 0.5, 1.0);\r\n  // }\r\n  // else{\r\n  //   fragColor = vec4(0.0, 0.5, 0.5, 1.0);\r\n  // }\r\n  \r\n  // Smoothing. Look at neighboring pixels to see\r\n  // if we should fill in the gaps. Due to floating\r\n  // point issues, we see random pixels floating\r\n  // in the air that shold have been trimmed by the\r\n  // fan. If a point \r\n  int score = scoreAtlas(vec2(-1.0, 0.0)) + \r\n              scoreAtlas(vec2(-1.0,-1.0)) + \r\n              scoreAtlas(vec2( 0.0,-1.0)) + \r\n              scoreAtlas(vec2( 1.0,-1.0)) + \r\n              scoreAtlas(vec2( 1.0, 0.0)) + \r\n              scoreAtlas(vec2( 1.0, 1.0)) + \r\n              scoreAtlas(vec2( 0.0, 1.0)) + \r\n              scoreAtlas(vec2(-1.0, 1.0));\r\n\r\n  float r = 0.0;\r\n  if(sampleAtlas(vec2(0.0, 0.0))){\r\n    if(score >= 4) // corner verts have a score of 3\r\n      r = 1.0;\r\n    else\r\n      r = 0.0;\r\n  }\r\n  else{\r\n    if(score < 4) \r\n      r = 0.0;\r\n    else\r\n      r = 1.0;\r\n  }\r\n  fragColor = vec4(r, r, 0.0, 0.0);\r\n  \r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLFlattenTrimSetsShader', GLFlattenTrimSetsShader)\r\n\r\nexport { GLFlattenTrimSetsShader }\r\n","import { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL draw trim curve strips shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDrawTrimCurveStripsShader extends GLShader {\r\n  /**\r\n   * Create a GL draw trim curve strips shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveStripsShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\ninstancedattribute vec4 patchCoords;         // instanced attribute..\r\ninstancedattribute vec4 data0;     // instanced attribute..\r\ninstancedattribute vec4 data1;     // instanced attribute..\r\ninstancedattribute vec3 data2;     // instanced attribute..\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nuniform int numCurveVertices;\r\nuniform float stripWidth;\r\n\r\nvec2 getCurveVertex(int vertexId, int flags) {\r\n  if(flags != 0)\r\n    vertexId = numCurveVertices - vertexId - 1;\r\n  return fetchTexel(curvesAtlasTexture, trimSetAtlasTextureSize, ivec2(int(data1.z) + vertexId, int(data1.w))).rg;\r\n}\r\n\r\n#define M_PI 3.1415926535897932384626433832795\r\n\r\n/* VS Outputs */\r\nvarying float v_curveIndexWithinLoop;\r\nvarying float v_gradient;\r\n\r\nvoid main(void) {\r\n\r\n  int vertexId = ftoi(positions.x);\r\n  float side = positions.y < 0.0 ? -1.0 : 1.0;\r\n  mat2 rot = mat2(data0.zw, data1.xy);\r\n  int curveRefFlags = ftoi(data2.x);\r\n  int curveIndexWithinLoop = ftoi(data2.y);\r\n  v_curveIndexWithinLoop = float(curveIndexWithinLoop);\r\n\r\n  // Tranform the curve points by the mat2 to put it into the coords of the trim set.\r\n  vec2 pos = data0.xy + (rot * getCurveVertex(vertexId, curveRefFlags));\r\n\r\n  //////////////////////////////////////////////\r\n  vec2 curveTangent;\r\n  if(vertexId > 0) {\r\n    vec2 posPrev = data0.xy + (rot * getCurveVertex(vertexId-1, curveRefFlags));\r\n    curveTangent += pos - posPrev;\r\n  }\r\n  if(vertexId < numCurveVertices-1) {\r\n    vec2 posNext = data0.xy + (rot * getCurveVertex(vertexId+1, curveRefFlags));\r\n    curveTangent += posNext - pos;\r\n  }\r\n  curveTangent = normalize(curveTangent);\r\n  vec2 curveNormal = vec2(-curveTangent.y, curveTangent.x);\r\n\r\n  // Fatten the strip\r\n  pos += (curveNormal * side * stripWidth) / patchCoords.zw;\r\n\r\n  //////////////////////////////////////////////\r\n  // Extend the strip by one pixel at each end.\r\n  if(vertexId == 0) {\r\n    pos -= curveTangent * (stripWidth / patchCoords.zw) * 0.5;\r\n  }\r\n  else if(vertexId == numCurveVertices-1) {\r\n    pos += curveTangent * (stripWidth / patchCoords.zw) * 0.5;\r\n  }\r\n  //////////////////////////////////////////////\r\n\r\n  // Now transform the trim set into the coords of the full texture.\r\n  pos = (patchCoords.xy + (pos * patchCoords.zw));\r\n  pos /= vec2(trimSetAtlasTextureSize);\r\n\r\n  // transform the position into clip space.\r\n  gl_Position = vec4((pos * 2.0) - 1.0, 0.0, 1.0);\r\n  \r\n\r\n  // The gradient should run 0.0 ... 1.0 from one side of the strip to the other.\r\n  // The side value ranges from -1.0 to +1.0\r\n\r\n  v_gradient = (side + 1.0) / 2.0;\r\n  // v_gradient = 1.0;\r\n\r\n  // Note: this causes the trim edge to move slightly to grow.\r\n  // This fills in slight gaps betwen trimmed surfaces.\r\n  // This causes lots of atrifacts on some thin surfaces\r\n  // On Mordacious, this causese many artifacts at the border of surfaces.\r\n  // v_gradient = (v_gradient * 1.1) + 0.05;\r\n  // v_gradient = (v_gradient * 1.2) + 0.1;\r\n  // v_gradient = (v_gradient * 1.5) + 0.25;\r\n  // v_gradient = (v_gradient * 2.0) + 0.5;\r\n  // v_gradient = (v_gradient * 2.0) + 1.0;\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveStripsShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n\r\nuniform int flatten;\r\n\r\n/* VS Outputs */\r\nvarying float v_curveIndexWithinLoop;\r\nvarying float v_gradient;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n  // Initially a build up the data around the edges by rasterizing a full color pixel,\r\n  // followed by a subtractive pass that cuts down the borders\r\n  //\r\n  // Initially, after the fans are rasterized \r\n  //     ----\r\n  //  .  |  .\r\n  //  .  |  .\r\n  //     ----\r\n  //\r\n  // Becomes \r\n  //  -------\r\n  //  .     .\r\n  //  .     .\r\n  //  -------\r\n  //\r\n  // Becomes \r\n  //    . ---\r\n  //    ./     \r\n  //   /. \r\n  //  -------\r\n  // After the subtraction pass\r\n\r\n\r\n  \r\n  if (flatten > 0) {\r\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n  } else {\r\n    int curveIndexWithinLoop = ftoi(v_curveIndexWithinLoop);\r\n    if (curveIndexWithinLoop % 2 == 0) {\r\n      fragColor = vec4(v_gradient, 1.0, 1.0, 1.0);\r\n    }\r\n    else {\r\n      fragColor = vec4(1.0, v_gradient, 1.0, 1.0);\r\n    }\r\n  }\r\n    \r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawTrimCurveStripsShader', GLDrawTrimCurveStripsShader)\r\n\r\nexport { GLDrawTrimCurveStripsShader }\r\n","import { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL debug trim sets shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDebugTrimSetsShader extends GLShader {\r\n  /**\r\n   * Create a GL debug trim sets shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDebugTrimSetsShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\nvoid main()\r\n{\r\n    v_texCoord = (positions.xy + 0.5);\r\n    gl_Position =  vec4(positions.xy * 2.0, 0.0, 1.0);\r\n    // gl_Position =  vec4(positions.xy + vec2(-0.5, 0.5), 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDebugTrimSetsShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n  vec4 col = texture2D(trimSetAtlasTexture, v_texCoord);\r\n  vec3 rgb = col.rgb / col.a;\r\n  fragColor = vec4(rgb,1.0);\r\n  \r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLDebugTrimSetsShader', GLDebugTrimSetsShader)\r\n\r\nexport { GLDebugTrimSetsShader }\r\n","import { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL evaluate CAD curve shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateCADCurveShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate CAD curve shader.\r\n   * @param {any} gl - The gl value.\r\n   * @ignore\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateCADCurveShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 patchCoords;         // where the values will be written to in the target texture.\r\ninstancedattribute vec2 curveDataCoords;     // where the data will come from in the source texture\r\n\r\nuniform ivec2 curvesAtlasTextureSize;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_geomDataCoords;\r\nvarying vec2 v_patchSize;\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  vec2 patchPos = patchCoords.xy;\r\n  v_patchSize = patchCoords.zw;\r\n\r\n  v_geomDataCoords = curveDataCoords;\r\n  v_vertexCoord = (positions.xy + 0.5) * v_patchSize;\r\n\r\n  vec2 pos = (patchPos + v_vertexCoord) / vec2(curvesAtlasTextureSize);\r\n  gl_Position =  vec4((pos - 0.5) * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateCADCurveShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_geomDataCoords;\r\nvarying vec2 v_patchSize;\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\nstruct PosNorm {\r\n  vec3 pos;\r\n  vec3 normal;\r\n  int geomType;\r\n};\r\n\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLCADCurves.glsl\"/>\r\n<%include file=\"GLSLNURBS.glsl\"/>\r\n<%include file=\"GLSLNURBSCurves.glsl\"/>\r\n\r\nuniform sampler2D curveDataTexture;\r\nuniform ivec2 curveDataTextureSize;\r\nuniform int writeTangents;\r\n\r\nPosNorm evalCADCurves(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  // PosNorm result;\r\n  // result.pos = vec3(float(geomType));\r\n  // // fragColor = reader.buffer;\r\n  // // fragColor = vec4(float(reader.textureSize.x), float(reader.textureSize.y), float(geomType), 1.0);\r\n  // return result;\r\n\r\n\r\n  if(geomType == CURVE_TYPE_LINE) {\r\n      return calcLinePoint(params.x, reader, texture);\r\n  } \r\n  if(geomType == CURVE_TYPE_CIRCLE) {\r\n      return calcCirclePoint(params.x, reader, texture);\r\n  } \r\n  if(geomType == CURVE_TYPE_ELIPSE) {\r\n      return calcElipsePoint(params.x, reader, texture);\r\n  }\r\n  if(geomType == CURVE_TYPE_NURBS_CURVE) {\r\n      return calcNURBSCurve3dPoint(params.x, reader, texture);\r\n  } \r\n  \r\n  PosNorm detault;\r\n  return detault;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n\r\n  // Evaluate the curve per vertex\r\n\r\n  // compute exact xy coords per pixel by rounding the vertex coord to the nearest integer and then dividing my patch size.\r\n  // The interpollated xy coords from the quad are not exact because the quad must cover the pixels with some margin.\r\n\r\n  // The quad overlaps the pixels by half a pixel, so \r\n  vec2 params = vec2(floor(v_vertexCoord.x), floor(v_vertexCoord.y));\r\n  if(v_patchSize.x > 1.0)\r\n      params.x /= v_patchSize.x - 1.0;\r\n  // if(v_patchSize.y > 1.0)\r\n  //     params.y /= v_patchSize.y - 1.0;\r\n\r\n  ivec4 region = ivec4(0, 0, curveDataTextureSize.x, curveDataTextureSize.y);\r\n  ivec2 start = ivec2(int(v_geomDataCoords.x), int(v_geomDataCoords.y));\r\n\r\n  GLSLBinReader reader;\r\n  GLSLBinReader_init(reader, curveDataTextureSize, region, start, 32);\r\n  PosNorm posNorm = evalCADCurves(params, reader, curveDataTexture);\r\n\r\n  if(writeTangents == 1) {\r\n      fragColor = vec4(posNorm.normal, 1.0);\r\n  }\r\n  else {\r\n      fragColor = vec4(posNorm.pos, 1.0);\r\n  }\r\n  // fragColor = vec4(params.x, params.y, 0.0, 1.0);\r\n  // gl_FragData[0] = vec4(posNorm.pos, 1.0);\r\n  // gl_FragData[1] = vec4(posNorm.normal, 1.0);\r\n\r\n  // fragColor.r = v_geomDataCoords.x;\r\n  // fragColor.g = v_geomDataCoords.y;\r\n  // fragColor.b = float(curveDataTextureSize.x);\r\n  // fragColor.a = float(curveDataTextureSize.y);\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLEvaluateCADCurveShader', GLEvaluateCADCurveShader)\r\n\r\nexport { GLEvaluateCADCurveShader }\r\n","import { Color, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADSurfaceShader_VERTEX_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADSurfaceShader.vertexShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // body ID, Surface index in Body, Surface Id, TrimSet Id\r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 cameraMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform ivec2 quadDetail;\r\nuniform vec3 assetCentroid;\r\n\r\n// #define DEBUG_SURFACES\r\nuniform int numSurfacesInLibrary;\r\n\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.vertexShader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying vec3 v_bodyDescAddr;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int surfaceId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n\r\n    vec2 texCoords = positions.xy + 0.5;\r\n    \r\n    v_drawCoords = drawCoords;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int cadBodyFlags = ftoi(cadBodyPixel0.g);\r\n    \r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(cadBodyFlags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    // if(v_surfaceType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    //     // int drawItemIndexInBody = int(metadata.b+0.5);\r\n    //     int sideLen = int(ceil(sqrt(float(numSurfacesInLibrary))));\r\n    //     int x = drawItemIndexInBody % sideLen;\r\n    //     int y = drawItemIndexInBody / sideLen;\r\n    //     modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n    //                     0.0, 1.0, 0.0, 0.0, \r\n    //                     0.0, 0.0, 1.0, 0.0,  \r\n    //                     float(x), float(y), 0.0, 1.0);\r\n    // }\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    v_bodyDescAddr.xy = vec2(float(bodyDescAddr.x), float(bodyDescAddr.y));\r\n    v_bodyDescAddr.z = float(drawItemIndexInBody);\r\n    mat4 surfaceMat = getDrawItemMatrix(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * surfaceMat;\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader surfaceLayoutDataReader;\r\n    GLSLBinReader_init(surfaceLayoutDataReader, surfaceAtlasLayoutTextureSize, 16);\r\n    vec4 surfaceDataAddr = GLSLBinReader_readVec4(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8);\r\n    int surfaceFlags = GLSLBinReader_readInt(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8 + 6);\r\n\r\n    bool isFan = int(quadDetail.y) == 0;\r\n    vec2 vertexCoords = texCoords * (isFan ? vec2(quadDetail) + vec2(1.0, 1.0) : vec2(quadDetail));\r\n    vec4 surfaceVertex = getSurfaceVertex(surfaceDataAddr.xy, vertexCoords);\r\n    v_surfaceType = surfaceVertex.a;\r\n    vec3 normal  = getSurfaceNormal(surfaceDataAddr.xy, vertexCoords);\r\n    vec4 pos     = vec4(surfaceVertex.rgb, 1.0);\r\n    \r\n    bool flippedNormal = testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    if(flippedNormal)\r\n        normal = -normal;\r\n\r\n    vec4 viewPos = modelViewMatrix * pos;\r\n    v_viewPos    = viewPos.xyz;\r\n    v_worldPos   = (modelMatrix * pos).xyz;\r\n    gl_Position  = projectionMatrix * viewPos;\r\n    v_viewNormal = normalMatrix * normal;\r\n\r\n    v_quadDetail = vec2(quadDetail);\r\n\r\n    {\r\n        // Pull back facing vertices towards us ever so slightly...\r\n        // This is to avoid z-fighting that occurs wehn we see the inside\r\n        // of a surface that is resting on another surface.\r\n        vec3 worldNormal = normalize(mat3(cameraMatrix) * v_viewNormal);\r\n\r\n        vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(-v_viewPos));\r\n        float ndotv = dot(worldNormal, viewVector);\r\n        bool backFacing = ndotv <= 0.0;\r\n        if (backFacing) {\r\n            // Pull backfacing vertices towards us ever so slightly...\r\n            gl_Position.z *= 0.99999;\r\n        }\r\n    }\r\n\r\n    if(isFan) {\r\n        // We are drawing a Fan surface, so the uv coords\r\n        // simply come from the vertex positions.\r\n        v_textureCoord = positions.xy;\r\n    }\r\n    else {\r\n        v_textureCoord = texCoords;\r\n        if(testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_UV)) {\r\n            v_textureCoord = vec2(v_textureCoord.y, v_textureCoord.x);\r\n            v_quadDetail = vec2(v_quadDetail.y, v_quadDetail.x);\r\n        }\r\n\r\n        // v_textureCoord.y = 1.0 - v_textureCoord.y; // Flip y\r\n    }\r\n}`\r\n)\r\n\r\nconst GLDrawCADSurfaceShader_FRAGMENT_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADSurfaceShader.fragmentShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"math/constants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GGX_Specular.glsl\"/>\r\n<%include file=\"PBRSurfaceRadiance.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nuniform bool headLighting;\r\nuniform bool displayWireframes;\r\nuniform bool displayEdges;\r\n\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\nuniform float exposure;\r\nuniform float gamma;\r\n#endif\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying vec3 v_bodyDescAddr;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\nvec3 getDebugColor(int id){\r\n    \r\n    int sel = int(round(mod(float(id), 14.0)));\r\n    \r\n    if(sel==0)\r\n        return vec3(0.0, 1.0, 1.0);\r\n    else if (sel==1)\r\n        return vec3(0.0, 1.0, 0.0);\r\n    else if (sel==2)\r\n        return vec3(1.0, 0.0, 1.0);\r\n    else if (sel==3)\r\n        return vec3(0.75, 0.75, 0.0);\r\n    else if (sel==4)\r\n        return vec3(0.0, 0.75, 0.75);\r\n    else if (sel==5)\r\n        return vec3(0.75, 0.0, 0.75);\r\n    else if (sel==6)\r\n        return vec3(0.45, 0.95, 0.0);\r\n    else if (sel==7)\r\n        return vec3(0.0, 0.45, 0.95);\r\n    else if (sel==8)\r\n        return vec3(0.95, 0.0, 0.45);\r\n    else if (sel==9)\r\n        return vec3(0.95, 0.45, 0.0);\r\n    else if (sel==10)\r\n        return vec3(0.0, 0.95, 0.45);\r\n    else if (sel==11)\r\n        return vec3(0.45, 0.0, 0.95);\r\n    else if (sel==12)\r\n        return vec3(0.45, 0.45, 0.95);\r\n    else if (sel==13)\r\n        return vec3(0.0, 0.0, 0.45);\r\n    else if (sel==14)\r\n        return vec3(0.0, 0.45, 0.45);\r\n    else if (sel==15)\r\n        return vec3(0.45, 0.0, 0.45);\r\n    else return vec3(0.2, 0.2, 0.2);\r\n}\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n// const float gridSize = 0.02;\r\nconst float gridSize = 0.2;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n    \r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n    vec2 materialCoords = cadBodyPixel1.xy;\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    ///////////////////////////////////////////\r\n    // Normal\r\n\r\n    vec3 normal = normalize(mat3(cameraMatrix) * v_viewNormal);\r\n    vec3 viewNormal = normalize(v_viewNormal);\r\n\r\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(-v_viewPos));\r\n    bool backFacing = dot(normal, viewVector) <= 0.0;\r\n    if(backFacing){\r\n        normal = -normal;\r\n        viewNormal = -viewNormal;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Material\r\n\r\n    vec4 matValue0 = getMaterialValue(materialCoords, 0);\r\n\r\n    MaterialParams material;\r\n\r\n    /////////////////\r\n    bool clayRendering = false;\r\n    if(clayRendering)\r\n        material.baseColor          = vec3(0.45, 0.26, 0.13);\r\n    else\r\n        material.baseColor          = matValue0.rgb;\r\n    \r\n    /////////////////\r\n    // Face color\r\n    #ifdef ENABLE_PER_FACE_COLORS\r\n    vec4 faceColor = getDrawItemColor(ftoi(v_bodyDescAddr.xy), ftoi(v_bodyDescAddr.z));\r\n    material.baseColor = mix(material.baseColor, faceColor.rgb, faceColor.a);\r\n    #endif\r\n\r\n    float opacity               = matValue0.a;\r\n        \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    // if (applyCutaway(cadBodyId, flags)) {\r\n    //     discard;\r\n    //     return;\r\n    // }\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = normalize(cadBodyPixel6.xyz);\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n            return;\r\n        }\r\n        // If we are not cutaway, but we can see a back facing face\r\n        // then set the normal to the cut plane do the lighting is flat.\r\n        if (backFacing){\r\n            normal = cutNormal;\r\n        }\r\n    }\r\n\r\n    vec3 irradiance ;\r\n#ifdef ENABLE_PBR\r\n    if (envMapPyramid_desc.x > 0.0) {\r\n        if (headLighting) {\r\n            irradiance = sampleEnvMap(viewNormal, 1.0);\r\n        } else {\r\n            irradiance = sampleEnvMap(normal, 1.0);\r\n        }\r\n    } else {\r\n#endif\r\n        float ndotv = dot(normal, viewVector);\r\n        irradiance = vec3(ndotv);\r\n#ifdef ENABLE_PBR\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug backFacing\r\n    // if(backFacing) {\r\n    //     material.baseColor = mix(material.baseColor, vec3(1.0, 0.0, 0.0), 0.5);\r\n    // }\r\n\r\n    /////////////////\r\n    // Debug materialId\r\n#ifdef DEBUG_MATERIALID\r\n    {\r\n        material.baseColor = vec3(float(int(materialCoords.x) % 5)/5.0, float(int(materialCoords.y) % 5)/5.0, 0.0);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug bodyId\r\n#ifdef DEBUG_BODYID\r\n    {\r\n        material.baseColor       = getDebugColor(cadBodyId);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug drawItemIndexInBody\r\n#ifdef DEBUG_SURFACEID\r\n    {\r\n        material.baseColor       = getDebugColor(drawItemIndexInBody);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug surface Type\r\n#ifdef DEBUG_SURFACETYPE\r\n    {\r\n        material.baseColor       = getDebugColor(v_surfaceType);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // bool flippedNormal = testFlag(flags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    // if(flippedNormal) {\r\n    //    material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // }\r\n\r\n    // if (backFacing) {\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // }\r\n\r\n    /////////////////\r\n    // Debug UV layout.\r\n    // {\r\n    //     material.baseColor = vec3(v_textureCoord.x);\r\n    //     // material.baseColor.r = mix(0.0, 1.0, v_textureCoord.x);\r\n    //     // material.baseColor.g = mix(0.0, 1.0, v_textureCoord.y);\r\n    // }\r\n\r\n    /////////////////\r\n    // if(testFlag(flags, SURFACE_FLAG_FLIPPED_UV)){\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,1,1), 0.5);\r\n    // }\r\n\r\n    /////////////////\r\n    // if(v_quadDetail.x > 512.0 || v_quadDetail.y > 512.0){\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // } else {\r\n    //     // discard;\r\n    // }\r\n    \r\n    /////////////////\r\n    // Debug trim texture.\r\n#ifdef DEBUG_TRIMTEXELS\r\n    if(trimCoords.x >= 0.0) {\r\n        // trimCoords = (trimPatchQuad.xy + 0.5) + ((trimPatchQuad.zw - 0.5) * v_textureCoord);\r\n        trimCoords.xy = trimPatchQuad.xy + (trimPatchQuad.zw * v_textureCoord);\r\n        vec2 trimUv = (trimCoords.xy) / vec2(trimSetAtlasTextureSize);\r\n        vec4 trimTexel = texture2D(trimSetAtlasTexture, trimUv);\r\n\r\n        vec2 texelOffset = trimCoords.xy - (floor(trimCoords.xy) + 0.5);\r\n        float texelDist = length(texelOffset);\r\n        \r\n        material.baseColor = trimTexel.rgb * texelDist;\r\n\r\n        // if (trimTexel.r > 0.5 && trimTexel.g > 0.5) {\r\n        //     material.baseColor = vec3(0,0,0);\r\n        // }\r\n\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), texelDist);\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), trimCoords.z);\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), (trimCoords.z < 0.5) ? 1.0 : 0.0);\r\n\r\n        // if(trimCoords.z < 0.5) {\r\n        //     material.baseColor = mix(material.baseColor, vec3(0,0,0), 0.1);\r\n        // }\r\n        // else{\r\n        //     float total = floor(trimCoords.x) +\r\n        //                   floor(trimCoords.y);\r\n        //     if(mod(total,2.0)==0.0)\r\n        //         material.baseColor = mix(material.baseColor, vec3(0,0,0), 0.25);\r\n        //     else\r\n        //         material.baseColor = mix(material.baseColor, vec3(1,1,1), 0.25);\r\n        // }\r\n    }\r\n#endif\r\n\r\n\r\n    \r\n    //////////////////////////////////////////////\r\n    // Transparency\r\n    // Simple screen door transparency.\r\n    // float threshold = gridSize * opacity * (1.0 - (v_viewPos.z / 300.0));\r\n    // // if(mod(v_viewPos.x / v_viewPos.z, gridSize) > threshold || mod(v_viewPos.y/v_viewPos.z, gridSize) > threshold)// || mod(v_viewPos.z, gridSize) > threshold)\r\n    // if(mod(abs(v_worldPos.x), gridSize) > threshold || mod(abs(v_worldPos.y), gridSize) > threshold || mod(abs(v_worldPos.z), gridSize) > threshold)\r\n    //     discard;\r\n\r\n\r\n    ///////////////////////////////////////////\r\n    // Lighting\r\n    vec3 radiance;\r\n\r\n    vec4 matValue1;\r\n    if(clayRendering)\r\n        matValue1          = vec4(0.0, 1.0, 0.0, 0.0);\r\n    else\r\n        matValue1          = getMaterialValue(materialCoords, 1);\r\n\r\n    material.metallic       = matValue1.r;\r\n    material.roughness      = matValue1.g;\r\n    material.reflectance    = matValue1.b;\r\n    float emissive          = matValue1.a;\r\n\r\n#ifdef ENABLE_PBR\r\n    if (envMapPyramid_desc.x > 0.0) {\r\n        if (headLighting) {\r\n            // Calculate PBR Reflection based on a screen space vecotr for both the noramal and the view vector.\r\n            radiance = pbrSurfaceRadiance(material, irradiance, viewNormal, normalize(-v_viewPos));\r\n        } else {\r\n            radiance = pbrSurfaceRadiance(material, irradiance, normal, viewVector);\r\n        }\r\n\r\n        // vec3 reflectionVector = reflect(-viewVector, normal);\r\n        // vec3 envColor = sampleEnvMap(reflectionVector, material.roughness);\r\n        // radiance = irradiance;\r\n    } else {\r\n#endif\r\n        // Simple diffuse lighting.\r\n        radiance = irradiance * material.baseColor;\r\n#ifdef ENABLE_PBR\r\n    }\r\n#endif\r\n\r\n    fragColor = vec4(mix(radiance, material.baseColor, emissive), 1.0);\r\n\r\n    /////////////////////////////\r\n    // fragColor = vec4(irradiance * material.baseColor, 1.0);\r\n    // fragColor = vec4(material.baseColor, 1.0);\r\n    // fragColor = vec4( normalize(viewNormal), 1.0);\r\n    // fragColor = vec4( normalize(normal), 1.0);\r\n\r\n    // fragColor = vec4(sampleEnvMap(viewNormal, material.roughness), 1.0);;\r\n    \r\n    ////////////////////\r\n    {\r\n        // vec4 wireColor = vec4(0.1, 0.1, 0.1, 1.0);\r\n        //vec4 wireColor = vec4(0.6, 0.6, 0.6, 1.0);\r\n        vec4 wireColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n        \r\n        vec2 vertexCoords = v_textureCoord * v_quadDetail;\r\n        vec2 vcD = fwidth(vertexCoords);\r\n        vec2 vcW = fract(vertexCoords);\r\n\r\n        bool isFan = v_quadDetail.y < 0.5;\r\n        if(displayWireframes) {\r\n            if (isFan) {\r\n\r\n            } else {\r\n        \r\n                float lerpVal = smoothstep(0.0, vcD.x, vcW.x) * smoothstep(1.0, 1.0 - vcD.x, vcW.x) * smoothstep(0.0, vcD.y, vcW.y) * smoothstep(1.0, 1.0 - vcD.y, vcW.y);\r\n                \r\n                // Display a thin line at 50% opacity.\r\n                fragColor = mix(fragColor, wireColor, (1.0-smoothstep(0.0, 0.5, lerpVal)) * 0.5 );\r\n        \r\n                //fragColor = mix(fragColor, wireColor, (mod(vertexCoords.x, 2.0) < 1.0) ? 0.5 : 0.0 );\r\n            }\r\n        }\r\n\r\n    //     vec2 tcD = fwidth(v_textureCoord);\r\n    //     vec2 tcW = fract(v_textureCoord);\r\n    //     vec2 tpD = fwidth(trimPatchQuad.xy);\r\n    //     if(displayEdges) {   \r\n    //         if (isFan) {\r\n\r\n    //         } else {\r\n    //             if(trimPatchQuad.x >= 0.0) {\r\n    //                 if (trimPatchQuad.z < 1.0) {\r\n    //                     float stripBoundaryH = 0.5;\r\n    //                     float stripWidth = 2.0;\r\n\r\n    //                     float pixelWidth = ((tpD.x + tpD.y) * 0.5) / stripWidth;\r\n    //                     float minLimit = stripBoundaryH + pixelWidth * 0.5;\r\n    //                     float maxLimit = stripBoundaryH + pixelWidth * 0.75;\r\n                        \r\n    //                     float lerpVal;\r\n    //                     if (maxLimit < 1.0) {\r\n    //                         lerpVal = smoothstep(maxLimit, minLimit, trimPatchQuad.z);\r\n    //                     } else {\r\n    //                         // If the strip width is less then one screen pixel, then \r\n    //                         // we just interpollate over the width of the strip. \r\n    //                         lerpVal = 1.0 - smoothstep(0.75, 1.0, trimPatchQuad.z);\r\n    //                     }\r\n    //                     fragColor = mix(fragColor, wireColor, lerpVal);\r\n    //                 }\r\n    //             } \r\n    //             else {\r\n    //                 float lerpVal = smoothstep(0.0, tcD.x, tcW.x) * smoothstep(1.0, 1.0 - tcD.x, tcW.x) * smoothstep(0.0, tcD.y, tcW.y) * smoothstep(1.0, 1.0 - tcD.y, tcW.y);\r\n    //                 fragColor = mix(fragColor, wireColor, 1.0 - lerpVal);\r\n    //             }\r\n    //         }\r\n    //     }\r\n    }\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(fragColor.rgb * exposure, gamma);\r\n#endif\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n)\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceShader extends GLCADShader {\r\n  /*\r\n   * Create a GL draw CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLDrawCADSurfaceShader_VERTEX_SHADER\r\n    this.__shaderStages['FRAGMENT_SHADER'] = GLDrawCADSurfaceShader_FRAGMENT_SHADER\r\n\r\n    this.finalize()\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    paramDescs.push({\r\n      name: 'EmissiveStrength',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Metallic',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Roughness',\r\n      defaultValue: 0.25,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Normal',\r\n      defaultValue: new Color(0.0, 0.0, 0.0),\r\n    })\r\n    paramDescs.push({\r\n      name: 'TexCoordScale',\r\n      defaultValue: 1.0,\r\n      texturable: false,\r\n    })\r\n    // F0 = reflectance and is a physical property of materials\r\n    // It also has direct relation to IOR so we need to dial one or the other\r\n    // For simplicity sake, we don't need to touch this value as metalic can dictate it\r\n    // such that non metallic is mostly around (0.01-0.025) and metallic around (0.7-0.85)\r\n    paramDescs.push({\r\n      name: 'Reflectance',\r\n      defaultValue: 0.025,\r\n    })\r\n    return paramDescs\r\n  }\r\n\r\n  /**\r\n   * The getPackedMaterialData method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getPackedMaterialData(material) {\r\n    const matData = new Float32Array(8)\r\n    const baseColor = material.getParameter('BaseColor').getValue()\r\n    matData[0] = baseColor.r\r\n    matData[1] = baseColor.g\r\n    matData[2] = baseColor.b\r\n    matData[3] = baseColor.a\r\n    if (material.getParameter('EmissiveStrength')) {\r\n      matData[4] = material.getParameter('Metallic').getValue()\r\n      matData[5] = material.getParameter('Roughness').getValue()\r\n      matData[6] = material.getParameter('Reflectance').getValue()\r\n      matData[7] = material.getParameter('EmissiveStrength').getValue()\r\n    } else {\r\n      matData[5] = 1.0\r\n    }\r\n    return matData\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADSurfaceShader', GLDrawCADSurfaceShader)\r\n\r\nexport { GLDrawCADSurfaceShader_VERTEX_SHADER, GLDrawCADSurfaceShader_FRAGMENT_SHADER, GLDrawCADSurfaceShader }\r\n","import { shaderLibrary, Registry } from '@zeainc/zea-engine'\r\nimport { GLDrawCADSurfaceShader_VERTEX_SHADER } from './GLDrawCADSurfaceShader.js'\r\n\r\nconst FRAGMENT_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADSurfaceGeomDataShader.fragmentShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform int passIndex;\r\nuniform int assetIndex;\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int surfaceIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    float dist = length(v_viewPos);\r\n\r\n    int passAndAssetIndex = passIndex + (assetIndex * 64);\r\n\r\n    fragColor.r = float(passAndAssetIndex);\r\n    fragColor.g = float(cadBodyId);\r\n    fragColor.b = float(surfaceIndexInBody);\r\n    fragColor.a = dist;\r\n    \r\n    // fragColor.b = float(v_surfaceType);\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n)\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface geom data shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceGeomDataShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw CAD surface geom data shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLDrawCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = FRAGMENT_SHADER\r\n\r\n    this.nonSelectable = true\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADSurfaceGeomDataShader', GLDrawCADSurfaceGeomDataShader)\r\n\r\nexport { GLDrawCADSurfaceGeomDataShader }\r\n","import { shaderLibrary, Registry } from '@zeainc/zea-engine'\r\nimport { GLDrawCADSurfaceShader_VERTEX_SHADER } from './GLDrawCADSurfaceShader.js'\r\n\r\nconst FRAGMENT_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawSelectedCADSurfaceShader.fragmentShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n    \r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int surfaceIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n    \r\n    vec4 highlightColor = getCADBodyPixel(cadBodyId, 5);\r\n    fragColor = highlightColor;\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n)\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw selected CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawSelectedCADSurfaceShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw selected CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLDrawCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = FRAGMENT_SHADER\r\n\r\n    this.nonSelectable = true\r\n    this.finalize()\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawSelectedCADSurfaceShader', GLDrawSelectedCADSurfaceShader)\r\n\r\nexport { GLDrawSelectedCADSurfaceShader }\r\n","import { Color, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADCurveShader_VERTEX_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADCurveShader.vertexShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // body ID, Surface index in Body, Surface Id, TrimSet Id\r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 cameraMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform int edgeDetail;\r\nuniform vec3 assetCentroid;\r\n\r\n\r\n// #define DEBUG_SURFACES\r\nuniform int numCurvesInLibrary;\r\n\r\n\r\n<%include file=\"GLSLCADGeomDrawing.vertexShader.glsl\"/>\r\n\r\n// GEOM\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\n// uniform sampler2D normalsTexture;\r\n\r\nvec3 getCurveVertex(ivec2 addr, int vertexId) {\r\n  return fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(addr.x + vertexId, addr.y)).rgb;\r\n}\r\n\r\n// vec3 getCurveTangent(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n//   return fetchTexel(normalsTexture, curvesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y))).rgb;\r\n// }\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int curveId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n    v_drawCoords = drawCoords;\r\n\r\n    vec2 texCoords = positions.xy;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int flags = ftoi(cadBodyPixel0.g);\r\n\r\n    // vec4 metadata = getDrawItemData(0);\r\n    // ivec4 curveAtlasCoords = ftoi(getDrawItemData(2));\r\n    // int flags = int(floor(metadata.a + 0.5));\r\n\r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(flags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    int numCurvesInLibrary = 15;\r\n    // int sideLen = int(ceil(sqrt(float(numCurvesInLibrary))));\r\n    // int x = curveId % sideLen;\r\n    // int y = curveId / sideLen;\r\n    modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n                    0.0, 1.0, 0.0, 0.0, \r\n                    0.0, 0.0, 1.0, 0.0,  \r\n                    float(curveId), float(0), 0.0, 1.0);\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    Xfo surfaceXfo = getDrawItemXfo(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * xfo_toMat4(surfaceXfo);\r\n\r\n    // v_sc = surfaceXfo.sc;\r\n    //if (v_sc.z > 0.0) {\r\n    //  gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n    //  return;\r\n    //}\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(0.001, 0.0, 0.0, 0.0, \r\n    //   0.0, 0.001, 0.0, 0.0, \r\n    //   0.0, 0.0, 0.001, 0.0,  \r\n    //   0.0, 0.0, 0.0, 1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader curvesLayoutDataReader;\r\n    GLSLBinReader_init(curvesLayoutDataReader, curvesAtlasLayoutTextureSize, 16);\r\n    vec4 curveDataAddr = GLSLBinReader_readVec4(curvesLayoutDataReader, curvesAtlasLayoutTexture, curveId * 8);\r\n\r\n    int vertexId = int(positions.x * float(edgeDetail));\r\n    vec4 pos     = vec4(getCurveVertex(ftoi(curveDataAddr.xy), vertexId), 1.0);\r\n    // vec4 pos     = vec4(positions * float(edgeDetail), 1.0);\r\n\r\n    // if (vertexId == 0)\r\n    //   pos = vec4(vec3(0.0), 1.0);\r\n\r\n    vec4 viewPos = modelViewMatrix * pos;\r\n    v_viewPos    = viewPos.xyz;\r\n    v_worldPos   = (modelMatrix * pos).xyz;\r\n    gl_Position  = projectionMatrix * viewPos;\r\n\r\n    {\r\n        // Pull edge vertices towards us ever so slightly...\r\n        gl_Position.z *= 0.99999;\r\n    }\r\n}`\r\n)\r\n\r\nconst GLDrawCADCurveShader_FRAGMENT_SHADER = shaderLibrary.parseShader(\r\n  'GLDrawCADCurveShader.fragmentShader',\r\n  `\r\nprecision highp float;\r\n\r\n<%include file=\"math/constants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GGX_Specular.glsl\"/>\r\n<%include file=\"PBRSurfaceRadiance.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nuniform bool headLighting;\r\nuniform bool displayWireframes;\r\nuniform bool displayEdges;\r\nuniform vec4 edgeColor;\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\nuniform float exposure;\r\nuniform float gamma;\r\n#endif\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\n\r\n<%include file=\"GLSLCADGeomDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int curveId = int(floor(v_drawCoords.b + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    fragColor = edgeColor;\r\n\r\n    // fragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    // if (v_sc.x < 0.0) {\r\n    //   fragColor.r = 1.0;\r\n    // }\r\n    // if (v_sc.y < 0.0) {\r\n    //   fragColor.g = 1.0;\r\n    // }\r\n    // if (v_sc.z < 0.0) {\r\n    //   fragColor.b = 1.0;\r\n    // }\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(fragColor.rgb * exposure, gamma);\r\n#endif\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n)\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADCurveShader extends GLCADShader {\r\n  /*\r\n   * Create a GL draw CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLDrawCADCurveShader_VERTEX_SHADER\r\n    this.__shaderStages['FRAGMENT_SHADER'] = GLDrawCADCurveShader_FRAGMENT_SHADER\r\n\r\n    this.finalize()\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    paramDescs.push({\r\n      name: 'EmissiveStrength',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Metallic',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Roughness',\r\n      defaultValue: 0.25,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Normal',\r\n      defaultValue: new Color(0.0, 0.0, 0.0),\r\n    })\r\n    paramDescs.push({\r\n      name: 'TexCoordScale',\r\n      defaultValue: 1.0,\r\n      texturable: false,\r\n    })\r\n    // F0 = reflectance and is a physical property of materials\r\n    // It also has direct relation to IOR so we need to dial one or the other\r\n    // For simplicity sake, we don't need to touch this value as metalic can dictate it\r\n    // such that non metallic is mostly around (0.01-0.025) and metallic around (0.7-0.85)\r\n    paramDescs.push({\r\n      name: 'Reflectance',\r\n      defaultValue: 0.025,\r\n    })\r\n    return paramDescs\r\n  }\r\n\r\n  /**\r\n   * The getPackedMaterialData method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getPackedMaterialData(material) {\r\n    const matData = new Float32Array(8)\r\n    const baseColor = material.getParameter('BaseColor').getValue()\r\n    matData[0] = baseColor.r\r\n    matData[1] = baseColor.g\r\n    matData[2] = baseColor.b\r\n    matData[3] = baseColor.a\r\n    if (material.getParameter('EmissiveStrength')) {\r\n      matData[4] = material.getParameter('Metallic').getValue()\r\n      matData[5] = material.getParameter('Roughness').getValue()\r\n      matData[6] = material.getParameter('Reflectance').getValue()\r\n      matData[7] = material.getParameter('EmissiveStrength').getValue()\r\n    } else {\r\n      matData[5] = 1.0\r\n    }\r\n    return matData\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADCurveShader', GLDrawCADCurveShader)\r\n\r\nexport { GLDrawCADCurveShader }\r\n","import { SystemDesc, Vec3, Vec4, GLTexture2D, GLFbo, GLMesh, Plane, GLPass, Registry } from '@zeainc/zea-engine'\r\nimport { CADAsset } from './CADAsset.js'\r\nimport { GLCADAsset } from './GLCADAsset.js'\r\nimport { GLCADMaterialLibrary } from './GLCADMaterialLibrary.js'\r\nimport {\r\n  GLEvaluateSimpleCADSurfaceShader,\r\n  GLEvaluateCompoundCADSurfaceShader,\r\n  GLEvaluateNURBSCADSurfaceShader,\r\n} from './GLEvaluateCADSurfaceShader.js'\r\nimport { GLDrawCADSurfaceNormalsShader } from './GLDrawCADSurfaceNormalsShader.js'\r\nimport { GLDrawTrimCurveFansShader } from './GLDrawTrimCurveFansShader.js'\r\nimport { GLFlattenTrimSetsShader } from './GLFlattenTrimSetsShader.js'\r\nimport { GLDrawTrimCurveStripsShader } from './GLDrawTrimCurveStripsShader.js'\r\nimport { GLDebugTrimSetsShader } from './GLDebugTrimSetsShader.js'\r\nimport { GLEvaluateCADCurveShader } from './GLEvaluateCADCurveShader.js'\r\nimport { GLDrawCADSurfaceGeomDataShader } from './GLDrawCADSurfaceGeomDataShader.js'\r\nimport { GLDrawSelectedCADSurfaceShader } from './GLDrawSelectedCADSurfaceShader.js'\r\nimport { GLDrawCADCurveShader } from './GLDrawCADCurveShader.js'\r\n\r\n/** Class representing a GL CAD pass.\r\n * @extends GLPass\r\n */\r\nclass GLCADPass extends GLPass {\r\n  /**\r\n   * Create a GL CAD pass.\r\n   */\r\n  constructor(debugMode = false) {\r\n    super()\r\n    this.debugMode = debugMode\r\n    this.headLighting = false\r\n    this.displayWireframes = false\r\n    this.displaySurfaces = true\r\n    this.__displayEdges = 0\r\n    this.displayNormals = false\r\n    this.normalLength = 0.002 // 2cm\r\n    this.debugTrimTex = false\r\n    this.debugSurfaceAtlas = false\r\n    this.debugAssetId = 0\r\n    this.__assets = []\r\n    this.__loadQueue = 0\r\n\r\n    this.__numHighlightedGeoms = 0\r\n\r\n    this.__dirtyBodyDrawItemsIndices = []\r\n    // Note: fist id reserved for selectionOutlineID = 1\r\n    // See 'draw()' below.\r\n    this.__shaderCount = 2\r\n    this.__shaderKeys = {}\r\n    this.__shaderOptsStack = [{}]\r\n\r\n    this.__profiling = {\r\n      numSurfaces: 0,\r\n      numSurfaceInstances: 0,\r\n      surfaceEvalTime: 0,\r\n      numBodies: 0,\r\n      numMaterials: 0,\r\n      numTriangles: 0,\r\n      numDrawSets: 0,\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  get displayEdges() {\r\n    return this.__displayEdges > 0\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  set displayEdges(val) {\r\n    if (val == true) this.__displayEdges++\r\n    else this.__displayEdges--\r\n    this.emit('updated')\r\n  }\r\n\r\n  /**\r\n   * The init method.\r\n   * @param {any} renderer - The renderer param.\r\n   * @param {any} passIndex - The passIndex param.\r\n   */\r\n  init(renderer, passIndex) {\r\n    super.init(renderer, passIndex)\r\n\r\n    this.__dataLoadStartTime = performance.now()\r\n\r\n    const gl = renderer.gl\r\n\r\n    const materialLibrary = new GLCADMaterialLibrary(gl)\r\n    materialLibrary.on('updated', () => this.emit('updated'))\r\n\r\n    const evaluateSurfaceShaders = [\r\n      new GLEvaluateSimpleCADSurfaceShader(gl),\r\n      new GLEvaluateCompoundCADSurfaceShader(gl),\r\n      new GLEvaluateNURBSCADSurfaceShader(gl),\r\n    ]\r\n\r\n    if (SystemDesc.isIOSDevice) {\r\n      throw new Error('The ZeaCAD cannnot be supported on iOS due to no ability to render to a FLOAT framebuffer.')\r\n    }\r\n    // We can support Safar now because of the ability to upload 8bit ints and convert them to 16bit floats in GLSL.\r\n    const convertTo8BitTextures = SystemDesc.browserName == 'Safari'\r\n\r\n    // Note: The crappy browsers don't support GLSL binary caching, so\r\n    // load times get quite long as we wait for the big shaders to compile.\r\n\r\n    if (gl.name != 'webgl2') {\r\n      this.setShaderPreprocessorValue('#extension GL_OES_standard_derivatives : enable')\r\n    }\r\n\r\n    if (this.debugMode) {\r\n      this.setShaderPreprocessorValue('#define DEBUG_MODE')\r\n    }\r\n\r\n    this.setShaderPreprocessorValue('#define ENABLE_TRIMMING')\r\n    this.setShaderPreprocessorValue('#define ENABLE_INLINE_GAMMACORRECTION')\r\n    if (SystemDesc.deviceCategory == 'High') {\r\n      // this.setShaderPreprocessorValue('#define ENABLE_PBR');\r\n    }\r\n    // else if(SystemDesc.deviceCategory == 'Medium'){\r\n    // }\r\n    else {\r\n      // this.clearShaderPreprocessorValue('#define ENABLE_PBR');\r\n    }\r\n\r\n    this.__cadpassdata = {\r\n      debugMode: this.debugMode,\r\n      convertTo8BitTextures,\r\n      assetCount: 0,\r\n      materialLibrary,\r\n      evaluateCurveShader: new GLEvaluateCADCurveShader(gl),\r\n      evaluateSurfaceShaders: evaluateSurfaceShaders,\r\n      trimCurveFansShader: new GLDrawTrimCurveFansShader(gl),\r\n      flattenTrimSetsShader: new GLFlattenTrimSetsShader(gl),\r\n      trimCurveStripsShader: new GLDrawTrimCurveStripsShader(gl),\r\n      debugTrimSetsShader: new GLDebugTrimSetsShader(gl),\r\n      updateDrawItemsShader: this.__updateDrawItemsShader,\r\n      glplanegeom: new GLMesh(gl, new Plane(1.0, 1.0, 1, 1)),\r\n      maxTexSize: SystemDesc.gpuDesc.maxTextureSize,\r\n\r\n      incHighlightedCount: this.incHighlightedCount.bind(this),\r\n      decHighlightedCount: this.decHighlightedCount.bind(this),\r\n      incDisplayEdges: () => {\r\n        this.__displayEdges++\r\n        this.emit('updated')\r\n      },\r\n      decDisplayEdges: () => {\r\n        this.__displayEdges--\r\n        this.emit('updated')\r\n      },\r\n      genShaderID: shaderName => {\r\n        if (!(shaderName in this.__shaderKeys)) {\r\n          const shaderClass = Registry.getBlueprint(shaderName)\r\n          if (!shaderClass || !shaderClass.getPackedMaterialData) {\r\n            return this.__cadpassdata.genShaderID('GLDrawCADSurfaceShader')\r\n          }\r\n          const shader = this.applyOptsToShader(Registry.constructClass(shaderName, gl))\r\n\r\n          const id = this.__shaderCount\r\n          this.__shaderKeys[shaderName] = {\r\n            id,\r\n            shader,\r\n          }\r\n          this.__shaderCount++\r\n          return id\r\n        }\r\n        return this.__shaderKeys[shaderName].id\r\n      },\r\n    }\r\n\r\n    // Force the default shader to be setup first.\r\n    this.__cadpassdata.genShaderID('GLDrawCADSurfaceShader')\r\n\r\n    this.__decrementLoadQueue = () => {\r\n      this.__loadQueue--\r\n      if (this.__loadQueue == 0) {\r\n        console.log('===All Assets Loaded===')\r\n        console.log('Total Load Time:' + (performance.now() - this.__gpuLoadStartTime) / 1000)\r\n        this.__profiling.numTriangles = this.__profiling.numTriangles / 1000000\r\n        console.log(this.__profiling)\r\n\r\n        this.emit('updated')\r\n      }\r\n    }\r\n\r\n    this.__renderer.registerPass(\r\n      (treeItem, rargs) => {\r\n        if (treeItem instanceof CADAsset) {\r\n          const cadAsset = treeItem\r\n          this.__loadQueue++\r\n          this.__cadpassdata.assetCount++\r\n\r\n          if (cadAsset.isLoaded()) {\r\n            if (cadAsset.getNumBodyItems() > 0) {\r\n              this.addCADAsset(cadAsset)\r\n            } else {\r\n              this.__decrementLoadQueue()\r\n            }\r\n          } else {\r\n            cadAsset.once('loaded', () => {\r\n              if (cadAsset.getNumBodyItems() > 0) this.addCADAsset(cadAsset)\r\n              else {\r\n                this.__decrementLoadQueue()\r\n              }\r\n            })\r\n          }\r\n          rargs.continueInSubTree = true\r\n          return true\r\n        }\r\n        return false\r\n      },\r\n      treeItem => {\r\n        if (treeItem instanceof CADAsset) {\r\n          this.removeCADAsset(treeItem)\r\n          return true\r\n        }\r\n        return false\r\n      }\r\n    )\r\n\r\n    // collector.registerSceneItemFilter((treeItem, rargs) => {\r\n    //   if (treeItem instanceof CADAsset) {\r\n    //     this.__loadQueue++;\r\n    //     const cadAsset = treeItem;\r\n    //     cadAsset.on('loaded', () => {\r\n    //       this.addCADAsset(treeItem);\r\n    //     });\r\n    //     rargs.continueInSubTree = true;\r\n    //     return true;\r\n    //   }\r\n    // });\r\n  }\r\n\r\n  /**\r\n   * The getShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getShaderPreprocessorValue(name) {\r\n    return this.getShaderState()[name]\r\n  }\r\n\r\n  /**\r\n   * The setShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @param {boolean} apply - The apply param.\r\n   */\r\n  setShaderPreprocessorValue(name, apply = true) {\r\n    if (!name.startsWith('#')) name = '#define ' + name\r\n\r\n    this.getShaderState()[name] = name\r\n\r\n    // Now update any shaders already consturcted.\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.setPreprocessorValue) {\r\n        shaderReg.shader.setPreprocessorValue(name)\r\n        if (apply) shaderReg.shader.applyOptions()\r\n      }\r\n    }\r\n\r\n    if (this.__drawSelectedCADSurfaceShader) {\r\n      this.__drawSelectedCADSurfaceShader.setPreprocessorValue(name)\r\n      if (apply) this.__drawSelectedCADSurfaceShader.applyOptions()\r\n    }\r\n    if (this.__drawCADSurfaceGeomDataShader) {\r\n      this.__drawCADSurfaceGeomDataShader.setPreprocessorValue(name)\r\n      if (apply) this.__drawCADSurfaceGeomDataShader.applyOptions()\r\n    }\r\n    if (this.__updateDrawItemsShader) {\r\n      this.__updateDrawItemsShader.setPreprocessorValue(name)\r\n      if (apply) this.__updateDrawItemsShader.applyOptions()\r\n    }\r\n    if (this.__renderer) this.__renderer.requestRedraw()\r\n  }\r\n\r\n  /**\r\n   * The clearShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @param {boolean} apply - The apply param.\r\n   */\r\n  clearShaderPreprocessorValue(name, apply = true) {\r\n    delete this.getShaderState()[name]\r\n\r\n    // Now update any shaders already consturcted.\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.clearPreprocessorValue) {\r\n        shaderReg.shader.clearPreprocessorValue(name)\r\n        if (apply) shaderReg.shader.applyOptions()\r\n      }\r\n    }\r\n    if (this.__renderer) this.__renderer.requestRedraw()\r\n  }\r\n\r\n  applyOptsToShader(shader) {\r\n    if (shader.setPreprocessorValue) {\r\n      // Initialise the shaders.\r\n      const opts = this.getShaderState()\r\n      for (const key in opts) shader.setPreprocessorValue(key)\r\n      shader.applyOptions()\r\n    }\r\n    return shader\r\n  }\r\n\r\n  /**\r\n   * The getShaderState method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getShaderState() {\r\n    return this.__shaderOptsStack[this.__shaderOptsStack.length - 1]\r\n  }\r\n\r\n  /**\r\n   * The pushShaderState method.\r\n   */\r\n  pushShaderState() {\r\n    this.__shaderOptsStack.push(Object.assign({}, this.getShaderState()))\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.pushState) {\r\n        shaderReg.shader.pushState()\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The popShaderState method.\r\n   */\r\n  popShaderState() {\r\n    this.__shaderOptsStack.pop()\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.popState) shaderReg.shader.popState()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The startPresenting method.\r\n   */\r\n  startPresenting() {\r\n    if (SystemDesc.deviceCategory != 'High') {\r\n      this.pushShaderState()\r\n      // this.clearShaderPreprocessorValue('#define ENABLE_PBR');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The stopPresenting method.\r\n   */\r\n  stopPresenting() {\r\n    if (SystemDesc.deviceCategory != 'High') {\r\n      this.popShaderState()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneNormalParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneNormalParam() {\r\n    return this.__cutPlaneNormalParam\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneDistParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneDistParam() {\r\n    return this.__cutDistParam\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneColorParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneColorParam() {\r\n    return this.__cutPlaneColorParam\r\n  }\r\n\r\n  /**\r\n   * The incHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  incHighlightedCount(count) {\r\n    this.__numHighlightedGeoms += count\r\n  }\r\n\r\n  /**\r\n   * The decHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  decHighlightedCount(count) {\r\n    this.__numHighlightedGeoms -= count\r\n  }\r\n\r\n  /**\r\n   * The addCADAsset method is an internal method called when new CADAsset\r\n   * items are discovered in the tree.\r\n   * @param {CADAsset} cadAsset - The cadAsset tree item.\r\n   */\r\n  addCADAsset(cadAsset) {\r\n    this.__gl.finish()\r\n    const assetId = this.__assets.length\r\n\r\n    if (assetId == 0) {\r\n      this.__gpuLoadStartTime = performance.now()\r\n    }\r\n\r\n    if (cadAsset.getVersion().compare([0, 0, 26]) > 0) {\r\n      this.setShaderPreprocessorValue('#define INTS_PACKED_AS_2FLOAT16')\r\n    }\r\n    if (cadAsset.getVersion().compare([0, 0, 29]) >= 0) {\r\n      this.setShaderPreprocessorValue('#define ENABLE_PER_FACE_COLORS')\r\n    }\r\n    if (cadAsset.getVersion().compare([1, 0, 5]) >= 0) {\r\n      this.setShaderPreprocessorValue('#define ENABLE_BODY_EDGES')\r\n    }\r\n\r\n    const glcadAsset = new GLCADAsset(this.__gl, assetId, cadAsset, this.__cadpassdata)\r\n\r\n    glcadAsset.once('loaded', assetStats => {\r\n      this.__profiling.numSurfaces += assetStats.numSurfaces\r\n      this.__profiling.numSurfaceInstances += assetStats.numSurfaceInstances\r\n      this.__profiling.surfaceEvalTime += assetStats.surfaceEvalTime\r\n      this.__profiling.numBodies += assetStats.numBodies\r\n      this.__profiling.numMaterials += assetStats.numMaterials\r\n      this.__profiling.numTriangles += assetStats.numTriangles\r\n      this.__profiling.numDrawSets += assetStats.numDrawSets\r\n\r\n      this.__decrementLoadQueue()\r\n    })\r\n\r\n    glcadAsset.on('updated', () => this.emit('updated'))\r\n\r\n    this.__assets.push(glcadAsset)\r\n  }\r\n\r\n  /**\r\n   * The removeCADAsset method.\r\n   * @param {number} index - The index of the cadAsset to retrieve.\r\n   */\r\n  removeCADAsset(asset) {\r\n    this.__assets = this.__assets.filter(glcadAsset => {\r\n      if (glcadAsset.getCADAsset() == asset) {\r\n        glcadAsset.destroy()\r\n        return false\r\n      }\r\n      return true\r\n    })\r\n    this.emit('updated')\r\n  }\r\n\r\n  /**\r\n   * The getGLCADAsset method.\r\n   * @param {number} index - The index of the cadAsset to retrieve.\r\n   */\r\n  getGLCADAsset(index) {\r\n    return this.__assets[index]\r\n  }\r\n\r\n  /**\r\n   * The __updateViewXfo method.\r\n   * @param {any} viewXfo - The viewXfo param.\r\n   * @private\r\n   */\r\n  __updateViewXfo(viewXfo) {\r\n    const viewDir = viewXfo.ori.getZaxis().negate()\r\n    const moved = viewXfo.tr.subtract(this.__prevViewXfo.tr)\r\n    this.__moveThreshold = 0.2 // 20cm\r\n    const movedDist = moved.length()\r\n    if (movedDist > this.__moveThreshold) {\r\n      const viewDirJSON = viewDir.toJSON()\r\n      const movedJSON = moved.toJSON()\r\n\r\n      const eachAssembly = glcadAsset => {\r\n        glcadAsset.onViewChanged(cameraXfoJSON, viewDirJSON, movedJSON, movedDist)\r\n      }\r\n      this.__assets.forEach(eachAssembly)\r\n      this.__prevViewXfo = cameraXfo\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  draw(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    if (this.debugTrimTex) {\r\n      if (this.__assets.length > this.debugAssetId) this.__assets[this.debugAssetId].drawTrimSets(renderstate)\r\n    }\r\n    if (this.debugSurfaceAtlas) {\r\n      if (this.__assets.length > this.debugAssetId) this.__assets[this.debugAssetId].drawSurfaceAtlas(renderstate)\r\n      return\r\n    }\r\n\r\n    if (this.displaySurfaces) {\r\n      if (this.__cadpassdata.materialLibrary.needsUpload()) this.__cadpassdata.materialLibrary.uploadMaterials()\r\n\r\n      for (const shaderKey in this.__shaderKeys) {\r\n        const shaderReg = this.__shaderKeys[shaderKey]\r\n        shaderReg.shader.bind(renderstate)\r\n        renderstate.shaderId = shaderReg.id\r\n\r\n        if (!this.__cadpassdata.materialLibrary.bind(renderstate)) {\r\n          return false\r\n        }\r\n\r\n        if (renderstate.unifs.headLighting) {\r\n          gl.uniform1i(renderstate.unifs.headLighting.location, this.headLighting)\r\n        }\r\n        if (renderstate.unifs.displayWireframes) {\r\n          gl.uniform1i(renderstate.unifs.displayWireframes.location, this.displayWireframes)\r\n        }\r\n        // if (renderstate.unifs.displayEdges) {\r\n        //   // gl.uniform1i(renderstate.unifs.displayEdges.location, this.displayEdges)\r\n        //   gl.uniform1i(renderstate.unifs.displayEdges.location, false)\r\n        // }\r\n\r\n        const boundTextures = renderstate.boundTextures\r\n        for (const asset of this.__assets) {\r\n          asset.draw(renderstate)\r\n          renderstate.boundTextures = boundTextures\r\n        }\r\n\r\n        shaderReg.shader.unbind(renderstate)\r\n      }\r\n    }\r\n\r\n    if (this.displayNormals) {\r\n      if (!this.__drawCADSurfaceNormalsShader) {\r\n        this.__drawCADSurfaceNormalsShader = this.applyOptsToShader(new GLDrawCADSurfaceNormalsShader(gl))\r\n      }\r\n      if (!this.__drawCADSurfaceNormalsShader.bind(renderstate)) return false\r\n\r\n      gl.uniform1f(renderstate.unifs.normalLength.location, this.normalLength)\r\n      const id = this.__shaderKeys.GLDrawCADSurfaceShader.id\r\n      const boundTextures = renderstate.boundTextures\r\n      for (const asset of this.__assets) {\r\n        asset.drawNormals(renderstate, id)\r\n        renderstate.boundTextures = boundTextures\r\n      }\r\n    }\r\n\r\n    if (this.__displayEdges > 0) {\r\n      if (!this.__drawCADCurvesShader) {\r\n        this.__drawCADCurvesShader = this.applyOptsToShader(new GLDrawCADCurveShader(gl))\r\n      }\r\n      if (!this.__drawCADCurvesShader.bind(renderstate)) return false\r\n\r\n      gl.uniform4f(renderstate.unifs.edgeColor.location, 0.1, 0.1, 0.1, 1)\r\n\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.FUNC_ADD)\r\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA) // For add\r\n\r\n      const boundTextures = renderstate.boundTextures\r\n      for (const asset of this.__assets) {\r\n        asset.drawEdges(renderstate, 0)\r\n        renderstate.boundTextures = boundTextures\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    // To debug the highlight buffer, enable this line.\r\n    // It will draw the highlight buffer directly to the screen.\r\n    // this.drawHighlightedGeoms(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The drawHighlightedGeoms method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawHighlightedGeoms(renderstate) {\r\n    if (this.__numHighlightedGeoms == 0) return false\r\n    const gl = this.__gl\r\n    if (!this.__drawSelectedCADSurfaceShader) {\r\n      this.__drawSelectedCADSurfaceShader = this.applyOptsToShader(new GLDrawSelectedCADSurfaceShader(gl))\r\n    }\r\n    if (!this.__drawSelectedCADSurfaceShader.bind(renderstate)) {\r\n      return false\r\n    }\r\n    for (const asset of this.__assets) {\r\n      asset.drawHighlightedGeoms(renderstate)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The drawGeomData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawGeomData(renderstate) {\r\n    const gl = this.__gl\r\n    if (!this.__drawCADSurfaceGeomDataShader) {\r\n      this.__drawCADSurfaceGeomDataShader = this.applyOptsToShader(new GLDrawCADSurfaceGeomDataShader(gl))\r\n    }\r\n    if (!this.__drawCADSurfaceGeomDataShader.bind(renderstate)) {\r\n      return false\r\n    }\r\n\r\n    gl.disable(gl.BLEND)\r\n    gl.disable(gl.CULL_FACE)\r\n    gl.enable(gl.DEPTH_TEST)\r\n    gl.depthFunc(gl.LESS)\r\n    gl.depthMask(true)\r\n\r\n    const passIndexUnif = renderstate.unifs.passIndex\r\n    if (passIndexUnif) {\r\n      gl.uniform1i(passIndexUnif.location, this.__passIndex)\r\n    }\r\n\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.nonSelectable) continue\r\n\r\n      renderstate.shaderId = this.__shaderKeys[shaderKey].id\r\n      for (const asset of this.__assets) {\r\n        asset.drawGeomData(renderstate)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getGeomItemAndDist method.\r\n   * @param {any} geomData - The geomData param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getGeomItemAndDist(geomData) {\r\n    const assetId = Math.round(geomData[0] / 64)\r\n    const geomId = Math.round(geomData[1])\r\n    const dist = geomData[3]\r\n    const geomItem = this.__assets[assetId].getGeomItem(geomId)\r\n\r\n    // console.log(this.__assets[assetId].getSurfaceData(geomId))\r\n\r\n    return {\r\n      geomItem,\r\n      dist,\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCADPass }\r\n"],"names":["Lines","BinReader","Vec2","Vec4","Box2","Vec3","Quat","Plane","Material","Color","SystemDesc","Box3","Xfo","BaseGeomItem","MaterialParameter","ColorParameter","TreeItem","GeomItem","Registry","AssetItem","FilePathParameter","BooleanParameter","Version","resourceLoader","Mesh","GLMesh","GLLines","SubSet","__cache","GLTexture2D","GLRenderTarget","EventEmitter","GLFbo","Fan","Float32","MathFunctions","GLCADAssetWorker","GrowingPacker","shaderLibrary","GLShader","FRAGMENT_SHADER","GLPass"],"mappings":"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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACjQAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,eAAe;AACjB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACnJAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,oBAAoB;AACtB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACxEAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,4BAA4B;AAC9B,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AACD;AACAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,8BAA8B;AAChC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACrUAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,gBAAgB;AAClB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACvOAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,sBAAsB;AACxB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;AC5IAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,wBAAwB;AAC1B,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACvRA,MAAM,wCAAwC,GAAGA,uBAAa,CAAC,WAAW;AAC1E,EAAE,yCAAyC;AAC3C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AACD;AACAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,mCAAmC;AACrC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAM,gCAAgC,SAASC,kBAAQ,CAAC;AACxD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,eAAe;AACrB,KAAK,GAAG,yCAAwC;AAChD;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,iBAAiB;AACvB,KAAK,GAAGD,uBAAa,CAAC,WAAW;AACjC,MAAM,iDAAiD;AACvD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAM,kCAAkC,SAASC,kBAAQ,CAAC;AAC1D;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,eAAe;AACrB,KAAK,GAAG,yCAAwC;AAChD;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,iBAAiB;AACvB,KAAK,GAAGD,uBAAa,CAAC,WAAW;AACjC,MAAM,mDAAmD;AACzD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAM,+BAA+B,SAASC,kBAAQ,CAAC;AACvD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,eAAe;AACrB,KAAK,GAAG,yCAAwC;AAChD;AACA,IAAI,IAAI,CAAC,cAAc;AACvB,MAAM,iBAAiB;AACvB,KAAK,GAAGD,uBAAa,CAAC,WAAW;AACjC,MAAM,gDAAgD;AACtD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH;;AC9ZAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,uBAAuB;AACzB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;ACpDAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,sCAAsC;AACxC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC;AACH,EAAC;AACDA,uBAAa,CAAC,eAAe;AAC7B,EAAE,yCAAyC;AAC3C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AACD;AACAA,uBAAa,CAAC,eAAe;AAC7B,EAAE,wCAAwC;AAC1C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC;AACH,IAAG;AACHA,uBAAa,CAAC,eAAe;AAC7B,EAAE,2CAA2C;AAC7C,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;AC/RA;AACA;AACA;AACA;AACA,MAAM,WAAW,SAASC,kBAAQ,CAAC;AACnC;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,EAAC;AACrB,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,oBAAoB,CAAC,IAAI,EAAE;AAC7B,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,GAAG,KAAI;AAChC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,sBAAsB,CAAC,IAAI,EAAE;AAC/B,IAAI,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAC;AAChC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,QAAQ,GAAG;AACb,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;AAC5C,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,EAAC;AACvD,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,QAAQ,GAAG;AACb,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,GAAE;AACpB,IAAI,IAAI,CAAC,YAAY,GAAE;AACvB,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,YAAY,GAAG;AACjB,IAAI,MAAM,UAAU,GAAG,GAAE;AACzB,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,GAAE;AACjC,IAAI,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;AAC7B,MAAM,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAC;AACjC,KAAK;AACL,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,KAAI;AAC/E,IAAI,IAAI,CAAC,KAAK,GAAG,QAAO;AACxB,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE;AACtC,MAAM,OAAO;AACb,KAAK,EAAC;AACN,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,WAAW,EAAE;AACpB,IAAI,OAAO,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC;AAC9C,GAAG;AACH;;ACzEA,MAAM,2CAA2C,GAAGD,uBAAa,CAAC,WAAW;AAC7E,EAAE,4CAA4C;AAC9C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC;AACF,EAAC;AACD;AACA,MAAM,eAAe,GAAGA,uBAAa,CAAC,WAAW;AACjD,EAAE,8CAA8C;AAChD,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AAGD;AACA;AACA;AACA;AACA;AACA,MAAM,6BAA6B,SAAS,WAAW,CAAC;AACxD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,4CAA2C;AACtF,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAG,gBAAe;AAC5D;AACA,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;AAC7B,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,OAAO,oBAAoB,GAAG;AAChC,IAAI,MAAM,UAAU,GAAG,KAAK,CAAC,oBAAoB,GAAE;AACnD,IAAI,UAAU,CAAC,IAAI,CAAC;AACpB,MAAM,IAAI,EAAE,WAAW;AACvB,MAAM,YAAY,EAAE,IAAI,KAAK,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AAC5C,KAAK,EAAC;AACN,IAAI,OAAO,UAAU;AACrB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,+BAA+B,EAAE,6BAA6B;;AClPhF;AACA;AACA;AACA;AACA,MAAM,yBAAyB,SAASqB,kBAAQ,CAAC;AACjD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGD,uBAAa,CAAC,WAAW;AACpE,MAAM,wCAAwC;AAC9C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;AACtE,MAAM,0CAA0C;AAChD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,2BAA2B,EAAE,yBAAyB;;ACtNxE;AACA;AACA;AACA;AACA,MAAM,uBAAuB,SAASqB,kBAAQ,CAAC;AAC/C;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGD,uBAAa,CAAC,WAAW;AACpE,MAAM,sCAAsC;AAC5C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;AACtE,MAAM,wCAAwC;AAC9C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,yBAAyB,EAAE,uBAAuB;;AClHpE;AACA;AACA;AACA;AACA,MAAM,2BAA2B,SAASqB,kBAAQ,CAAC;AACnD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGD,uBAAa,CAAC,WAAW;AACpE,MAAM,0CAA0C;AAChD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;AACtE,MAAM,4CAA4C;AAClD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,6BAA6B,EAAE,2BAA2B;;ACnL5E;AACA;AACA;AACA;AACA,MAAM,qBAAqB,SAASqB,kBAAQ,CAAC;AAC7C;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGD,uBAAa,CAAC,WAAW;AACpE,MAAM,oCAAoC;AAC1C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;AACtE,MAAM,sCAAsC;AAC5C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,uBAAuB,EAAE,qBAAqB;;AClEhE;AACA;AACA;AACA;AACA,MAAM,wBAAwB,SAASqB,kBAAQ,CAAC;AAChD;AACA;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGD,uBAAa,CAAC,WAAW;AACpE,MAAM,uCAAuC;AAC7C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;AACtE,MAAM,yCAAyC;AAC/C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACApB,kBAAQ,CAAC,QAAQ,CAAC,0BAA0B,EAAE,wBAAwB;;AC7JtE,MAAM,oCAAoC,GAAGoB,uBAAa,CAAC,WAAW;AACtE,EAAE,qCAAqC;AACvC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC;AACF,EAAC;AACD;AACA,MAAM,sCAAsC,GAAGA,uBAAa,CAAC,WAAW;AACxE,EAAE,uCAAuC;AACzC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AAGD;AACA;AACA;AACA;AACA;AACA,MAAM,8BAA8B,SAAS,WAAW,CAAC;AACzD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,qCAAoC;AAC/E;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGE,kBAAe;AAC5D;AACA,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;AAC7B,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACAtB,kBAAQ,CAAC,QAAQ,CAAC,gCAAgC,EAAE,8BAA8B;;AC5GlF,MAAMsB,iBAAe,GAAGF,uBAAa,CAAC,WAAW;AACjD,EAAE,+CAA+C;AACjD,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AAGD;AACA;AACA;AACA;AACA;AACA,MAAM,8BAA8B,SAAS,WAAW,CAAC;AACzD;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,qCAAoC;AAC/E;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGE,kBAAe;AAC5D;AACA,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;AAC7B,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH,CAAC;AACD;AACAtB,kBAAQ,CAAC,QAAQ,CAAC,gCAAgC,EAAE,8BAA8B;;ACjGlF,MAAM,kCAAkC,GAAGoB,uBAAa,CAAC,WAAW;AACpE,EAAE,mCAAmC;AACrC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC;AACF,EAAC;AACD;AACA,MAAM,oCAAoC,GAAGA,uBAAa,CAAC,WAAW;AACtE,EAAE,qCAAqC;AACvC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,EAAC;AAGD;AACA;AACA;AACA;AACA;AACA,MAAM,oBAAoB,SAAS,WAAW,CAAC;AAC/C;AACA;AACA;AACA;AACA,EAAE,WAAW,CAAC,EAAE,EAAE;AAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,mCAAkC;AAC7E,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAG,qCAAoC;AACjF;AACA,IAAI,IAAI,CAAC,QAAQ,GAAE;AACnB,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,OAAO,oBAAoB,GAAG;AAChC,IAAI,MAAM,UAAU,GAAG,KAAK,CAAC,oBAAoB,GAAE;AACnD,IAAI,UAAU,CAAC,IAAI,CAAC;AACpB,MAAM,IAAI,EAAE,WAAW;AACvB,MAAM,YAAY,EAAE,IAAI7B,eAAK,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AAC5C,KAAK,EAAC;AACN,IAAI,UAAU,CAAC,IAAI,CAAC;AACpB,MAAM,IAAI,EAAE,kBAAkB;AAC9B,MAAM,YAAY,EAAE,GAAG;AACvB,KAAK,EAAC;AACN,IAAI,UAAU,CAAC,IAAI,CAAC;AACpB,MAAM,IAAI,EAAE,UAAU;AACtB,MAAM,YAAY,EAAE,GAAG;AACvB,KAAK,EAAC;AACN,IAA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"}